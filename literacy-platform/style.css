@import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Nunito:wght@400;600;700&family=Atkinson+Hyperlegible:wght@400;700&display=swap');

:root {
    --color-correct: #22c55e;
    --color-present: #fbbf24;
    /* Darker absent improves projector contrast + avoids "white on white" look. */
    --color-absent: #475569;
    --color-neutral: #d7e0ee;
    --color-text: #0f172a;
    --color-vowel-soft: #e0f2fe;
    --color-vowel-border: #7dd3fc;
    --font-heading: 'Baloo 2', 'Nunito', sans-serif;
    --font-body: 'Atkinson Hyperlegible', 'Nunito', system-ui, -apple-system, sans-serif;
    --font-reading: 'Atkinson Hyperlegible', 'Nunito', system-ui, -apple-system, sans-serif;
    --text-muted: #334155;
    --text-subtle: #475569;
    --text-faint: #64748b;
    /* Shared "stage" surface (projector-friendly: contrast without feeling heavy). */
    --stage-bg: linear-gradient(180deg, rgba(255, 255, 255, 0.92) 0%, rgba(241, 245, 255, 0.86) 100%);
    --stage-border: rgba(100, 116, 139, 0.34);
    --stage-shadow: 0 22px 60px rgba(15, 23, 42, 0.10);
    --lab-bg: #f7f9ff;
    --lab-bg-soft: #eef2ff;
    --lab-card: #ffffff;
    --lab-border: #dbe3ee;
    --lab-shadow: 0 10px 22px rgba(15, 23, 42, 0.07);
    --lab-radius: 18px;
    --accent-primary: #4f46e5;
    --accent-secondary: #0ea5e9;
    --accent-warm: #f97316;
    --accent-soft: #e0e7ff;
    /* Activity accents (overridden per page). */
    --panel-accent: linear-gradient(90deg, rgba(99, 102, 241, 0.9), rgba(14, 165, 233, 0.8), rgba(249, 115, 22, 0.6));
    --brand-accent: linear-gradient(135deg, rgba(99, 102, 241, 0.95), rgba(14, 165, 233, 0.85), rgba(249, 115, 22, 0.7));
    /* Buttons pick up the activity palette so each page has a lively, coherent vibe. */
    --btn-primary-1: #6366f1;
    --btn-primary-2: #4f46e5;
    --btn-primary-3: #4338ca;
    --btn-primary-border: rgba(99, 102, 241, 0.6);
    --btn-primary-shadow: rgba(79, 70, 229, 0.32);
    --btn-secondary-hover: rgba(99, 102, 241, 0.12);
    --page-max: 1240px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

/* CALM, CENTERED LAYOUT - Following UX Brief */
body {
    font-family: var(--font-body);
    background:
        radial-gradient(circle at 12% 10%, rgba(56, 189, 248, 0.16), transparent 46%),
        radial-gradient(circle at 88% 8%, rgba(251, 146, 60, 0.16), transparent 44%),
        radial-gradient(circle at 50% 82%, rgba(99, 102, 241, 0.12), transparent 50%),
        linear-gradient(180deg, #fbfdff 0%, #eef4ff 55%, #e6eefb 100%);
    color: var(--color-text);
    display: flex; 
    flex-direction: column; 
    align-items: center;
    min-height: 100vh;
    height: 100dvh; 
    overflow-x: hidden;
    overflow-y: auto;
    outline: none;
}

/* Word Quest stays "no-scroll" so the board + keyboard remain stable on projectors. */
body.word-quest-page {
    overflow: hidden;
}

body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: radial-gradient(circle at 1px 1px, rgba(99, 102, 241, 0.12) 1px, transparent 0);
    background-size: 28px 28px;
    /* Keep the pattern subtle for projector legibility. */
    opacity: 0.22;
    pointer-events: none;
    z-index: 0;
}

header,
main,
footer {
    position: relative;
    z-index: 1;
}

body.large-text {
    font-size: 110%;
}

body.calm-mode {
    background: #f5f7fa;
}

body.calm-mode .selected-sound::before,
body.calm-mode .phoneme-card::before,
body.calm-mode .letter-card::before,
body.calm-mode #mouth-visual {
    animation: none !important;
}

/* ---------- Sound Lab Only (pop-out / new tab) ---------- */
body.soundlab-only {
    height: 100dvh;
    overflow: hidden;
}

body.soundlab-only #modal-overlay,
body.soundlab-only #game-canvas,
body.soundlab-only .controls,
body.soundlab-only #toast-container,
body.soundlab-only #banner-container,
body.soundlab-only #fun-hud,
body.soundlab-only #welcome-modal,
body.soundlab-only #teacher-modal,
body.soundlab-only #recording-studio-modal,
body.soundlab-only #progress-modal,
body.soundlab-only #decodable-modal,
body.soundlab-only #help-modal,
body.soundlab-only #bonus-modal,
body.soundlab-only #modal {
    display: none !important;
}

body.soundlab-only header {
    padding-bottom: 0;
}

body.soundlab-only #phoneme-modal {
    position: relative;
    top: auto;
    left: auto;
    transform: none;
    margin: 16px auto;
    height: calc(100dvh - 32px);
    max-height: calc(100dvh - 32px);
    resize: none;
}

body.soundlab-only #phoneme-modal .modal-content {
    height: 100%;
}

/* ---------- Home / Learning Hub ---------- */
body.home-page {
    height: auto;
    min-height: 100dvh;
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 32px;
}

body.home-page.home-details-collapsed [data-home-detail] {
    display: none;
}

body.student-mode [data-student-hidden="true"],
body.student-mode #classroom-btn,
body.student-mode #teacher-btn,
body.student-mode #reports-btn,
body.student-mode .learner-manage-btn,
body.student-mode a[href*="teacher-report.html"] {
    display: none !important;
}

.home-main {
    width: 100%;
    max-width: var(--page-max);
    padding: 0 16px 48px;
    display: grid;
    gap: 18px;
    min-height: 0;
}

body.home-page.home-details-collapsed .home-main {
    padding-bottom: 18px;
    gap: 0;
}

.home-card {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid var(--lab-border);
    border-radius: var(--lab-radius);
    box-shadow: var(--lab-shadow);
    padding: 20px;
    position: relative;
    overflow: hidden;
}

.home-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
        radial-gradient(circle at 12% 18%, rgba(56, 189, 248, 0.18), transparent 55%),
        radial-gradient(circle at 86% 20%, rgba(249, 115, 22, 0.14), transparent 55%),
        radial-gradient(circle at 50% 90%, rgba(99, 102, 241, 0.12), transparent 60%);
    pointer-events: none;
}

.home-card > * {
    position: relative;
    z-index: 1;
}

.home-hero {
    display: grid;
    grid-template-columns: minmax(0, 1.25fr) minmax(260px, 0.75fr);
    gap: 18px;
    align-items: start;
}

body.home-page.home-details-collapsed .home-hero {
    min-height: calc(100dvh - 150px);
}

.home-hero h2 {
    font-size: clamp(1.4rem, 2.6vw, 1.9rem);
    margin-bottom: 8px;
}

.home-kicker {
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    font-weight: 900;
    color: #4338ca;
    margin-bottom: 8px;
}

.home-lede {
    color: #334155;
    font-size: 1rem;
    line-height: 1.45;
    font-weight: 620;
    max-width: 52ch;
}

body.home-page.home-details-collapsed .home-start-flow,
body.home-page.home-details-collapsed .home-journey-grid {
    display: none;
}

.home-start-flow {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
}

.home-journey-grid {
    margin-top: 14px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
}

.home-journey-card {
    border-radius: 14px;
    border: 1px solid rgba(99, 102, 241, 0.24);
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 11px;
    display: grid;
    gap: 4px;
}

.home-journey-icon {
    font-size: 1.05rem;
    line-height: 1;
}

.home-journey-title {
    font-size: 0.9rem;
    font-weight: 860;
    color: #1e293b;
}

.home-journey-card p {
    margin: 0;
    color: #475569;
    font-size: 0.82rem;
    line-height: 1.3;
    font-weight: 660;
}

.home-entry-segments {
    display: inline-flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 14px;
}

.home-entry-segment {
    border: 1px solid rgba(99, 102, 241, 0.26);
    background: rgba(255, 255, 255, 0.84);
    color: #1e293b;
    border-radius: 999px;
    padding: 8px 14px;
    font-weight: 820;
    font-size: 0.84rem;
    cursor: pointer;
    transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease;
}

.home-entry-segment:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 16px rgba(15, 23, 42, 0.1);
    border-color: rgba(99, 102, 241, 0.4);
}

.home-entry-segment.active {
    color: #ffffff;
    border-color: rgba(79, 70, 229, 0.4);
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.95), rgba(14, 165, 233, 0.86));
}

.home-flow-chip {
    border-radius: 999px;
    border: 1px solid rgba(99, 102, 241, 0.24);
    background: rgba(255, 255, 255, 0.8);
    color: #334155;
    font-weight: 750;
    font-size: 0.82rem;
    padding: 6px 10px;
}

.home-role-picker {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 8px;
    margin-top: 14px;
}

.home-role-picker .home-role-pick.hidden {
    display: none;
}

.home-role-pick {
    border: 1px solid rgba(99, 102, 241, 0.24);
    background: rgba(255, 255, 255, 0.84);
    color: #1e293b;
    border-radius: 12px;
    padding: 10px 12px;
    font-weight: 760;
    font-size: 0.84rem;
    text-align: left;
    cursor: pointer;
    transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease, background 140ms ease;
}

.home-role-pick:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 16px rgba(15, 23, 42, 0.12);
    border-color: rgba(99, 102, 241, 0.34);
}

.home-role-pick.active {
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.95), rgba(14, 165, 233, 0.86));
    color: #ffffff;
    border-color: rgba(79, 70, 229, 0.45);
    box-shadow: 0 10px 20px rgba(79, 70, 229, 0.22);
}

.home-role-preview {
    margin-top: 12px;
    color: #475569;
    font-size: 0.9rem;
    font-weight: 640;
}

body.home-page .header-actions {
    gap: 8px;
}

body.home-page .header-actions .link-btn {
    padding: 6px 10px;
    font-size: 0.84rem;
    border-radius: 11px;
}

body.home-page.home-visual-fun .home-card::before {
    opacity: 1;
}

body.home-page.home-visual-calm::before {
    opacity: 0.12;
    background-image: radial-gradient(circle at 1px 1px, rgba(99, 102, 241, 0.08) 1px, transparent 0);
    background-size: 36px 36px;
}

body.home-page.home-visual-calm .home-card {
    background: rgba(255, 255, 255, 0.95);
}

body.home-page.home-visual-calm .home-card::before {
    opacity: 0.34;
}

body.home-page.home-visual-calm .home-cta.primary,
body.home-page.home-visual-calm .home-pathway-chip.active {
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.9), rgba(14, 165, 233, 0.78));
}

.home-visual-mode {
    margin-top: 14px;
    display: grid;
    gap: 8px;
}

.home-starter-settings {
    margin-top: 14px;
    border: 1px solid rgba(99, 102, 241, 0.26);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.85);
    padding: 10px;
    display: grid;
    gap: 8px;
}

.home-starter-settings .home-select {
    min-width: 0;
}

.home-check-row.compact {
    font-size: 0.8rem;
    font-weight: 720;
}

.home-visual-mode-row {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.home-visual-chip {
    border: 1px solid rgba(99, 102, 241, 0.28);
    background: rgba(255, 255, 255, 0.84);
    color: #1e293b;
    border-radius: 999px;
    padding: 7px 14px;
    font-weight: 800;
    font-size: 0.82rem;
    cursor: pointer;
    transition: transform 140ms ease, box-shadow 140ms ease, background 140ms ease;
}

.home-visual-chip:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 16px rgba(15, 23, 42, 0.14);
}

.home-visual-chip.active {
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.96), rgba(14, 165, 233, 0.9));
    color: #ffffff;
    border-color: rgba(79, 70, 229, 0.42);
}

.home-visual-note {
    margin: 0;
    font-size: 0.84rem;
}

.home-brand-block {
    display: grid;
    gap: 8px;
    margin-bottom: 12px;
}

.home-brand-name {
    font-size: clamp(1.15rem, 2.2vw, 1.5rem);
    font-weight: 950;
    color: #0f172a;
    letter-spacing: 0.02em;
}

.home-brand-tagline {
    color: #4338ca;
    font-size: 1rem;
    font-weight: 850;
}

.home-brand-alt-grid {
    display: grid;
    gap: 6px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.home-brand-alt {
    border-radius: 12px;
    border: 1px solid rgba(99, 102, 241, 0.24);
    background: rgba(238, 242, 255, 0.8);
    color: #1e293b;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
    padding: 8px 10px;
}

.home-brand-description {
    margin: 0;
    color: #334155;
    font-size: 0.92rem;
    font-weight: 600;
    line-height: 1.45;
}

.home-cta-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 14px;
}

.home-cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 11px 16px;
    border-radius: 14px;
    font-weight: 800;
    text-decoration: none;
    border: 1px solid rgba(99, 102, 241, 0.25);
    background: rgba(255, 255, 255, 0.85);
    color: #1e293b;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
    cursor: pointer;
}

.home-cta.primary {
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.96), rgba(14, 165, 233, 0.88));
    border-color: rgba(79, 70, 229, 0.35);
    color: #ffffff;
}

.home-cta.ghost {
    background: rgba(255, 255, 255, 0.7);
}

.home-cta:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
}

.home-pathway-chooser {
    margin-top: 14px;
    display: grid;
    gap: 8px;
}

.home-pathway-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.home-pathway-chip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid rgba(99, 102, 241, 0.28);
    background: rgba(255, 255, 255, 0.78);
    color: #1e293b;
    font-weight: 800;
    font-size: 0.84rem;
    text-decoration: none;
    box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
}

.home-pathway-chip:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
}

.home-pathway-chip.active {
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.95), rgba(14, 165, 233, 0.86));
    border-color: rgba(79, 70, 229, 0.42);
    color: #ffffff;
}

.home-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 14px;
}

.home-badge {
    background: rgba(224, 231, 255, 0.75);
    border: 1px solid rgba(99, 102, 241, 0.22);
    color: #4338ca;
    padding: 6px 10px;
    border-radius: 999px;
    font-weight: 800;
    font-size: 0.85rem;
}

.home-hero-panel {
    background: rgba(248, 250, 252, 0.85);
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 18px;
    padding: 14px 14px 16px;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);
}

.home-hero-panel-lite {
    display: grid;
    gap: 10px;
}

.home-next-steps {
    display: grid;
    gap: 8px;
}

.home-next-step {
    display: flex;
    align-items: center;
    gap: 8px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.34);
    background: rgba(255, 255, 255, 0.9);
    padding: 8px 10px;
    color: #1e293b;
    font-size: 0.85rem;
    font-weight: 760;
}

.home-next-step span {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 999px;
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.95), rgba(14, 165, 233, 0.86));
    color: #ffffff;
    font-size: 0.74rem;
    font-weight: 900;
    flex-shrink: 0;
}

.home-quick-setup-details {
    margin-top: 2px;
    border-radius: 14px;
    border: 1px solid rgba(99, 102, 241, 0.26);
    background: rgba(255, 255, 255, 0.86);
    overflow: hidden;
}

.home-quick-setup-details > summary {
    list-style: none;
    cursor: pointer;
    padding: 10px 12px;
    font-size: 0.84rem;
    font-weight: 860;
    color: #1f2937;
}

.home-quick-setup-details > summary::-webkit-details-marker {
    display: none;
}

.home-quick-setup-details > summary::after {
    content: ' ▾';
    font-weight: 900;
    color: #4338ca;
}

.home-quick-setup-details[open] > summary::after {
    content: ' ▴';
}

.home-quick-setup-details .home-starter-settings {
    margin-top: 0;
    border: 0;
    border-top: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 0;
    background: transparent;
}

.home-story-visual {
    margin-top: 8px;
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.86);
    padding: 10px;
    display: grid;
    gap: 8px;
}

.home-story-row {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 8px;
}

.home-story-pill {
    border-radius: 12px;
    border: 1px solid rgba(99, 102, 241, 0.22);
    background: linear-gradient(135deg, rgba(239, 246, 255, 0.95), rgba(238, 242, 255, 0.9));
    color: #1e293b;
    font-weight: 760;
    font-size: 0.8rem;
    line-height: 1.3;
    padding: 8px 9px;
    min-height: 58px;
}

.home-mini-title {
    font-weight: 900;
    color: #0f172a;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-size: 0.78rem;
    margin-bottom: 10px;
}

.home-quick-steps {
    display: grid;
    gap: 8px;
    padding-left: 18px;
    color: #334155;
    font-weight: 650;
    line-height: 1.4;
}

.home-mini-hint {
    margin-top: 12px;
    color: #475569;
    font-size: 0.9rem;
    line-height: 1.4;
}

@media (max-width: 980px) {
    .home-story-row {
        grid-template-columns: 1fr;
    }

    .home-story-pill {
        min-height: 0;
    }
}

.home-card-header h2 {
    margin-bottom: 6px;
}

.home-subtitle {
    color: #475569;
    font-weight: 650;
    line-height: 1.4;
}

.home-role-controls {
    margin-top: 12px;
    display: grid;
    gap: 8px;
}

.home-role-signal {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.home-role-security {
    font-size: 0.82rem;
    font-weight: 700;
    color: #475569;
}

.home-pin-controls {
    margin-top: 6px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px;
    display: grid;
    gap: 6px;
}

.home-check-row {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 0.84rem;
    font-weight: 700;
    color: #334155;
}

.home-transfer-panel {
    margin-top: 10px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.82);
    padding: 10px;
    display: grid;
    gap: 8px;
}

.home-transfer-steps {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.88rem;
    font-weight: 650;
}

.home-transfer-note {
    margin: 0;
    color: #7f1d1d;
    font-size: 0.82rem;
    font-weight: 700;
}

.home-transfer-code {
    min-height: 108px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
    font-size: 0.8rem;
    line-height: 1.25;
}

.home-recovery-panel {
    margin-top: 4px;
    border-top: 1px dashed rgba(148, 163, 184, 0.4);
    padding-top: 8px;
    display: grid;
    gap: 6px;
}

.home-role-chip {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    border: 1px solid rgba(79, 70, 229, 0.28);
    background: rgba(224, 231, 255, 0.78);
    color: #312e81;
    font-size: 0.8rem;
    font-weight: 850;
    padding: 4px 10px;
}

.home-role-chip.subtle {
    border-color: rgba(148, 163, 184, 0.35);
    background: rgba(241, 245, 249, 0.82);
    color: #334155;
}

.home-role-summary {
    margin-top: 12px;
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.84);
    padding: 12px;
    display: grid;
    gap: 6px;
}

.home-role-title {
    color: #1e3a8a;
    font-size: 0.98rem;
    font-weight: 900;
}

.home-role-mission {
    color: #334155;
    font-size: 0.9rem;
    font-weight: 650;
    line-height: 1.4;
}

.home-role-grid {
    margin-top: 12px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
    gap: 10px;
}

.home-role-card {
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.84);
    padding: 12px;
    display: grid;
    gap: 6px;
}

.home-role-card h3 {
    margin: 0;
    color: #0f172a;
    font-size: 0.86rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.home-role-card p {
    margin: 0;
    color: #334155;
    font-size: 0.86rem;
    font-weight: 650;
    line-height: 1.38;
}

.home-class-block-panel {
    margin-top: 14px;
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.78);
    padding: 12px;
    display: grid;
    gap: 8px;
}

.home-class-block-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 10px;
}

.home-class-block-card {
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.88);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
}

.home-class-block-head {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    align-items: baseline;
}

.home-class-block-title {
    font-size: 0.98rem;
    font-weight: 900;
    color: #0f172a;
}

.home-class-block-meta {
    font-size: 0.78rem;
    font-weight: 800;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.home-class-block-summary {
    color: #334155;
    font-weight: 650;
    font-size: 0.85rem;
    line-height: 1.35;
}

.home-class-block-steps {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-weight: 650;
    font-size: 0.82rem;
}

.home-class-block-launch {
    justify-self: start;
}

.home-path-grid,
.home-activity-grid {
    margin-top: 14px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 12px;
}

.home-path-step,
.home-activity {
    display: grid;
    gap: 6px;
    text-decoration: none;
    padding: 14px 14px 16px;
    border-radius: 18px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.78);
    color: #0f172a;
    box-shadow: 0 10px 18px rgba(15, 23, 42, 0.06);
    transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
}

.home-path-step:hover,
.home-activity:hover {
    transform: translateY(-2px);
    box-shadow: 0 14px 26px rgba(15, 23, 42, 0.1);
    border-color: rgba(99, 102, 241, 0.35);
}

.home-step-kicker {
    font-size: 0.78rem;
    font-weight: 900;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #64748b;
}

.home-step-title,
.home-activity-title {
    font-family: var(--font-heading);
    font-size: 1.2rem;
    letter-spacing: 0.1px;
}

.home-step-desc,
.home-activity-desc {
    color: #334155;
    font-weight: 650;
    line-height: 1.4;
}

.home-activity-meta {
    margin-top: 4px;
    color: #64748b;
    font-weight: 800;
    font-size: 0.85rem;
}

.home-placement-grid {
    margin-top: 14px;
    display: grid;
    gap: 12px;
}

.home-placement-summary {
    padding: 14px 14px 16px;
    border-radius: 18px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(248, 250, 252, 0.85);
    box-shadow: 0 10px 18px rgba(15, 23, 42, 0.06);
    display: grid;
    gap: 8px;
}

.home-placement-line {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: baseline;
    color: #0f172a;
    font-weight: 650;
}

.home-progress-grid {
    margin-top: 14px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 12px;
}

.home-progress-panel {
    padding: 14px 14px 16px;
    border-radius: 18px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.78);
    box-shadow: 0 10px 18px rgba(15, 23, 42, 0.06);
    display: grid;
    gap: 8px;
    min-width: 0;
}

.home-progress-number {
    font-size: clamp(1.4rem, 2.6vw, 1.85rem);
    font-weight: 950;
    color: #0f172a;
}

.home-progress-list {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 6px;
    color: #0f172a;
    font-weight: 650;
    line-height: 1.35;
}

button.home-cta {
    cursor: pointer;
    font-family: inherit;
}

.home-report-actions {
    margin-top: 12px;
}

.home-file-input {
    position: absolute;
    width: 1px;
    height: 1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
    padding: 0;
}

/* ---------- Assessments Hub ---------- */
body.assessments-page {
    min-height: 100dvh;
    height: auto;
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 26px;
}

.assessments-main {
    width: 100%;
    max-width: var(--page-max);
    margin: 0 auto;
    padding: 0 16px 36px;
    display: grid;
    gap: 14px;
}

.assessments-card {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid var(--lab-border);
    border-radius: var(--lab-radius);
    box-shadow: var(--lab-shadow);
    padding: 16px;
}

.assessments-hero {
    display: grid;
    gap: 14px;
    grid-template-columns: minmax(260px, 1.2fr) minmax(240px, 0.8fr);
}

.assessments-role-controls {
    display: grid;
    gap: 8px;
    align-content: start;
}

.assessments-recommended-toggle {
    margin-top: 2px;
}

.assessments-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
}

.assessment-lane {
    display: grid;
    gap: 8px;
    transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
}

.assessment-lane.is-priority {
    border-color: rgba(99, 102, 241, 0.46);
    box-shadow: 0 14px 24px rgba(79, 70, 229, 0.12);
    transform: translateY(-1px);
}

.assessment-lane.is-secondary {
    opacity: 0.92;
}

.assessment-lane-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    flex-wrap: wrap;
}

.assessment-lane-head h3 {
    margin: 0;
    font-size: 1rem;
    color: #0f172a;
}

.assessment-lane-chip {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    border: 1px solid rgba(99, 102, 241, 0.36);
    background: rgba(224, 231, 255, 0.72);
    color: #312e81;
    font-size: 0.72rem;
    font-weight: 900;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    padding: 3px 8px;
}

.assessment-lane p {
    margin: 0;
    color: #334155;
    font-weight: 650;
    line-height: 1.4;
}

.assessment-lane ul {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.86rem;
    font-weight: 640;
}

.assessment-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 2px;
}

@media (max-width: 900px) {
    .assessments-hero {
        grid-template-columns: 1fr;
    }
}

.home-report-status {
    margin-top: 8px;
    min-height: 1.25rem;
}

.home-report-status.success {
    color: #166534;
}

.home-report-status.error {
    color: #991b1b;
}

.home-field-label {
    display: block;
    margin-bottom: 4px;
    font-weight: 700;
    color: #334155;
}

.home-input,
.home-select {
    width: 100%;
    min-height: 40px;
    border: 1px solid rgba(148, 163, 184, 0.45);
    border-radius: 12px;
    padding: 8px 10px;
    font: inherit;
    color: #0f172a;
    background: rgba(255, 255, 255, 0.96);
}

.home-input:focus,
.home-select:focus,
.learner-switcher-select:focus {
    outline: none;
    border-color: rgba(79, 70, 229, 0.58);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.16);
}

.home-learner-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 10px;
}

.home-learner-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    border: 1px solid rgba(148, 163, 184, 0.32);
    border-radius: 14px;
    padding: 10px 12px;
    background: rgba(255, 255, 255, 0.76);
}

.home-learner-copy {
    display: grid;
    gap: 2px;
}

.home-learner-actions {
    display: inline-flex;
    gap: 8px;
    align-items: center;
}

.home-learner-editor {
    width: 100%;
    margin-top: 8px;
    padding-top: 10px;
    border-top: 1px dashed rgba(148, 163, 184, 0.5);
    display: grid;
    gap: 10px;
}

.home-learner-edit-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: minmax(180px, 1.2fr) minmax(140px, 0.8fr);
}

.home-learner-editor-actions {
    display: inline-flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

/* ---------- Teacher Report ---------- */
body.report-page {
    height: auto;
    min-height: 100dvh;
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 28px;
}

.report-main {
    width: 100%;
    max-width: var(--page-max);
    padding: 0 16px 46px;
    display: grid;
    gap: 16px;
}

.report-card {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid var(--lab-border);
    border-radius: var(--lab-radius);
    box-shadow: var(--lab-shadow);
    padding: 18px;
}

.report-student-lock {
    border-color: rgba(99, 102, 241, 0.35);
    background: linear-gradient(160deg, rgba(255, 255, 255, 0.95), rgba(238, 242, 255, 0.92));
}

.report-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: wrap;
}

.report-actions {
    display: inline-flex;
    gap: 8px;
    align-items: center;
}

.report-meta-row {
    margin-top: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    color: #1f2937;
}

.report-metric-grid {
    margin-top: 12px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
}

.report-metric {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.78);
    padding: 10px 12px;
}

.report-metric-label {
    font-size: 0.82rem;
    font-weight: 800;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.report-metric-value {
    margin-top: 4px;
    font-size: 1.15rem;
    font-weight: 900;
    color: #0f172a;
}

.report-focus {
    margin-top: 8px;
    display: grid;
    gap: 8px;
}

.report-focus-title {
    font-weight: 900;
    color: #0f172a;
}

.report-focus-note {
    color: #334155;
    line-height: 1.4;
    font-weight: 650;
}

.report-pulse {
    margin-top: 8px;
}

.report-pulse-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-pulse-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.82);
    padding: 10px 12px;
}

.report-pulse-card h3 {
    margin: 0 0 6px;
    font-size: 0.95rem;
    color: #0f172a;
}

.report-pulse-card ul {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-weight: 650;
}

.report-pulse-note {
    margin-top: 8px;
    font-size: 0.86rem;
    color: #334155;
    font-weight: 650;
    line-height: 1.35;
}

.report-pulse-link {
    color: #1d4ed8;
    font-weight: 800;
    text-decoration: none;
}

.report-pulse-link:hover,
.report-pulse-link:focus-visible {
    text-decoration: underline;
}

.report-pulse-subnote {
    margin-top: 2px;
    color: #475569;
    font-size: 0.82rem;
    line-height: 1.3;
    font-weight: 600;
}

.report-rag-grid {
    display: grid;
    gap: 8px;
}

.report-rag-lane {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.85);
    padding: 8px 10px;
}

.report-rag-lane ul {
    margin: 6px 0 0;
    padding-left: 16px;
    display: grid;
    gap: 4px;
}

.report-rag-title {
    font-size: 0.8rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.report-rag-red {
    border-color: rgba(239, 68, 68, 0.4);
    background: rgba(254, 242, 242, 0.9);
}

.report-rag-red .report-rag-title {
    color: #b91c1c;
}

.report-rag-yellow {
    border-color: rgba(245, 158, 11, 0.45);
    background: rgba(255, 251, 235, 0.9);
}

.report-rag-yellow .report-rag-title {
    color: #92400e;
}

.report-rag-green {
    border-color: rgba(34, 197, 94, 0.45);
    background: rgba(240, 253, 244, 0.9);
}

.report-rag-green .report-rag-title {
    color: #166534;
}

.report-builder-controls {
    margin-top: 10px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
    align-items: end;
}

.report-builder-label {
    display: grid;
    gap: 4px;
    font-size: 0.82rem;
    font-weight: 800;
    color: #334155;
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.report-builder-label select {
    border: 1px solid rgba(148, 163, 184, 0.45);
    border-radius: 10px;
    background: #ffffff;
    color: #0f172a;
    padding: 8px 10px;
    font-size: 0.92rem;
    font-weight: 650;
}

.report-builder-label input[type="text"],
.report-builder-label input[type="search"],
.report-builder-label input[type="url"] {
    border: 1px solid rgba(148, 163, 184, 0.45);
    border-radius: 10px;
    background: #ffffff;
    color: #0f172a;
    padding: 8px 10px;
    font-size: 0.92rem;
    font-weight: 650;
}

.report-builder-label input[type="file"] {
    border: 1px solid rgba(148, 163, 184, 0.45);
    border-radius: 10px;
    background: #ffffff;
    color: #0f172a;
    padding: 8px 10px;
    font-size: 0.86rem;
    font-weight: 650;
}

.report-builder-output {
    margin-top: 12px;
    display: grid;
    gap: 10px;
}

.report-builder-summary {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.82);
    padding: 10px 12px;
    display: grid;
    gap: 5px;
    color: #1f2937;
    font-weight: 650;
}

.report-builder-steps {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-builder-step {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.82);
    padding: 10px 12px;
    display: grid;
    gap: 7px;
}

.report-builder-phase {
    font-size: 0.82rem;
    font-weight: 800;
    color: #0f172a;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.report-builder-activity {
    font-size: 1rem;
    font-weight: 900;
    color: #0f172a;
}

.report-builder-move {
    font-size: 0.86rem;
    color: #334155;
    line-height: 1.35;
    font-weight: 650;
}

.report-builder-link {
    justify-self: start;
}

.report-builder-note {
    font-size: 0.86rem;
    color: #334155;
    font-weight: 650;
}

.report-share-summary {
    margin-top: 10px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 12px;
    color: #1f2937;
    font-weight: 650;
    line-height: 1.45;
    white-space: pre-wrap;
}

.report-outcomes {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-outcome-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-outcome-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
}

.report-outcome-card h3 {
    margin: 0;
    font-size: 0.9rem;
    color: #0f172a;
}

.report-outcome-value {
    font-size: 1rem;
    font-weight: 900;
    color: #1d4ed8;
}

.report-outcome-note {
    font-size: 0.84rem;
    font-weight: 650;
    color: #334155;
    line-height: 1.35;
}

.report-outcome-proof {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
}

.report-outcome-proof h3 {
    margin: 0 0 8px;
    font-size: 0.92rem;
    color: #0f172a;
}

.report-outcome-proof ul {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-weight: 650;
}

.report-demo-readiness {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-demo-summary {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 4px;
    color: #0f172a;
    font-weight: 750;
}

.report-demo-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-demo-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
}

.report-demo-card h3 {
    margin: 0;
    font-size: 0.88rem;
    color: #0f172a;
}

.report-demo-score {
    font-size: 1.02rem;
    color: #1d4ed8;
    font-weight: 900;
}

.report-demo-note {
    color: #334155;
    font-size: 0.83rem;
    font-weight: 650;
    line-height: 1.35;
}

.report-showcase-flow {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-showcase-steps {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-showcase-step {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
}

.report-showcase-phase {
    color: #0f172a;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-weight: 850;
}

.report-showcase-detail {
    color: #334155;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
}

.report-showcase-link {
    justify-self: start;
}

.report-showcase-note {
    font-size: 0.84rem;
    color: #334155;
    font-weight: 650;
}

.report-crosswalk {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-crosswalk-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}

.report-crosswalk-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
}

.report-crosswalk-card h3 {
    margin: 0;
    font-size: 0.92rem;
    color: #0f172a;
}

.report-crosswalk-score {
    margin-top: 6px;
    font-size: 0.82rem;
    color: #334155;
    font-weight: 650;
}

.report-crosswalk-card ul {
    margin: 8px 0 0;
    padding-left: 18px;
    display: grid;
    gap: 5px;
    color: #334155;
    font-size: 0.82rem;
    font-weight: 650;
    line-height: 1.32;
}

.report-crosswalk-note {
    font-size: 0.82rem;
    color: #475569;
    font-weight: 650;
}

.report-benchmarks {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-bench-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    color: #334155;
    font-size: 0.84rem;
    font-weight: 700;
}

.report-bench-table-wrap {
    width: 100%;
    overflow-x: auto;
}

.report-bench-table {
    width: 100%;
    min-width: 640px;
    border-collapse: separate;
    border-spacing: 0;
}

.report-bench-table th,
.report-bench-table td {
    border: 1px solid rgba(148, 163, 184, 0.32);
    padding: 8px 10px;
    text-align: center;
    font-weight: 700;
}

.report-bench-table th:first-child,
.report-bench-table td:first-child {
    text-align: left;
}

.report-bench-table thead th {
    background: #f8fafc;
    color: #334155;
    font-size: 0.82rem;
}

.report-bench-chip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    padding: 3px 9px;
    font-size: 0.78rem;
    font-weight: 900;
    letter-spacing: 0.02em;
}

.report-bench-chip.bench-good {
    background: #dcfce7;
    color: #166534;
}

.report-bench-chip.bench-watch {
    background: #ffedd5;
    color: #9a3412;
}

.report-bench-chip.bench-alert {
    background: #fee2e2;
    color: #991b1b;
}

.report-bench-chip.bench-none {
    background: #e2e8f0;
    color: #334155;
}

.report-bench-note {
    font-size: 0.82rem;
    color: #475569;
    font-weight: 650;
}

.report-goal-controls {
    margin-top: 10px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    align-items: end;
}

.report-goal-output {
    margin-top: 10px;
}

.report-goal-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 12px;
    display: grid;
    gap: 8px;
}

.report-goal-card h3 {
    margin: 0;
    font-size: 0.95rem;
    color: #0f172a;
}

.report-goal-card p {
    margin: 0;
    font-size: 0.86rem;
    color: #334155;
    font-weight: 650;
    line-height: 1.4;
}

.report-goal-card ul {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
}

.report-goal-note {
    font-size: 0.82rem;
    color: #475569;
    font-weight: 650;
}

.report-protocol-controls {
    margin-top: 10px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    align-items: end;
}

.report-timeline-controls {
    margin-top: 8px;
}

.report-timeline-manual {
    margin-top: 10px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
}

.report-timeline-manual summary {
    cursor: pointer;
    color: #0f172a;
    font-weight: 800;
}

.report-timeline-manual-grid {
    margin-top: 10px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.report-timeline-note-field {
    grid-column: 1 / -1;
}

.report-timeline-manual-actions {
    margin-top: 10px;
}

.report-protocol-output {
    margin-top: 10px;
}

#report-numeracy-import-status {
    margin-top: 8px;
    min-height: 1.2em;
}

.report-import-details {
    margin-top: 8px;
}

.report-import-details summary {
    cursor: pointer;
    font-size: 0.84rem;
    color: #1f2937;
    font-weight: 800;
}

.report-import-header-list {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.report-import-header-list code {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.38);
    background: rgba(241, 245, 249, 0.85);
    padding: 3px 8px;
    font-size: 0.78rem;
    color: #1e293b;
    font-weight: 700;
}

.report-import-skip-summary {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.84rem;
    font-weight: 650;
}

#report-media-status,
#report-media-modal-status {
    margin-top: 8px;
    min-height: 1.2em;
}

#report-media-status.success,
#report-media-modal-status.success {
    color: #166534;
}

#report-media-status.error,
#report-media-modal-status.error {
    color: #991b1b;
}

.report-media-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.36);
    z-index: 1998;
}

.report-media-modal {
    z-index: 1999;
    width: min(980px, calc(100vw - 28px));
    max-width: 980px;
    max-height: calc(100vh - 24px);
    overflow-y: auto;
    text-align: left;
}

.report-media-modal .modal-content {
    text-align: left;
    display: grid;
    gap: 10px;
}

.report-media-library {
    margin-top: 10px;
}

.report-media-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}

.report-media-item {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 7px;
}

.report-media-item-compact {
    margin-top: 8px;
}

.report-media-item-head {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 8px;
    color: #0f172a;
    font-size: 0.85rem;
}

.report-media-item-meta {
    color: #334155;
    font-size: 0.8rem;
    font-weight: 650;
}

.report-media-player audio,
.report-media-player video,
.report-media-preview {
    width: 100%;
    max-height: 220px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: #f8fafc;
}

.report-media-item-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.report-media-chip-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.report-media-chip {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    border: 1px solid rgba(59, 130, 246, 0.32);
    background: rgba(219, 234, 254, 0.72);
    color: #1e40af;
    font-size: 0.74rem;
    font-weight: 700;
    padding: 2px 8px;
}

.report-media-slot {
    margin-top: 10px;
    border: 1px dashed rgba(148, 163, 184, 0.5);
    border-radius: 14px;
    background: rgba(248, 250, 252, 0.72);
    padding: 10px 12px;
}

.report-media-slot-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    color: #0f172a;
    font-size: 0.84rem;
}

.report-media-empty {
    margin-top: 6px;
    color: #475569;
    font-size: 0.82rem;
    font-weight: 650;
}

#report-numeracy-import-status.success {
    color: #166534;
}

#report-numeracy-import-status.error {
    color: #991b1b;
}

#report-parent-message-status.success {
    color: #166534;
}

#report-parent-message-status.error {
    color: #991b1b;
}

#report-timeline-status.success {
    color: #166534;
}

#report-timeline-status.error {
    color: #991b1b;
}

#report-iesp-status.success {
    color: #166534;
}

#report-iesp-status.error {
    color: #991b1b;
}

#report-sprint-status.success {
    color: #166534;
}

#report-sprint-status.error {
    color: #991b1b;
}

#report-demo-status.success {
    color: #166534;
}

#report-demo-status.error {
    color: #991b1b;
}

.report-protocol-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-protocol-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 12px;
    display: grid;
    gap: 8px;
}

.report-protocol-card h3 {
    margin: 0;
    font-size: 0.95rem;
    color: #0f172a;
}

.report-protocol-card ul {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
}

.report-protocol-note {
    font-size: 0.82rem;
    color: #475569;
    font-weight: 650;
    line-height: 1.35;
}

.report-role-controls {
    margin-top: 10px;
}

.report-role-controls select {
    border: 1px solid rgba(148, 163, 184, 0.45);
    border-radius: 10px;
    background: #ffffff;
    color: #0f172a;
    padding: 8px 10px;
    font-size: 0.92rem;
    font-weight: 650;
}

.report-role-pathway {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-role-dashboard {
    margin-top: 10px;
}

.report-role-dashboard-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.report-role-dashboard-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
}

.report-role-dashboard-card h3 {
    margin: 0;
    font-size: 0.86rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: #334155;
}

.report-role-dashboard-card ul {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.83rem;
    font-weight: 650;
    line-height: 1.3;
}

.report-role-summary {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
    color: #1f2937;
    font-weight: 650;
}

.report-role-steps {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-role-step {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 8px;
}

.report-role-phase {
    font-size: 0.84rem;
    font-weight: 850;
    color: #0f172a;
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.report-role-move {
    font-size: 0.86rem;
    color: #334155;
    font-weight: 650;
    line-height: 1.35;
}

.report-role-link {
    justify-self: start;
}

.report-role-note {
    font-size: 0.86rem;
    color: #334155;
    font-weight: 650;
}

.report-class-block-grid {
    margin-top: 10px;
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
}

.report-class-block-card {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 7px;
}

.report-class-block-head {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    align-items: baseline;
}

.report-class-block-title {
    font-size: 1rem;
    font-weight: 900;
    color: #0f172a;
}

.report-class-block-meta {
    font-size: 0.8rem;
    color: #475569;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.report-class-block-summary {
    color: #334155;
    font-weight: 650;
    font-size: 0.86rem;
    line-height: 1.35;
}

.report-class-block-steps {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.84rem;
    font-weight: 650;
}

.report-class-block-actions {
    display: inline-flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.report-timeline {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-timeline-list {
    display: grid;
    gap: 8px;
}

.report-timeline-item {
    border: 1px solid rgba(148, 163, 184, 0.32);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 5px;
}

.report-timeline-item-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    color: #475569;
    font-weight: 700;
}

.report-timeline-track {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    padding: 2px 8px;
    border: 1px solid rgba(59, 130, 246, 0.34);
    background: rgba(219, 234, 254, 0.75);
    color: #1d4ed8;
    font-size: 0.74rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-weight: 900;
}

.report-timeline-track.numeracy {
    border-color: rgba(14, 165, 233, 0.35);
    background: rgba(224, 242, 254, 0.72);
    color: #0c4a6e;
}

.report-timeline-track.manual {
    border-color: rgba(168, 85, 247, 0.35);
    background: rgba(243, 232, 255, 0.75);
    color: #6b21a8;
}

.report-timeline-event {
    color: #0f172a;
    font-weight: 800;
    line-height: 1.35;
}

.report-timeline-note {
    color: #334155;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
}

.report-sprint-board {
    margin-top: 10px;
    display: grid;
    gap: 10px;
}

.report-sprint-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.report-sprint-item {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
}

.report-sprint-item-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    color: #475569;
    font-weight: 700;
}

.report-sprint-title {
    color: #0f172a;
    font-weight: 850;
    line-height: 1.3;
}

.report-sprint-move {
    color: #334155;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
}

.report-sprint-meta {
    color: #475569;
    font-size: 0.8rem;
    font-weight: 700;
}

.report-sprint-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    flex-wrap: wrap;
}

.report-sprint-state {
    font-size: 0.78rem;
    font-weight: 800;
    color: #475569;
}

.report-sprint-item.is-done {
    border-color: rgba(34, 197, 94, 0.45);
    background: rgba(240, 253, 244, 0.9);
}

.report-sprint-item.is-done .report-sprint-title {
    text-decoration: line-through;
    text-decoration-thickness: 1.5px;
    color: #166534;
}

.report-sprint-item.is-done .report-sprint-state {
    color: #166534;
}

.report-sprint-lane-pill {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    padding: 2px 8px;
    font-size: 0.72rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    border: 1px solid rgba(148, 163, 184, 0.35);
}

.report-sprint-lane-red {
    border-color: rgba(239, 68, 68, 0.45);
    background: rgba(254, 242, 242, 0.92);
    color: #991b1b;
}

.report-sprint-lane-yellow {
    border-color: rgba(245, 158, 11, 0.45);
    background: rgba(255, 251, 235, 0.92);
    color: #92400e;
}

.report-sprint-lane-green {
    border-color: rgba(34, 197, 94, 0.45);
    background: rgba(240, 253, 244, 0.92);
    color: #166534;
}

.report-sprint-evidence {
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.84);
    padding: 10px 12px;
}

.report-sprint-evidence-title {
    color: #0f172a;
    font-size: 0.88rem;
    font-weight: 850;
}

.report-sprint-evidence ul {
    margin: 8px 0 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-size: 0.83rem;
    font-weight: 650;
    line-height: 1.35;
}

.report-heatmap-wrap {
    width: 100%;
    overflow-x: auto;
    margin-top: 10px;
}

.report-heatmap {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    min-width: 980px;
}

.report-heatmap th,
.report-heatmap td {
    border: 1px solid rgba(148, 163, 184, 0.32);
    padding: 8px 10px;
    text-align: center;
    font-weight: 700;
}

.report-heatmap th:first-child,
.report-heatmap td:first-child {
    text-align: left;
    min-width: 230px;
}

.report-heatmap thead th {
    position: sticky;
    top: 0;
    background: #f8fafc;
    z-index: 1;
    font-size: 0.84rem;
    color: #334155;
}

.report-standard-note {
    margin-top: 3px;
    font-size: 0.78rem;
    color: #64748b;
    font-weight: 650;
}

.heat-cell.heat-high {
    background: #dcfce7;
    color: #166534;
}

.heat-cell.heat-mid {
    background: #fef3c7;
    color: #92400e;
}

.heat-cell.heat-low {
    background: #fee2e2;
    color: #991b1b;
}

.heat-cell.heat-empty {
    background: #f8fafc;
    color: #64748b;
}

@media print {
    body.report-page {
        background: #ffffff !important;
        padding-bottom: 0;
    }

    body.report-page::before {
        display: none !important;
    }

    body.report-page header,
    body.report-page .report-actions,
    body.report-page .learner-switcher,
    body.report-page .header-actions {
        display: none !important;
    }

    body.report-page .report-main {
        max-width: 100%;
        width: 100%;
        padding: 0;
    }

    body.report-page .report-card {
        box-shadow: none;
        border-color: #cbd5e1;
        break-inside: avoid;
        page-break-inside: avoid;
    }

    body.report-page .report-heatmap {
        min-width: 0;
    }

    body.report-page .report-builder-controls .primary-btn,
    body.report-page .report-builder-controls .secondary-btn,
    body.report-page #report-share-copy {
        display: none !important;
    }
}

@media (max-width: 900px) {
    .home-hero {
        grid-template-columns: 1fr;
    }

    body.home-page.home-details-collapsed .home-hero {
        min-height: auto;
    }

    .home-role-picker {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .home-learner-edit-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 560px) {
    .home-role-picker {
        grid-template-columns: 1fr;
    }
}


.warmup-panel {
    display: none !important;
}

body.hide-ipa .phoneme-ipa {
    display: none;
}

body.hide-examples .phoneme-example {
    display: none;
}

body.hide-mouth-cues #mouth-cue,
body.hide-mouth-cues #mouth-description {
    display: none;
}

/* HEADER - Integrated seamless design */
header {
    width: 100%; 
    max-width: var(--page-max); 
    padding: 14px 16px 8px;
    background: transparent;
    border: none;
    flex-shrink: 0;
    position: relative;
    z-index: 210;
}

.header-top { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    gap: 12px;
    margin-bottom: 10px; 
    flex-wrap: wrap;
}

h1 { 
    font-family: var(--font-heading); 
    font-size: 1.75rem; 
    color: #0f172a;
    font-weight: 700;
    letter-spacing: 0.2px;
}

.header-top h1::after,
.cloze-header h1::after,
.comp-header h1::after,
.fluency-header h1::after,
.madlibs-header h1::after {
    content: '';
    display: inline-block;
    width: 10px;
    height: 10px;
    margin-left: 8px;
    border-radius: 999px;
    background: var(--brand-accent);
}

h2,
h3,
.modal-content h2 {
    font-family: var(--font-heading);
    letter-spacing: 0.15px;
}

.header-actions { 
    display: flex; 
    gap: 10px; 
    align-items: center;
    flex-wrap: wrap;
    overflow-x: visible;
    row-gap: 8px;
    max-width: 100%;
    position: relative;
    z-index: 220;
}

.header-actions::-webkit-scrollbar {
    display: none;
}

.learner-switcher {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-left: 4px;
}

.learner-switcher-label {
    font-size: 0.78rem;
    font-weight: 800;
    color: #475569;
}

.learner-switcher-select {
    border: 1px solid rgba(148, 163, 184, 0.45);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.92);
    color: #0f172a;
    padding: 6px 10px;
    font-weight: 700;
    font-size: 0.82rem;
    min-width: 132px;
}

.learner-manage-btn {
    padding: 6px 10px !important;
    font-size: 0.8rem !important;
}

.student-mode-exit-btn {
    margin-left: 6px;
    border-radius: 10px !important;
    border: 1px solid rgba(248, 113, 113, 0.5) !important;
    background: rgba(254, 226, 226, 0.92) !important;
    color: #991b1b !important;
    font-weight: 800;
}

.student-mode-exit-btn:hover,
.student-mode-exit-btn:focus-visible {
    background: rgba(254, 202, 202, 0.96) !important;
    border-color: rgba(239, 68, 68, 0.6) !important;
    color: #7f1d1d !important;
}

.nav-group {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    max-width: 100%;
    padding: 0;
    border-radius: 0;
    background: transparent;
    border: none;
    box-shadow: none;
    backdrop-filter: none;
}

.nav-group::before {
    display: none;
}

.nav-group-modes {
    flex: 0 1 auto;
}

.nav-group-tools {
    margin-left: auto;
}

.nav-group + .nav-group {
    margin-left: 0;
}

.nav-group .link-btn,
.nav-group #teacher-btn,
.nav-group #howto-btn {
    border: 1px solid transparent;
    background: transparent;
    box-shadow: none;
    padding: 6px 12px;
    font-size: 0.86rem;
    font-weight: 700;
}

.nav-group .link-btn:hover,
.nav-group #teacher-btn:hover,
.nav-group #howto-btn:hover {
    background: rgba(79, 70, 229, 0.08);
    border-color: rgba(99, 102, 241, 0.35);
}

.nav-group .link-btn.active,
.nav-group .link-btn[aria-current="page"],
.nav-group #teacher-btn.active,
.nav-group #howto-btn.active {
    background: rgba(99, 102, 241, 0.18);
    color: #0f172a;
    border-color: rgba(99, 102, 241, 0.4);
    box-shadow: none;
}

@media (max-width: 900px) {
    .link-btn,
    #teacher-btn {
        padding: 6px 10px;
        font-size: 0.85rem;
    }

    #howto-btn {
        padding: 6px 8px;
    }

    .nav-group {
        width: 100%;
        justify-content: flex-start;
        padding: 0;
        background: transparent;
        border: none;
    }

    .nav-group::before {
        display: none;
    }

    .nav-group-tools {
        margin-left: 0;
    }

    .header-actions {
        flex-wrap: wrap;
        overflow-x: visible;
    }
}

.more-tools-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.more-tools-menu {
    position: absolute;
    top: calc(100% + 6px);
    right: 0;
    background: #ffffff;
    border: 1px solid rgba(148, 163, 184, 0.25);
    border-radius: 14px;
    box-shadow: 0 14px 28px rgba(15, 23, 42, 0.14);
    min-width: 220px;
    padding: 10px;
    display: grid;
    gap: 6px;
    z-index: 1400;
}

.more-tools-menu.hidden {
    display: none;
}

.more-tools-item {
    width: 100%;
    text-align: left;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.2);
    background: #f8fafc;
    cursor: pointer;
    font-weight: 700;
    color: #111827;
}

.more-tools-item:hover {
    background: #eef2ff;
    border-color: rgba(99, 102, 241, 0.35);
}

.more-tools-toggle {
    display: flex;
    gap: 8px;
    align-items: center;
}

.more-tools-toggle input {
    width: 16px;
    height: 16px;
}

/* Bright Lab surface styling */
.modal,
#teacher-modal,
.classroom-dock,
.cloze-panel,
.comp-panel,
.fluency-panel,
.madlibs-panel,
.sound-guide-card,
.sound-guide-board,
.selected-sound,
.adventure-card,
.adventure-team-settings {
    background: var(--lab-card);
    border: 1px solid var(--lab-border);
    border-radius: var(--lab-radius);
    box-shadow: var(--lab-shadow);
}

.cloze-panel,
.comp-panel,
.fluency-panel,
.madlibs-panel,
.sound-guide-card,
.sound-guide-board,
.selected-sound,
.adventure-card,
.adventure-team-settings {
    position: relative;
    overflow: hidden;
}

.cloze-panel::after,
.comp-panel::after,
.fluency-panel::after,
.madlibs-panel::after,
.sound-guide-card::after,
.sound-guide-board::after,
.selected-sound::after,
.adventure-card::after,
.adventure-team-settings::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--panel-accent);
    opacity: 0.78;
    pointer-events: none;
}

.text-btn { 
    background: #f5f5f5; 
    border: 1px solid #d0d0d0; 
    padding: 6px 12px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-weight: 500; 
    font-family: var(--font-body);
    font-size: 0.9rem;
    transition: all 0.2s;
    color: #555;
}

.link-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 999px;
    border: 1px solid var(--lab-border);
    background: #ffffff;
    color: #1f2937;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all 0.2s;
    box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
}

.header-actions .link-btn {
    background: transparent;
    border: 1px solid transparent;
    box-shadow: none;
    padding: 6px 10px;
    border-radius: 12px;
    white-space: nowrap;
}

.header-actions .link-btn:hover {
    background: rgba(79, 70, 229, 0.08);
    border-color: rgba(99, 102, 241, 0.25);
    color: #0f172a;
    transform: none;
}

.header-actions .link-btn.active,
.header-actions .link-btn[aria-current="page"] {
    background: rgba(99, 102, 241, 0.16);
    border-color: rgba(99, 102, 241, 0.35);
    color: #0f172a;
}

.header-actions .link-btn.active:hover,
.header-actions .link-btn[aria-current="page"]:hover {
    color: #0f172a;
}

.nav-current-chip {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    border: 1px solid rgba(99, 102, 241, 0.28);
    background: rgba(224, 231, 255, 0.82);
    color: #312e81;
    font-size: 0.78rem;
    font-weight: 850;
    padding: 6px 10px;
    white-space: nowrap;
}

#howto-btn {
    padding: 6px 10px;
    font-size: 0.85rem;
}

.page-guide-tip {
    margin: 8px auto 10px;
    width: min(100%, 1120px);
    border: 1px solid rgba(99, 102, 241, 0.24);
    border-radius: 14px;
    background: linear-gradient(135deg, rgba(239, 246, 255, 0.92), rgba(238, 242, 255, 0.9));
    box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
    padding: 10px 12px;
    display: grid;
    gap: 6px;
}

.page-guide-tip-title {
    font-size: 0.9rem;
    font-weight: 900;
    color: #1e3a8a;
}

.page-guide-tip-body {
    color: #334155;
    font-size: 0.88rem;
    font-weight: 650;
    line-height: 1.38;
}

.page-guide-tip-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.link-btn:hover {
    background: rgba(79, 70, 229, 0.08);
    border-color: rgba(99, 102, 241, 0.45);
    transform: translateY(-1px);
}

.link-btn.ghost {
    background: rgba(99, 102, 241, 0.08);
    border-color: rgba(99, 102, 241, 0.25);
    box-shadow: none;
    padding: 7px 14px;
    font-size: 0.85rem;
}

.link-btn.ghost:hover {
    background: rgba(99, 102, 241, 0.15);
    transform: translateY(-1px);
}

#teacher-btn {
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid transparent;
    background: transparent;
    color: #1f2937;
    font-weight: 700;
    cursor: pointer;
    box-shadow: none;
}

#teacher-btn:hover {
    background: rgba(79, 70, 229, 0.08);
    border-color: rgba(99, 102, 241, 0.35);
}

.text-btn:hover {
    background: #e8e8e8;
    border-color: #b0b0b0;
}

.icon-btn { 
    background: none; 
    border: none; 
    font-size: 1.3rem; 
    cursor: pointer; 
    padding: 4px;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.icon-btn:hover {
    opacity: 1;
}

/* Game Setup Controls - Grouped visually */
.controls { 
    display: grid;
    grid-template-columns: minmax(240px, 2fr) minmax(160px, 1fr);
    gap: 12px; 
    align-items: end;
    margin-bottom: 6px;
    padding: 4px 2px;
    border-radius: 0;
    background: transparent;
    border: none;
    box-shadow: none;
}

@media (max-width: 700px) {
    .controls {
        grid-template-columns: 1fr;
    }
    .header-actions {
        width: 100%;
        justify-content: flex-start;
    }
}

.control-group { 
    display: flex; 
    flex-direction: column; 
    font-size: 0.75rem;
    color: var(--text-subtle);
}

.control-group label {
    margin-bottom: 3px;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
}

.control-group-subtle {
    opacity: 0.9;
}

.control-group-subtle label {
    letter-spacing: 0.05em;
    font-size: 0.69rem;
}

.case-toggle-btn {
    border: 1px solid var(--lab-border);
    border-radius: 11px;
    background: #ffffff;
    color: #0f172a;
    min-width: 62px;
    min-height: 37px;
    padding: 6px 12px;
    font-size: 0.92rem;
    font-weight: 800;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
}

.case-toggle-btn:hover {
    border-color: rgba(99, 102, 241, 0.5);
    background: #f8fafc;
}

select { 
    padding: 8px 12px; 
    border-radius: 12px; 
    border: 1px solid var(--lab-border); 
    font-size: 0.95rem; 
    font-family: var(--font-body);
    background: #ffffff;
    cursor: pointer;
    width: 100%; /* Stay in grid column */
    max-width: 100%;
    box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
}

#pattern-select {
    min-width: 260px;
}

select:focus {
    outline: 2px solid rgba(99, 102, 241, 0.85);
    outline-offset: 2px;
}

input[type="text"],
input[type="number"],
textarea {
    border-radius: 12px;
    border: 1px solid var(--lab-border);
    background: #ffffff;
    color: var(--color-text);
    font-family: var(--font-body);
    box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
}

/* Improved grade band visibility in dropdowns */
optgroup {
    font-weight: 700;
    font-size: 0.95rem;
    color: #2c3e50;
    background: #f5f5f5;
    padding: 8px 4px 4px 4px;
    margin-top: 6px;
}

optgroup:first-child {
    margin-top: 0;
}

option {
    padding: 6px 8px;
    font-weight: 400;
    color: #444;
}

option:checked {
    background: var(--color-correct);
    color: white;
}

#new-word-btn { 
    background: #2c3e50; 
    color: white; 
    border: none; 
    padding: 8px 16px; 
    border-radius: 6px; 
    font-weight: 600; 
    cursor: pointer;
    transition: background 0.2s;
}

#new-word-btn:hover {
    background: #1a252f;
}

/* Focus Panel - ONE clean card with clear hierarchy */
/* Focus Toggle Button */
.focus-toggle-btn {
    background: var(--color-correct);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 600;
    margin: 12px auto 0;
    display: block;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.focus-toggle-btn:hover {
    background: #27ae60;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.focus-toggle-btn.expanded {
    background: #666;
}

.focus-toggle-btn.expanded:hover {
    background: #555;
}

/* Focus Panel - Collapsible */
.focus-panel { 
    position: relative;
    width: 100%;
    max-width: 900px;
    background: white; 
    padding: 14px 16px; 
    border-radius: 12px; 
    border: 2px solid #667eea; 
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    margin: 0 auto 12px;
    transition: all 0.3s ease;
    opacity: 1;
}

.focus-panel.hidden {
    display: none;
}


.focus-main {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    margin-bottom: 12px;
}

.focus-left {
    flex: 1;
}

.focus-title {
    font-size: 1.05rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 4px;
}

.focus-desc {
    font-size: 0.9rem;
    color: #555;
    line-height: 1.4;
    margin-bottom: 4px;
}

.focus-hint-text {
    font-size: 0.85rem;
    color: #777;
    font-style: italic;
}

.focus-right {
    flex-shrink: 0;
    display: flex;
    align-items: flex-start;
}

.focus-examples-text {
    font-size: 0.85rem;
    color: #888;
    font-style: italic;
    text-align: right;
}

.focus-actions {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding-top: 10px;
    border-top: 1px solid #f0f0f0;
    font-size: 0.9rem;
}

/* New adaptive action row */
.focus-actions-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding-top: 12px;
    border-top: 1px solid #e0e0e0;
    flex-wrap: wrap;
}

.focus-action-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
}

/* Simple audio play buttons */
.audio-play-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 600;
    margin: 0 6px;
    box-shadow: 0 3px 8px rgba(102, 126, 234, 0.4);
    transition: all 0.2s;
}

.audio-play-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 12px rgba(102, 126, 234, 0.5);
}

.audio-play-btn:active {
    transform: translateY(0);
}

.focus-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
}

.focus-action-btn:active {
    transform: translateY(0);
}

.focus-action-separator {
    color: #ccc;
}

/* Warm-up panel */
.warmup-panel {
    display: none;
}

.warmup-title {
    font-weight: 600;
    color: #475569;
    font-size: 0.95rem;
}

.warmup-subtitle {
    display: none;
}

.warmup-actions {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}

.warmup-btn {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    background: #f8fafc;
    color: #1f2937;
    font-weight: 600;
    cursor: pointer;
}

.warmup-quick {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.warmup-tile {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    background: #ffffff;
    font-weight: 700;
    cursor: pointer;
}

.warmup-tile:hover {
    border-color: #667eea;
    box-shadow: 0 2px 6px rgba(102, 126, 234, 0.25);
}


/* UNIFIED GAME CANVAS - Board + Keyboard centered together */
#game-canvas {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    width: calc(100% - 32px);
    max-width: 680px;
    margin: 10px 16px 18px;
    padding: 18px 16px 16px;
    gap: 16px; /* Intentional: keep Word Quest + keyboard feeling like one board */
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

#game-canvas::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
        radial-gradient(circle at 18% 12%, rgba(56, 189, 248, 0.18), transparent 46%),
        radial-gradient(circle at 86% 10%, rgba(249, 115, 22, 0.12), transparent 44%),
        radial-gradient(circle at 50% 88%, rgba(99, 102, 241, 0.10), transparent 50%);
    pointer-events: none;
    z-index: 0;
}

#game-canvas::after {
    content: '';
    position: absolute;
    top: 0;
    left: 12px;
    right: 12px;
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(99, 102, 241, 0.92), rgba(14, 165, 233, 0.82), rgba(249, 115, 22, 0.62));
    opacity: 0.85;
    pointer-events: none;
    z-index: 0;
}

#game-canvas > * {
    position: relative;
    z-index: 1;
}

main { 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    width: 100%; 
    padding: 0;
    margin: 0;
}

/* GAME BOARD - Responsive scaling */
#game-board { 
    display: grid; 
    gap: 8px; 
    justify-content: center; 
    padding: 14px;
    border-radius: 22px;
    background: linear-gradient(180deg, rgba(148, 163, 184, 0.16) 0%, rgba(148, 163, 184, 0.08) 100%);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.75);
}

/* TILES - Scale with viewport, not fixed */
.tile {
    width: min(72px, 12vw, 9.2vh);
    height: min(72px, 12vw, 9.2vh);
    border: 2px solid rgba(100, 116, 139, 0.55);
    display: flex; 
    justify-content: center; 
    align-items: center;
    font-family: var(--font-body); 
    font-size: min(2.4rem, 5.4vw, 5vh);
    font-weight: 800;
    border-radius: 14px; 
    background: linear-gradient(180deg, #ffffff 0%, #f1f5ff 100%);
    color: #0f172a;
    transition: transform 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    box-shadow:
                0 12px 26px rgba(15, 23, 42, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.85),
                inset 0 -2px 0 rgba(15, 23, 42, 0.06);
    transform: translateZ(0);
}

.tile.row-active:not(.correct):not(.present):not(.absent) {
    border-color: rgba(79, 70, 229, 0.55);
    background: linear-gradient(180deg, rgba(224, 231, 255, 1) 0%, rgba(255, 255, 255, 0.95) 100%);
    box-shadow:
        0 14px 30px rgba(79, 70, 229, 0.14),
        inset 0 1px 0 rgba(255, 255, 255, 0.9),
        inset 0 -2px 0 rgba(15, 23, 42, 0.06);
}

.tile.active { 
    border-color: rgba(79, 70, 229, 0.85); 
    animation: pulse 0.1s; 
    transform: scale(1.05) translateY(-2px);
    box-shadow: 0 10px 18px rgba(79, 70, 229, 0.2);
}

.tile.pop { 
    animation: pop 0.3s; 
}

/* COLORS - Soft, clear feedback with depth */
.tile.correct { 
    background: var(--color-correct);
    border-color: var(--color-correct); 
    color: #0b1220;
    box-shadow: 0 4px 8px rgba(46, 204, 113, 0.4),
                0 2px 4px rgba(0,0,0,0.1),
                inset 0 -2px 0 rgba(0,0,0,0.2);
}

.tile.present { 
    background: var(--color-present);
    border-color: var(--color-present); 
    color: #0b1220;
    box-shadow: 0 4px 8px rgba(241, 196, 15, 0.4),
                0 2px 4px rgba(0,0,0,0.1),
                inset 0 -2px 0 rgba(0,0,0,0.2);
}

.tile.absent { 
    background: var(--color-absent);
    border-color: var(--color-absent); 
    color: white;
    box-shadow: 0 4px 8px rgba(52, 73, 94, 0.3),
                0 2px 4px rgba(0,0,0,0.1),
                inset 0 -2px 0 rgba(0,0,0,0.2);
}

/* ANIMATIONS - Gentle, not jarring */
@keyframes pulse { 
    0% { transform: scale(1); } 
    50% { transform: scale(1.05); } 
    100% { transform: scale(1); } 
}

@keyframes pop { 
    0% { transform: scale(0.9); opacity: 0.7; } 
    40% { transform: scale(1.08); } 
    100% { transform: scale(1); opacity: 1; } 
}

/* QUICK TILES - Minimal spacing */
.quick-row { 
    display: flex; 
    gap: 8px; 
    margin-bottom: 12px; 
    flex-wrap: wrap; 
    justify-content: center; 
    min-height: 0;
}

.q-tile { 
    background: #e3f2fd; 
    border: 1px solid #90caf9; 
    padding: 6px 14px; 
    border-radius: 6px; 
    font-weight: 600; 
    cursor: pointer; 
    font-size: 0.95rem; 
    color: #1565c0; 
    font-family: var(--font-body);
    transition: all 0.2s;
}

.q-tile:hover { 
    background: #bbdefb;
    transform: translateY(-1px);
}

/* KEYBOARD - Scales with tiles */
#keyboard { 
    width: 100%; 
    display: flex; 
    flex-direction: column; 
    gap: 6px; 
    max-width: 600px;
    margin-bottom: 12px;
    padding-bottom: env(safe-area-inset-bottom, 0);
    padding: 10px 10px 12px;
    border-radius: 18px;
    background: linear-gradient(180deg, rgba(148, 163, 184, 0.14) 0%, rgba(148, 163, 184, 0.08) 100%);
    border: 1px solid rgba(100, 116, 139, 0.22);
}

.keyboard-row { 
    display: flex; 
    justify-content: center; 
    gap: 4px; 
}

.key { 
    height: min(54px, 9vw, 7.6vh);
    flex: 1; 
    max-width: 58px;
    border-radius: 12px; 
    border: 1px solid rgba(100, 116, 139, 0.45);
    background: linear-gradient(180deg, #ffffff 0%, #eef2ff 100%);
    cursor: pointer; 
    font-weight: 800; 
    font-size: min(1.15rem, 3.4vw, 3.4vh);
    display: flex; 
    justify-content: center; 
    align-items: center; 
    font-family: var(--font-body); 
    color: #0f172a;
    touch-action: manipulation;
    box-shadow: 
        0 4px 0 0 rgba(148, 163, 184, 0.55),
        0 10px 18px rgba(15, 23, 42, 0.12);
    transition: all 0.1s;
    position: relative;
    top: 0;
}

.key:hover {
    background: linear-gradient(180deg, #ffffff 0%, #e0e7ff 100%);
    transform: translateY(-2px);
    box-shadow: 
        0 6px 0 0 rgba(148, 163, 184, 0.55),
        0 12px 20px rgba(15, 23, 42, 0.18);
}

.key:active {
    transform: translateY(2px);
    box-shadow: 
        0 1px 0 0 rgba(148, 163, 184, 0.5),
        0 2px 4px rgba(15, 23, 42, 0.12);
    top: 2px;
}

/* Key press feedback animation */
.key-pressed {
    transform: translateY(4px) !important;
    box-shadow: 
        0 0 0 0 #a8a8a8,
        0 1px 3px rgba(0,0,0,0.2) !important;
    transition: all 0.05s !important;
}

/* Absent/Gray keys - Much more visible with better contrast */
.key.absent {
    background: linear-gradient(180deg, #4a4a4c 0%, #3a3a3c 100%) !important;
    color: #e2e8f0 !important;
    opacity: 0.85;
    border: 2px solid #2a2a2c;
    box-shadow: 
        0 4px 0 0 #2a2a2c,
        0 4px 8px rgba(0,0,0,0.3);
    font-weight: 600;
}

.key.absent:hover {
    background: linear-gradient(180deg, #4a4a4c 0%, #3a3a3c 100%) !important;
}

.key.correct {
    background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
    border-color: #15803d;
    color: #ffffff;
    box-shadow: 0 4px 0 0 #166534, 0 8px 16px rgba(34, 197, 94, 0.32);
}

.key.present {
    background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 100%);
    border-color: #d97706;
    color: #1f2937;
    box-shadow: 0 4px 0 0 #b45309, 0 8px 16px rgba(245, 158, 11, 0.28);
}


.key.wide { 
    flex: 1.7;
    min-width: 78px;
    max-width: 120px;
    padding: 0 10px;
    font-size: 0.82rem;
    letter-spacing: 0.08em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

@media (max-width: 420px) {
    .key.wide {
        min-width: 62px;
        padding: 0 8px;
        font-size: 0.74rem;
        letter-spacing: 0.05em;
    }
}

.key.vowel:not(.correct):not(.present):not(.absent) { 
    background: linear-gradient(180deg, #dbeafe 0%, #bfdbfe 100%); 
    border: 2px solid #5b8ff7; 
    color: #0f172a;
    box-shadow: 0 4px 0 0 #9fb8e8, 0 4px 10px rgba(15, 23, 42, 0.15);
}

/* MODALS - Clean, focused */
.hidden { display: none !important; }

#modal-overlay { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(15, 23, 42, 0.35); 
    z-index: 999; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
}

.modal { 
    position: fixed; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); 
    background: white; 
    padding: 24px; 
    border-radius: 12px; 
    width: 90%; 
    max-width: 420px; 
    max-height: 85vh;
    overflow-y: auto;
    z-index: 1000; 
    box-shadow: 0 8px 32px rgba(0,0,0,0.2); 
    text-align: center; 
}

.placement-modal {
    max-width: min(720px, calc(100vw - 32px));
    text-align: left;
}

.placement-modal .modal-content {
    text-align: left;
}

.placement-grid {
    margin-top: 12px;
    display: grid;
    gap: 12px;
}

.placement-field label {
    display: block;
    font-weight: 850;
    color: #0f172a;
    margin-bottom: 6px;
}

.placement-field select {
    width: 100%;
}

.placement-fieldset {
    border: 1px solid rgba(148, 163, 184, 0.55);
    border-radius: 16px;
    padding: 12px 12px 10px;
    background: rgba(248, 250, 252, 0.92);
}

.placement-fieldset legend {
    font-weight: 950;
    letter-spacing: 0.04em;
    padding: 0 6px;
    color: #0f172a;
}

.placement-check {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    padding: 6px 8px;
    border-radius: 12px;
    font-weight: 650;
    color: #334155;
}

.placement-check:hover {
    background: rgba(99, 102, 241, 0.08);
}

.placement-check input {
    margin-top: 3px;
}

.placement-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 14px;
}

.placement-result {
    margin-top: 12px;
    padding: 12px 14px;
    border-radius: 16px;
    border: 1px solid rgba(99, 102, 241, 0.22);
    background: rgba(224, 231, 255, 0.55);
    box-shadow: 0 10px 18px rgba(15, 23, 42, 0.06);
}

.placement-result-title {
    font-weight: 950;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-size: 0.78rem;
    color: #4338ca;
}

.placement-result-main {
    margin-top: 6px;
    font-size: 1.05rem;
    font-weight: 750;
    color: #0f172a;
}

#phoneme-modal {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: min(1180px, calc(100vw - 32px));
    width: min(1180px, calc(100vw - 32px));
    max-height: calc(100dvh - 32px);
    height: min(860px, calc(100dvh - 32px));
    overflow: hidden;
    resize: both;
    min-width: 320px;
    min-height: 360px;
    padding: 0;
    text-align: left;
}

#phoneme-modal .modal-content {
    max-width: none;
    height: 100%;
    overflow: hidden;
    padding: 16px 16px 18px;
    display: flex;
    flex-direction: column;
}

#phoneme-modal .sound-guide-layout {
    flex: 1;
    min-height: 0;
    height: 100%;
    overflow: hidden;
}

#phoneme-modal.phoneme-narrow .sound-guide-layout {
    grid-template-columns: 1fr;
}

#phoneme-modal.phoneme-narrow .sound-guide-card {
    position: relative;
    top: 0;
}

#phoneme-modal.phoneme-short .sound-card-actions {
    grid-template-columns: 1fr;
}

.modal-content {
    position: relative;
}

.modal .close-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: transparent;
    border: none;
    font-size: 1.6rem;
    cursor: pointer;
    color: #6b7280;
}

.howto-modal {
    max-width: 640px;
    width: min(92vw, 640px);
}

.howto-content {
    text-align: left;
    line-height: 1.5;
}

.howto-subtitle {
    color: var(--text-subtle);
    margin-bottom: 12px;
}

.howto-section {
    background: rgba(99, 102, 241, 0.08);
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 12px;
}

.howto-section h3 {
    margin-bottom: 6px;
}

.howto-section ul {
    margin-left: 18px;
    display: grid;
    gap: 8px;
}

.howto-section li {
    line-height: 1.4;
}

.howto-section .howto-tile {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 8px;
    margin-right: 6px;
    font-size: 0.85rem;
    font-weight: 700;
    border: 1px solid rgba(15, 23, 42, 0.15);
    box-shadow: inset 0 -2px 0 rgba(15, 23, 42, 0.12);
    vertical-align: middle;
}

/* Ensure the in-line example tiles are always visibly colored (projector-safe). */
.howto-section .howto-tile.correct {
    background: var(--color-correct);
    border-color: transparent;
    color: #ffffff;
}

.howto-section .howto-tile.present {
    background: var(--color-present);
    border-color: transparent;
    color: #1f2937;
}

.howto-section .howto-tile.absent {
    background: var(--color-absent);
    border-color: transparent;
    color: #ffffff;
}

.adventure-modal {
    max-width: 720px;
    width: min(92vw, 720px);
}

.adventure-content {
    text-align: left;
}

.adventure-subtitle {
    color: #64748b;
    margin-bottom: 14px;
}

.adventure-grid {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    margin-bottom: 16px;
}

.adventure-card {
    border: 1px solid rgba(148, 163, 184, 0.4);
    border-radius: 14px;
    padding: 12px;
    background: rgba(248, 250, 252, 0.9);
    display: flex;
    gap: 10px;
    align-items: flex-start;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.adventure-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(15, 23, 42, 0.15);
}

.adventure-card input {
    margin-top: 4px;
}

.adventure-card-body h3 {
    margin: 0 0 6px;
    font-size: 1rem;
    color: #1f2937;
}

.adventure-card-body p {
    margin: 0;
    color: #6b7280;
    font-size: 0.9rem;
}

.adventure-timer-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    margin-top: 8px;
    font-size: 0.85rem;
    color: #475569;
}

.adventure-team-settings {
    background: rgba(99, 102, 241, 0.08);
    border-radius: 14px;
    padding: 12px;
    border: 1px solid rgba(99, 102, 241, 0.18);
    margin-bottom: 16px;
}

.adventure-note {
    font-size: 0.85rem;
    color: #64748b;
    margin: 8px 0 14px;
}

.adventure-team-row {
    display: grid;
    grid-template-columns: 80px 1fr;
    gap: 10px;
    align-items: center;
    margin-top: 8px;
}

.adventure-team-row input {
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
}

.adventure-active-team {
    font-weight: 700;
    color: #4338ca;
}

.adventure-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.assessment-feature-breakdown {
    margin-top: 10px;
}

.assessment-feature-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.assessment-feature-chip {
    background: rgba(99, 102, 241, 0.15);
    border: 1px solid rgba(99, 102, 241, 0.3);
    color: #4338ca;
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
}

.core-phonics-modal {
    max-width: 560px;
    width: min(92vw, 560px);
}

.core-phonics-content {
    text-align: left;
}

.core-phonics-controls {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 8px;
    align-items: center;
    margin-bottom: 12px;
}

.core-phonics-controls select {
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
}

.core-phonics-hud {
    display: flex;
    justify-content: space-between;
    background: rgba(15, 23, 42, 0.04);
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 12px;
    padding: 8px 12px;
    margin-bottom: 12px;
    font-weight: 600;
}

.core-phonics-card {
    background: #f8fafc;
    border-radius: 14px;
    border: 1px solid #e2e8f0;
    padding: 20px;
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 12px;
}

.core-phonics-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    flex-wrap: wrap;
}
.assessment-modal {
    max-width: 760px;
    width: min(92vw, 760px);
}

.assessment-content {
    text-align: left;
}

.assessment-subtitle {
    color: #64748b;
    margin-bottom: 16px;
}

.assessment-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 6px;
    margin-bottom: 12px;
}

.assessment-row label {
    font-weight: 600;
    color: #374151;
}

.assessment-row input,
.assessment-row select {
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    font-family: var(--font-body);
}

.assessment-setup .primary-btn {
    width: 100%;
}

.assessment-play {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.assessment-hud {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: space-between;
    background: rgba(15, 23, 42, 0.04);
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 12px;
    padding: 8px 12px;
    font-weight: 600;
}

.assessment-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.assessment-input-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    align-items: center;
}

.assessment-feedback {
    color: #6366f1;
    font-weight: 600;
}

.assessment-footer {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    flex-wrap: wrap;
}

.assessment-summary {
    margin-top: 8px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.assessment-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 8px;
}

.assessment-export {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.assessment-note {
    color: #64748b;
    font-size: 0.9rem;
}

@media (max-width: 640px) {
    .assessment-input-row {
        grid-template-columns: 1fr;
    }
}

.info-modal-content .close-btn {
    font-size: 1.2rem;
    top: 10px;
    right: 10px;
}

.top-right-x {
    position: absolute; 
    top: 12px; 
    right: 16px; 
    font-size: 1.8rem; 
    cursor: pointer;
    line-height: 1;
    color: #999;
    transition: color 0.2s;
}

/* Hide close button on welcome modal */
.modal.no-close-btn .top-right-x {
    display: none;
}

.top-right-x:hover { 
    color: #333; 
}

.modal-content h2 { 
    margin-bottom: 12px; 
    color: #2c3e50; 
    font-size: 1.6rem;
}

.modal-content p { 
    margin-bottom: 16px; 
    line-height: 1.5; 
    color: #555; 
}

.bonus-modal {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
}

.bonus-modal .close-btn {
    color: rgba(255,255,255,0.7);
}

.bonus-emoji {
    font-size: 3rem;
    margin-bottom: 8px;
}

.bonus-title {
    font-weight: 700;
    font-size: 1.3rem;
    margin-bottom: 10px;
}

.bonus-text {
    font-size: 1.05rem;
    line-height: 1.6;
}

/* ---------- Teacher modal layout ---------- */
#teacher-modal .modal-content {
    text-align: left;
    position: relative;
}

#teacher-modal {
    width: min(680px, 95vw);
    max-height: 92vh;
    overflow-y: auto;
    overflow-x: hidden;
    border-radius: 22px;
    background: linear-gradient(180deg, #ffffff 0%, #f2f5ff 100%);
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.2);
}

#teacher-modal h2 {
    text-align: center;
    margin-bottom: 12px;
}

#teacher-modal .teacher-intro-note {
    margin: -4px auto 12px;
    text-align: center;
    color: #475569;
    font-size: 0.9rem;
    font-weight: 620;
    max-width: 54ch;
}

#teacher-modal .close-teacher {
    position: absolute;
    top: 10px;
    right: 12px;
    background: transparent;
    border: none;
    font-size: 1.6rem;
    cursor: pointer;
    color: #6b7280;
}

#teacher-modal .teacher-block {
    margin-bottom: 12px;
}

#teacher-modal label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 6px;
    font-size: 0.9rem;
}

#teacher-modal .teacher-row {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 8px;
    align-items: start;
}

#teacher-modal .teacher-launchpad-row {
    grid-template-columns: minmax(150px, 190px) minmax(0, 1fr);
    gap: 10px;
    align-items: start;
    border: 1px solid rgba(99, 102, 241, 0.22);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.86);
    padding: 10px;
}

#teacher-modal .teacher-launchpad-controls {
    min-width: 0;
    display: grid;
    gap: 6px;
}

#teacher-modal .teacher-launchpad-controls label {
    margin: 0;
    font-size: 0.8rem;
    color: #334155;
}

#teacher-modal .teacher-launchpad-controls select {
    width: 100%;
    padding: 7px 9px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.55);
    background: #ffffff;
    font-size: 0.86rem;
}

#teacher-modal .teacher-action-buttons {
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 8px;
}

#teacher-modal .teacher-action-buttons .teacher-secondary-btn {
    width: 100%;
}

#teacher-modal .teacher-row > label {
    margin-bottom: 0;
}

#teacher-modal .teacher-row > .teacher-error,
#teacher-modal .teacher-row > .teacher-subtext {
    grid-column: 1 / -1;
}

#teacher-modal .teacher-row > div[style*="display:flex"] {
    min-width: 0;
}

@media (max-width: 560px) {
    #teacher-modal .teacher-row {
        grid-template-columns: 1fr;
    }
}

#teacher-modal .toggle-row select {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    background: #fff;
    font-size: 0.85rem;
}

#teacher-modal .teacher-secondary-btn {
    padding: 8px 12px;
    border-radius: 10px;
    border: 1px solid #cbd5f5;
    background: #eef2ff;
    color: #4338ca;
    font-weight: 600;
    cursor: pointer;
}

#teacher-modal .teacher-secondary-btn:hover {
    background: #e0e7ff;
}

#teacher-modal #custom-word-input {
    width: 100%;
    padding: 12px 14px;
    font-size: 1.05rem;
    border: 2px solid #d1d5db;
    border-radius: 10px;
    text-align: left;
    letter-spacing: 0.5px;
    font-family: var(--font-body);
}

#teacher-modal #custom-word-input.masked {
    -webkit-text-security: disc;
    text-security: disc;
}

#teacher-modal #toggle-mask {
    padding: 10px 12px;
    min-width: 64px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    background: #f3f4f6;
    font-weight: 600;
    cursor: pointer;
}

#teacher-modal .teacher-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 12px;
}

#teacher-modal .teacher-actions button {
    padding: 12px 14px;
    border-radius: 10px;
    font-weight: 600;
    font-family: var(--font-body);
    cursor: pointer;
    border: none;
}

#teacher-modal #set-word-btn {
    background: #2563eb;
    color: white;
}

#teacher-modal #open-studio-btn {
    background: #f3f4f6;
    color: #111827;
    border: 1px solid #d1d5db;
}

#teacher-modal #system-voice-select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    font-size: 0.95rem;
}

#teacher-modal .teacher-error {
    color: #b91c1c;
    font-size: 0.9rem;
    margin-top: 6px;
    min-height: 1.2em;
}

#teacher-modal .teacher-tools {
    border-top: 1px solid rgba(226, 232, 240, 0.9);
    padding: 10px 10px 12px;
    margin-top: 8px;
    background: rgba(255, 255, 255, 0.65);
    border-radius: 14px;
}

#teacher-modal.teacher-clean .teacher-block,
#teacher-modal.teacher-clean .teacher-tools {
    background: rgba(255, 255, 255, 0.75);
    border: 1px solid rgba(226, 232, 240, 0.9);
}

#teacher-modal.teacher-clean .teacher-block {
    padding: 10px 12px;
    border-radius: 14px;
}

#teacher-modal.teacher-clean .teacher-section {
    background: rgba(255, 255, 255, 0.78);
    border: 1px solid rgba(226, 232, 240, 0.9);
    border-radius: 14px;
    padding: 10px 12px;
}

#teacher-modal.teacher-clean .teacher-section summary {
    font-weight: 700;
    color: #334155;
}

#teacher-modal.teacher-clean .teacher-danger summary {
    color: #b91c1c;
}

#teacher-modal .teacher-tools summary {
    cursor: pointer;
    font-weight: 600;
    color: #374151;
    margin-bottom: 10px;
}

#teacher-modal .teacher-tools-grid {
    display: grid;
    gap: 8px;
}

#teacher-modal .toggle-row {
    display: flex;
    gap: 10px;
    align-items: center;
    font-size: 0.9rem;
    color: #1f2937;
}

#teacher-modal .toggle-row input[type="checkbox"] {
    width: 16px;
    height: 16px;
}

#teacher-modal .slider-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 10px;
    align-items: center;
}

#teacher-modal .teacher-voice-row {
    display: grid;
    gap: 6px;
    margin-bottom: 8px;
}

#teacher-modal .teacher-subtext {
    font-size: 0.85rem;
    color: #6b7280;
}

#teacher-modal .voice-pack-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

#teacher-modal .voice-pack-controls select {
    min-width: 190px;
    flex: 1 1 220px;
}

#teacher-modal #tts-pack-status[data-tone="warn"] {
    color: #92400e;
}

#teacher-modal #tts-pack-status[data-tone="error"] {
    color: #991b1b;
}

#teacher-modal .teacher-hint {
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 8px;
}

#teacher-modal .voice-delete-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 6px;
    margin-top: 10px;
}

.voice-install-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    margin-top: 8px;
    border-radius: 12px;
    background: #fef9c3;
    border: 1px solid #fde68a;
    font-size: 0.85rem;
    color: #78350f;
}

.voice-install-row.hidden {
    display: none;
}

.voice-install-row button {
    padding: 6px 10px;
    border-radius: 999px;
    border: none;
    background: #f59e0b;
    color: #ffffff;
    font-weight: 700;
    cursor: pointer;
    font-size: 0.8rem;
}

.voice-install-row button:hover {
    background: #d97706;
}

.voice-diagnostics-row {
    margin-top: 4px;
}

.voice-diagnostics-panel {
    display: grid;
    gap: 6px;
    padding: 10px 12px;
    border-radius: 12px;
    background: rgba(241, 245, 249, 0.95);
    border: 1px solid rgba(148, 163, 184, 0.5);
    color: #1f2937;
    font-size: 0.84rem;
    line-height: 1.35;
}

.voice-diagnostics-panel strong {
    color: #0f172a;
}

.voice-diagnostics-actions {
    margin-top: 4px;
}

.voice-diagnostics-actions .teacher-secondary-btn {
    font-size: 0.78rem;
    padding: 7px 10px;
}

.voice-health-check-status {
    margin-top: 6px;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(100, 116, 139, 0.35);
    background: rgba(241, 245, 249, 0.9);
    color: #334155;
    font-size: 0.78rem;
    line-height: 1.35;
    font-weight: 650;
}

.voice-health-check-status[data-tone="pass"] {
    border-color: rgba(16, 185, 129, 0.45);
    background: rgba(16, 185, 129, 0.12);
    color: #065f46;
}

.voice-health-check-status[data-tone="warn"] {
    border-color: rgba(245, 158, 11, 0.55);
    background: rgba(254, 243, 199, 0.86);
    color: #92400e;
}

.voice-health-check-status[data-tone="info"] {
    border-color: rgba(59, 130, 246, 0.45);
    background: rgba(219, 234, 254, 0.82);
    color: #1e3a8a;
}

#teacher-modal .teacher-tabs {
    display: flex;
    gap: 6px;
    justify-content: center;
    margin: 6px auto 12px;
    padding: 6px;
    background: rgba(226, 232, 240, 0.7);
    border-radius: 999px;
    width: fit-content;
}

#teacher-modal .teacher-tab-btn {
    border: 1px solid transparent;
    background: transparent;
    padding: 6px 14px;
    border-radius: 999px;
    font-weight: 700;
    font-size: 0.85rem;
    color: #475569;
    cursor: pointer;
}

#teacher-modal .teacher-tab-btn.active {
    background: #2563eb;
    color: white;
    border-color: #1d4ed8;
    box-shadow: 0 6px 14px rgba(37, 99, 235, 0.25);
}

#teacher-modal .teacher-tab-panel {
    display: none;
}

#teacher-modal .teacher-tab-panel.active {
    display: block;
}

.teacher-pack-row {
    display: grid;
    grid-template-columns: minmax(160px, 1fr) auto;
    gap: 10px;
    align-items: center;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(203, 213, 225, 0.8);
    background: rgba(248, 250, 252, 0.9);
}

.practice-pack-label {
    display: grid;
    gap: 4px;
}

.practice-pack-actions {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

@media (max-width: 560px) {
    .teacher-pack-row {
        grid-template-columns: 1fr;
        align-items: start;
    }

    .practice-pack-actions {
        justify-content: flex-start;
    }
}

.voice-available-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    margin-top: 8px;
    border-radius: 12px;
    background: #ecfdf3;
    border: 1px solid #bbf7d0;
    font-size: 0.85rem;
    color: #166534;
}

.voice-available-row.hidden {
    display: none;
}

.voice-available-row button {
    padding: 6px 10px;
    border-radius: 999px;
    border: none;
    background: #22c55e;
    color: #ffffff;
    font-weight: 700;
    cursor: pointer;
    font-size: 0.8rem;
}

.voice-available-row button:hover {
    background: #16a34a;
}

@media (max-height: 760px) {
    #teacher-modal {
        max-height: 88vh;
        overflow-y: auto;
    }
}

#teacher-modal .voice-delete-grid button {
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    background: #f9fafb;
    font-weight: 600;
    cursor: pointer;
}

#teacher-modal .voice-delete-grid button.danger {
    background: #fee2e2;
    border-color: #fecaca;
    color: #991b1b;
}

#teacher-modal .toggle-row.inline {
    display: flex;
    gap: 6px;
    align-items: center;
    font-size: 0.85rem;
    color: #4b5563;
}

#teacher-modal .toggle-row.select-row {
    display: grid;
    gap: 6px;
    align-items: center;
}

#teacher-modal #speech-rate {
    width: 100%;
}

#teacher-modal #speech-rate-value {
    font-weight: 600;
    color: #1f2937;
}

.stat-box { 
    background: #f8f9fa; 
    padding: 16px; 
    border-radius: 8px; 
    margin: 12px 0; 
}

.stat-word { 
    font-size: 2rem; 
    font-weight: bold; 
    color: var(--color-correct); 
    letter-spacing: 3px; 
    margin-bottom: 6px; 
    font-family: var(--font-heading); 
}

.stat-syllables { 
    font-size: 0.95rem; 
    color: #888; 
    margin-bottom: 10px; 
}

.stat-def { 
    font-style: italic; 
    color: #444; 
    margin-bottom: 8px; 
    line-height: 1.4;
}

.stat-sentence { 
    color: #2c3e50; 
    font-weight: 500; 
    line-height: 1.5;
}

.masked-input-container { 
    display: flex; 
    gap: 10px; 
    margin-bottom: 12px; 
}

#custom-word-input { 
    flex: 1; 
    padding: 12px; 
    font-size: 1.2rem; 
    border: 2px solid #d0d0d0; 
    border-radius: 8px; 
    text-align: center; 
    letter-spacing: 3px; 
    font-family: monospace; 
}

#toggle-mask { 
    background: #f5f5f5; 
    border: 1px solid #d0d0d0; 
    border-radius: 8px; 
    padding: 0 12px; 
    cursor: pointer; 
}

.error-msg { 
    color: #d32f2f; 
    font-size: 0.9rem; 
    margin-bottom: 12px; 
    min-height: 1.3em; 
}

.primary-btn { 
    background: linear-gradient(135deg, var(--btn-primary-1) 0%, var(--btn-primary-2) 55%, var(--btn-primary-3) 100%); 
    color: white; 
    border: 1px solid var(--btn-primary-border); 
    padding: 12px 24px; 
    border-radius: 14px; 
    font-weight: 700; 
    cursor: pointer; 
    width: 100%; 
    font-family: var(--font-body);
    font-size: 1rem;
    transition: all 0.2s;
}

.primary-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 22px var(--btn-primary-shadow);
}

.action-btn { 
    background: #0ea5e9; 
    color: white; 
    border: 1px solid rgba(14, 165, 233, 0.6); 
    padding: 10px 20px; 
    border-radius: 14px; 
    cursor: pointer;
    font-weight: 700;
    transition: all 0.2s;
}

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 18px rgba(14, 165, 233, 0.35);
}

/* Welcome Modal */
.welcome-content h2 { 
    margin-bottom: 12px; 
    color: #2c3e50; 
}

.welcome-steps { 
    text-align: left; 
    list-style: none; 
    margin: 0 auto 20px; 
    width: fit-content; 
    font-size: 0.95rem; 
}

.welcome-steps li { 
    margin-bottom: 8px;
    line-height: 1.5;
}

/* TOAST - Gentle notifications */
#toast-container { 
    position: fixed; 
    top: 80px; 
    left: 50%; 
    transform: translateX(-50%); 
    z-index: 1000; 
    pointer-events: none; 
}

.toast { 
    background: #333; 
    color: white; 
    padding: 10px 18px; 
    border-radius: 8px; 
    margin-bottom: 10px; 
    opacity: 0.95; 
    font-size: 0.95rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* BANNER - Calm success messages */
.banner {
    position: fixed;
    top: 0; 
    left: 0; 
    width: 100%;
    background: #27ae60; 
    color: white;
    text-align: center;
    padding: 14px;
    font-size: 1.1rem;
    font-weight: 600;
    z-index: 2000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    transform: translateY(-100%);
    transition: transform 0.3s ease-out;
}

.banner.visible {
    transform: translateY(0);
}

/* RECORDING STUDIO */
.studio-view {
    text-align: center;
    height: 100%;
    overflow-y: auto;
}

.record-btn {
    width: 110px;
    height: 110px;
    border-radius: 50%;
    background: #e74c3c;
    color: white;
    border: none;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transition: all 0.2s;
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: center;
}

.record-btn:hover { 
    transform: scale(1.05); 
}

.record-btn:active { 
    transform: scale(0.95); 
}

.record-btn.recording {
    background: #c0392b;
    animation: pulse-record 1.5s infinite;
}

@keyframes pulse-record {
    0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
    70% { box-shadow: 0 0 0 20px rgba(231, 76, 60, 0); }
    100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
}

/* Phoneme Guide */
.phoneme-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
}

.phoneme-card {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    padding: 14px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.phoneme-card.vowel-card {
    background: #eef2ff;
    border-color: #c7d2fe;
}

.phoneme-card:hover {
    border-color: var(--color-correct);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.phoneme-card.highlight-flash {
    animation: highlightFlash 2s ease-out;
    border-color: var(--color-correct);
    box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
}

@keyframes highlightFlash {
    0%, 100% { 
        background: white;
        box-shadow: 0 0 0 rgba(46, 204, 113, 0);
    }
    50% { 
        background: #e8f5e9;
        box-shadow: 0 0 20px rgba(46, 204, 113, 0.6);
    }
}

.phoneme-card.vowel-card:hover {
    border-color: #818cf8;
    background: #e0e7ff;
}

.phoneme-letter {
    font-size: 2.2rem;
    font-weight: bold;
    color: #0288d1; /* Calm teal-blue instead of pink/red */
    font-family: var(--font-heading);
    margin-bottom: 6px;
}

.phoneme-example {
    font-size: 0.85rem;
    color: #666;
}

.phoneme-cue {
    font-size: 0.75rem;
    color: #999;
    font-style: italic;
    margin-top: 4px;
}

/* Vowel cards get soft blue background */
.vowel-card {
    background: #eef2ff !important;
    border-color: #c7d2fe !important;
}

.vowel-card .phoneme-letter {
    color: #1976d2; /* Slightly darker blue for vowels */
}

.phoneme-section {
    margin-bottom: 20px;
}

/* Decodable Texts */
.decodable-modal-content {
    max-width: min(980px, 94vw);
    max-height: min(86vh, 900px);
    overflow: auto;
}

.decodable-toolbar {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    margin: 10px 0 14px;
    padding: 10px 12px;
    border-radius: 10px;
    background: #f5f8ff;
    border: 1px solid #dbe6ff;
}

.decodable-toolbar select {
    min-width: 88px;
    height: 34px;
}

.decodable-speed-note {
    font-size: 0.88rem;
    color: #5f6b82;
}

.decodable-text-card {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 14px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    width: 100%;
    appearance: none;
    font: inherit;
}

.decodable-text-card:hover {
    border-color: var(--color-correct);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.decodable-text-card.is-selected {
    border-color: #7c8cff;
    box-shadow: 0 0 0 2px rgba(124, 140, 255, 0.15);
}

.decodable-text-card.is-reading {
    border-color: #5d6bf7;
    box-shadow: 0 0 0 2px rgba(93, 107, 247, 0.2), 0 8px 24px rgba(68, 88, 212, 0.15);
}

.decodable-text-title {
    font-weight: 600;
    font-size: 1.05rem;
    margin-bottom: 4px;
    color: #2c3e50;
}

.decodable-text-level {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 10px;
}

.decodable-text-content {
    font-size: 0.95rem;
    line-height: 1.6;
    color: #444;
}

.decodable-word {
    border-radius: 4px;
    padding: 0 2px;
    transition: background-color 120ms ease, color 120ms ease, box-shadow 120ms ease;
}

.decodable-word.is-active {
    background: rgba(255, 228, 112, 0.65);
    color: #132048;
    box-shadow: 0 0 0 1px rgba(211, 166, 36, 0.45);
}

/* RESPONSIVE - Scale smoothly */
@media (max-height: 800px) {
    .tile { 
        width: min(52px, 10vw, 7.5vh);
        height: min(52px, 10vw, 7.5vh);
        font-size: min(1.7rem, 4.2vw, 4vh);
    }
    .key { 
        height: min(42px, 8vw, 6.5vh);
        font-size: min(0.95rem, 3vw, 3vh);
    }
    #game-canvas {
        gap: 14px;
    }
}

@media (max-height: 700px) {
    .tile { 
        width: min(48px, 9.5vw, 7vh);
        height: min(48px, 9.5vw, 7vh);
        font-size: min(1.5rem, 3.8vw, 3.6vh);
    }
    .key { 
        height: min(38px, 7.6vw, 6vh);
        font-size: min(0.9rem, 2.8vw, 2.8vh);
    }
    #game-canvas {
        gap: 12px;
    }
    header {
        padding: 8px 12px;
    }
}


/* ==========================================================================
   MOUTH ANIMATION SYSTEM - CSS-Based Phoneme Visualizations
   ========================================================================== */

.mouth-container {
    width: 200px;
    height: 200px;
    margin: 20px auto;
    position: relative;
    background: #ffe8d6;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.mouth {
    position: absolute;
    left: 50%;
    top: 55%;
    transform: translate(-50%, -50%);
    transition: all 0.3s ease;
    animation: none !important;
}

/* MOUTH SHAPES */

/* Wide Open (short a) */
.mouth-short-a {
    width: 80px;
    height: 60px;
    background: #c9302c;
    border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
    animation: mouthWideOpen 1s ease-in-out;
}

/* Slight Smile (short e) */
.mouth-short-e {
    width: 70px;
    height: 30px;
    background: #c9302c;
    border-radius: 50% 50% 50% 50% / 30% 30% 70% 70%;
    animation: mouthSmile 1s ease-in-out;
}

/* Relaxed (short i) */
.mouth-short-i {
    width: 60px;
    height: 35px;
    background: #c9302c;
    border-radius: 50%;
    animation: mouthRelaxed 1s ease-in-out;
}

/* Rounded Open (short o) */
.mouth-short-o {
    width: 50px;
    height: 50px;
    background: #c9302c;
    border-radius: 50%;
    animation: mouthRounded 1s ease-in-out;
}

/* Neutral Open (short u) */
.mouth-short-u {
    width: 55px;
    height: 40px;
    background: #c9302c;
    border-radius: 40%;
    animation: mouthNeutral 1s ease-in-out;
}

/* Lips Closed (b, p, m) */
.mouth-b, .mouth-p, .mouth-m {
    width: 70px;
    height: 8px;
    background: #8b4513;
    border-radius: 4px;
    animation: mouthClosed 1s ease-in-out;
}

/* Tongue Up (d, t, n, l) */
.mouth-d, .mouth-t, .mouth-n, .mouth-l {
    width: 60px;
    height: 40px;
    background: #c9302c;
    border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
    animation: mouthTongueUp 1s ease-in-out;
}

.mouth-d::after, .mouth-t::after, .mouth-n::after, .mouth-l::after {
    content: '';
    position: absolute;
    width: 30px;
    height: 20px;
    background: #ff69b4;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 50% 50% 0 0;
}

/* Throat Sound (g, k) */
.mouth-g, .mouth-k {
    width: 50px;
    height: 45px;
    background: #c9302c;
    border-radius: 40%;
    animation: mouthThroat 1s ease-in-out;
}

/* Teeth Together (s) */
.mouth-s {
    width: 65px;
    height: 20px;
    background: #c9302c;
    border-radius: 20%;
    position: relative;
    animation: mouthTeeth 1s ease-in-out;
}

.mouth-s::before {
    content: '';
    position: absolute;
    width: 60px;
    height: 3px;
    background: white;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* Lip-Teeth (f) */
.mouth-f {
    width: 70px;
    height: 25px;
    background: #c9302c;
    border-radius: 50% 50% 40% 40%;
    position: relative;
    animation: mouthLipTeeth 1s ease-in-out;
}

.mouth-f::before {
    content: '';
    position: absolute;
    width: 50px;
    height: 4px;
    background: white;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
}

/* Tongue Back (r) */
.mouth-r {
    width: 55px;
    height: 45px;
    background: #c9302c;
    border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
    animation: mouthTongueBack 1s ease-in-out;
}

/* Rounded Forward (sh, ch) */
.mouth-sh, .mouth-ch {
    width: 45px;
    height: 45px;
    background: #c9302c;
    border-radius: 50%;
    animation: mouthRoundedForward 1s ease-in-out;
}

/* Tongue Out (th) */
.mouth-th {
    width: 60px;
    height: 35px;
    background: #c9302c;
    border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
    position: relative;
    animation: mouthTongueOut 1s ease-in-out;
}

.mouth-th::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 12px;
    background: #ff69b4;
    bottom: -5px;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 50%;
}

/* ANIMATIONS */

@keyframes mouthWideOpen {
    0%, 100% { height: 60px; }
    50% { height: 70px; }
}

@keyframes mouthSmile {
    0%, 100% { width: 70px; }
    50% { width: 75px; }
}

@keyframes mouthRelaxed {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes mouthRounded {
    0%, 100% { border-radius: 50%; }
    50% { border-radius: 60%; }
}

@keyframes mouthNeutral {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.9; }
}

@keyframes mouthClosed {
    0%, 100% { height: 8px; }
    30% { height: 4px; }
    60% { height: 12px; }
}

@keyframes mouthTongueUp {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
}

@keyframes mouthThroat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(0.95); }
}

@keyframes mouthTeeth {
    0%, 100% { height: 20px; }
    50% { height: 18px; }
}

@keyframes mouthLipTeeth {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(2px); }
}

@keyframes mouthTongueBack {
    0%, 100% { transform: scaleX(1); }
    50% { transform: scaleX(0.95); }
}

@keyframes mouthRoundedForward {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

@keyframes mouthTongueOut {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(3px); }
}

/* Phoneme card enhancements for mouth display */
.phoneme-card-with-mouth {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}

.phoneme-articulation {
    background: #f0f4ff;
    padding: 12px;
    border-radius: 8px;
    margin-top: 12px;
    font-size: 0.85rem;
    color: #555;
    text-align: center;
    line-height: 1.5;
}

.phoneme-cue {
    font-weight: 600;
    color: #667eea;
    margin-bottom: 4px;
}

.phoneme-description {
    font-style: italic;
    color: #888;
}



/* --- Wordle-style intro/help modal --- */
.wordle-help { max-width: 520px; }
.wordle-help h3 { margin-top: 14px; }
.wordle-help .muted { opacity: 0.8; font-size: 0.9rem; }
.wordle-help .example-row { display:flex; gap:6px; margin:10px 0 6px; justify-content:flex-start; }
.wordle-help .tile.ex {
  width: 38px; height: 38px;
  display:flex; align-items:center; justify-content:center;
  border: 2px solid #d1d5db;
  border-radius: 6px;
  font-weight: 700;
  text-transform: uppercase;
}
.wordle-help .tile.ex.green { background: var(--tile-correct, #6aaa64); color:#fff; border-color: transparent; }
.wordle-help .tile.ex.yellow { background: var(--tile-present, #c9b458); color:#fff; border-color: transparent; }
.wordle-help .tile.ex.gray { background: var(--tile-absent, #787c7e); color:#fff; border-color: transparent; }
.wordle-help button.primary { margin-top: 10px; }


/* ---------- Layout tightening (mobile-friendly) ---------- */
select{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#game-canvas{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}

.hint-actions{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  margin: 4px 0;
}

#game-board{
  --word-length: 5;
  display:grid;
  grid-template-columns: repeat(var(--word-length), minmax(44px, 1fr));
  gap: 8px;
  justify-content:center;
}

/* Keep keyboard visible and sized to viewport */
#keyboard{
  width: min(520px, 100%);
  padding-bottom: env(safe-area-inset-bottom);
}

.key{
  height: clamp(44px, 6vh, 60px);
  font-size: clamp(1rem, 2.2vw, 1.2rem);
}

/* Make header/controls less tall on short screens */
@media (max-height: 820px){
  .controls{ margin-bottom: 6px; gap: 8px; }
  h1{ margin: 0 0 4px 0; }
  .tile{ width: 48px; height: 48px; }
  #game-board{ gap: 6px; }
}

/* ---------- Focus hint toggle button ---------- */
.mini-btn{
  padding: 6px 10px;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,0.15);
  background: rgba(255,255,255,0.85);
  font-size: 0.85rem;
  cursor:pointer;
}

/* ---------- Welcome modal styling (Wordle-ish) ---------- */
.welcome-card{
  max-width: 520px;
  width: calc(100% - 32px);
  text-align: left;
}

.welcome-card h2{
  text-align:center;
  margin-top: 0;
}

.welcome-steps ul{ padding-left: 18px; margin: 12px 0; }
.badge{
  display:inline-block;
  width: 16px;
  height: 16px;
  border-radius: 4px;
  vertical-align: -2px;
  margin-right: 6px;
}
.badge.correct{ background: var(--color-correct); }
.badge.present{ background: var(--color-present); }
.badge.absent{ background: var(--color-absent); }

.dont-show{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
  margin: 12px 0;
  font-size: 0.95rem;
}

button.primary{
  display:block;
  width: min(260px, 100%);
  margin: 0 auto;
  padding: 10px 14px;
  border-radius: 12px;
  border: none;
  background: var(--color-correct);
  color: #fff;
  font-weight: 700;
  cursor:pointer;
}

/* ---------- Recording Studio modal ---------- */
#recording-studio-modal .studio-card{
  max-width: 760px;
  width: calc(100% - 32px);
  padding: 22px 22px 18px 22px;
}

#recording-studio-modal h2{
  text-align:center;
  margin: 0 0 10px 0;
}

#recording-studio-modal .close-studio{
  position:absolute;
  top: 14px;
  right: 14px;
  width: 44px;
  height: 44px;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,0.15);
  background: rgba(255,255,255,0.9);
  font-size: 28px;
  line-height: 1;
  cursor:pointer;
}

#recording-studio-modal .studio-row{ margin: 12px 0; }
#recording-studio-modal .studio-actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top: 12px; }
#recording-studio-modal .studio-actions button{
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,0.15);
  background: rgba(255,255,255,0.9);
  cursor:pointer;
  font-weight:600;
}

#recording-studio-modal .studio-controls{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 12px;
}

#recording-studio-modal .control-group{
  border: 1px solid rgba(0,0,0,0.12);
  border-radius: 16px;
  padding: 12px;
  text-align:center;
}

#recording-studio-modal textarea{
  width:100%;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,0.15);
  padding: 10px;
  font-size: 1rem;
  font-family: var(--font-reading);
}

#recording-studio-modal .studio-word,
#recording-studio-modal .studio-def {
  font-family: var(--font-reading);
}

#recording-studio-modal .studio-word {
  font-size: clamp(1.7rem, 4.5vw, 2.4rem);
  font-weight: 800;
  letter-spacing: 0.01em;
  color: #0f172a;
  text-align: center;
  margin-bottom: 8px;
}

@media (max-width: 520px){
  #recording-studio-modal .studio-controls{ grid-template-columns: 1fr; }
}

/* Keyboard: make I clearer when uppercase */
.key[data-key="I"], .key[data-key="i"]{
  font-family: Arial, Helvetica, sans-serif;
  letter-spacing: 0.5px;
}



/* ========================================
   POLISHED LAYOUT FIXES
   ======================================== */

/* Word Quest layout: keep the grid + keyboard visible without breaking scroll on other pages. */
body.word-quest-page main {
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

body.word-quest-page #game-canvas {
  flex: 1;
  min-height: 0; /* allows the stage to shrink on shorter screens */
}

body.word-quest-page #keyboard {
  flex-shrink: 0;
}

/* Focus panel - collapsed by default, minimal when shown */
.focus-panel {
  flex-shrink: 0;
  padding: 12px;
  margin: 0 auto 12px;
  max-width: 600px;
  text-align: center;
  background: #f8f9fa;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.focus-panel.hidden {
  display: none;
}

/* Quick tiles styling */
.quick-tiles-row button {
  padding: 6px 12px;
  font-size: 0.85rem;
  border: 1px solid #ddd;
  background: white;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}

.quick-tiles-row button:hover {
  background: #f0f0f0;
  border-color: #999;
}

/* Hint buttons - clean, accessible design */
.hint-btn {
  background: white;
  border: 2px solid #e1e5e9;
  color: #374151;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s;
  font-family: var(--font-body);
  font-weight: 500;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.hint-btn:hover {
  background: #f8fafc;
  border-color: #6366f1;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.hint-btn:active {
  transform: scale(0.95) translateY(0);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.hint-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
  color: white;
}

.hint-primary:hover {
  background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
  border-color: #5a67d8;
}

.hint-btn.secondary {
  background: rgba(255, 255, 255, 0.92);
  border-color: rgba(148, 163, 184, 0.55);
  color: #1e293b;
}

.hint-btn.secondary:hover {
  background: rgba(241, 245, 249, 0.92);
  border-color: rgba(99, 102, 241, 0.35);
}

.hint-btn-disabled,
.hint-btn:disabled {
  opacity: 0.45;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

.quick-custom-word-panel {
  width: min(calc(100% - 16px), 980px);
  margin: 6px auto 6px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.82);
  box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
  padding: 8px 10px;
  display: grid;
  gap: 6px;
}

.quick-custom-word-toggle {
  width: fit-content;
  border: 1px solid rgba(148, 163, 184, 0.42);
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.9);
  color: #1e293b;
  font-size: 0.82rem;
  font-weight: 840;
  letter-spacing: 0.01em;
  padding: 6px 12px;
  cursor: pointer;
}

.quick-custom-word-toggle::after {
  content: ' ▾';
  font-size: 0.78rem;
}

.quick-custom-word-toggle.open::after {
  content: ' ▴';
}

.quick-custom-word-body {
  display: grid;
  gap: 6px;
}

.quick-custom-word-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

#quick-custom-word-input {
  flex: 1 1 220px;
  min-width: 180px;
  max-width: 290px;
  border: 1px solid rgba(148, 163, 184, 0.45);
  border-radius: 10px;
  background: #ffffff;
  color: #0f172a;
  font-size: 0.95rem;
  font-weight: 700;
  padding: 8px 10px;
}

#quick-custom-word-input.masked {
  -webkit-text-security: disc;
  text-security: disc;
}

.quick-custom-word-status {
  min-height: 1.25rem;
  font-size: 0.85rem;
  line-height: 1.35;
  color: #475569;
  font-weight: 650;
}

.quick-custom-word-status.error {
  color: #b91c1c;
}

.quick-custom-word-status.success {
  color: #166534;
}

.focus-round-chip {
  margin-top: 4px;
  min-height: 1.4rem;
  font-size: 0.82rem;
  font-weight: 800;
  color: #1e293b;
  line-height: 1.35;
}

#new-word-btn.new-round-btn {
  min-width: 96px;
  font-weight: 850;
}

@media (max-width: 820px) {
  .quick-custom-word-panel {
    width: calc(100% - 10px);
    margin: 6px auto 8px;
    padding: 8px 8px;
  }

  #quick-custom-word-input {
    flex: 1 1 100%;
    max-width: none;
  }

  .quick-custom-word-row .hint-btn {
    flex: 1 1 160px;
  }
}

/* Ensure Hear Word matches Sentence styling */
#action-hear-word {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
  color: white;
}

/* Specific styling for sentence button */
#simple-hear-sentence {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
  color: white;
}

#simple-hear-word,
#action-hear-word {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
  color: white;
}

#simple-hear-sentence:hover {
  background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
  border-color: #5a67d8;
}

#simple-hear-word:hover,
#action-hear-word:hover {
  background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
  border-color: #5a67d8;
}

/* Mobile responsive adjustments */
@media (max-height: 700px) {
  body.word-quest-page #game-board {
    padding: 8px;
  }
  
  body.word-quest-page .hint-actions {
    margin: 8px 0;
  }
}


/* ========================================
   Typography Normalization (Legibility First)
   ======================================== */

body {
  font-family: var(--font-body);
}

#keyboard button,
.key {
  font-family: var(--font-body);
}

.tile {
  font-family: var(--font-reading);
}


/* ========================================
   PHONEME GRID STYLES
   ======================================== */

#phoneme-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 12px;
  padding: 20px;
  max-height: 60vh;
  overflow-y: auto;
}

.phoneme-card {
  padding: 16px;
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
}

.phoneme-card:hover {
  border-color: #3b82f6;
  background: #f0f9ff;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.phoneme-card:active {
  transform: translateY(0);
}

.phoneme-letter {
  font-size: 2rem;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 8px;
}

/* ========================================
   SOUNDS WARM-UP GUIDE (UFLI/Wilson-inspired)
   ======================================== */

.phoneme-modal {
    max-width: var(--page-max);
    width: 96vw;
    padding: 12px;
}

.sound-guide-subtitle {
    text-align: center;
    color: #475569;
    margin: 4px 0 10px;
    font-size: 0.92rem;
}

.sound-guide-top-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin: 0 0 10px;
}

.sound-guide-top-actions .secondary-btn {
    padding: 8px 12px;
    border-radius: 12px;
    font-size: 0.85rem;
}

.sound-guide-layout {
    display: grid;
    grid-template-columns: minmax(230px, 300px) 1fr;
    gap: 12px;
    align-items: start;
    min-height: 0;
}
.sound-guide-layout.no-card {
    grid-template-columns: 1fr;
}

.sound-guide-layout.no-card .sound-guide-card {
    display: none;
}

@media (max-width: 980px) {
    .sound-guide-layout {
        grid-template-columns: 1fr;
    }

    .sound-guide-card {
        position: relative;
        top: 0;
    }
}
.sound-guide-layout.no-card {
    grid-template-columns: 1fr;
}

.sound-guide-card {
    position: sticky;
    top: 8px;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 18px;
    padding: 12px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);
    max-height: 72vh;
    overflow: auto;
    min-height: 0;
}

.sound-guide-board {
    max-height: 72vh;
    overflow: auto;
    padding: 10px;
    border-radius: 18px;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid #e2e8f0;
    box-shadow: 0 6px 14px rgba(15, 23, 42, 0.05);
    scrollbar-width: none;
    min-height: 0;
}

#phoneme-modal .sound-guide-card,
#phoneme-modal .sound-guide-board {
    max-height: none;
    height: 100%;
    overflow: auto;
}

#phoneme-modal .sound-guide-card {
    position: relative;
    top: 0;
}

#phoneme-modal.phoneme-narrow .sound-guide-layout {
    grid-template-rows: auto 1fr;
}

#phoneme-modal.phoneme-narrow .sound-guide-layout.no-card {
    grid-template-rows: 1fr;
}

#phoneme-modal.phoneme-narrow .sound-guide-card {
    height: auto;
    max-height: 44vh;
}

#hear-phoneme-sound {
    display: none !important;
}

.sound-guide-board::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

.sound-guide-board::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 999px;
}

.sound-guide-section {
    margin-bottom: 10px;
}

.sound-guide-section h3 {
    font-size: 0.95rem;
    color: #374151;
    margin-bottom: 8px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.sound-subsection {
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px dashed rgba(148, 163, 184, 0.4);
}

.sound-subsection-title {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #6b7280;
    margin: 8px 0 6px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.sound-subsection:last-child {
    border-bottom: none;
}

.info-icon {
    margin-left: 6px;
    border: none;
    background: rgba(255, 255, 255, 0.85);
    color: #4c51bf;
    width: 20px;
    height: 20px;
    border-radius: 999px;
    font-size: 0.75rem;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(15, 23, 42, 0.15);
    vertical-align: middle;
}

.info-icon:hover {
    transform: translateY(-1px);
}

.info-modal-content {
    max-width: 420px;
    text-align: left;
    padding: 20px 22px;
}

.info-modal-examples {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 10px;
}

.info-example {
    background: #eef2ff;
    color: #4338ca;
    font-weight: 600;
    border-radius: 999px;
    padding: 4px 10px;
    font-size: 0.8rem;
}

@media (max-height: 900px) {
    .sound-guide-layout {
        grid-template-columns: minmax(240px, 320px) 1fr;
        gap: 14px;
    }

    .sound-guide-board {
        padding: 10px;
    }

    .sound-guide-card {
        padding: 12px;
    }

    .sound-tile {
        padding: 6px 4px;
        font-size: 0.85rem;
    }

    .alphabet-board,
    .sound-row {
        grid-template-columns: repeat(auto-fit, minmax(38px, 1fr));
    }
}

.sound-row,
.alphabet-board {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: stretch;
    gap: 6px;
}

.alphabet-board.small {
    gap: 8px;
}

.sound-tile {
    border: 1px solid #d9e2ec;
    background: #f9fbff;
    border-radius: 8px;
    padding: 7px 10px;
    font-weight: 700;
    font-size: 0.9rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.15s ease;
    flex: 0 0 auto;
    min-width: 44px;
    white-space: nowrap;
}

.sound-tile:hover {
    border-color: #475569;
    box-shadow: 0 2px 6px rgba(15, 23, 42, 0.1);
    transform: translateY(-1px);
}

.sound-tile.vowel {
    background: #f0f9ff;
    border-color: #bae6fd;
    color: #1d4ed8;
}

.sound-tile.selected {
    border-color: #667eea;
    background: #eef2ff;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
}

.selected-sound {
    background: #ffffff;
    color: #0f172a;
    border-radius: 16px;
    padding: 14px;
    text-align: left;
    position: relative;
    overflow: hidden;
    border: 1px solid #e2e8f0;
    box-shadow: 0 6px 14px rgba(15, 23, 42, 0.06);
}

#selected-sound-display {
    display: grid;
    gap: 12px;
}

.selected-sound::before {
    display: none;
}

.sound-card-header {
    position: relative;
    z-index: 1;
    margin-bottom: 10px;
}

.sound-letter {
    font-size: 2rem;
    font-weight: 700;
    color: #0f172a;
}

.sound-name {
    font-size: 1rem;
    color: #475569;
}

.sound-name.hidden,
.sound-name:empty {
    display: none;
}

.sound-card-body {
    position: relative;
    z-index: 1;
    display: grid;
    gap: 10px;
    align-items: center;
}

.sound-mouth {
    display: none;
}

.sound-cue {
    background: #f8fafc;
    border-radius: 10px;
    padding: 8px;
    text-align: left;
    border: 1px solid #e2e8f0;
}

.sound-cue-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #64748b;
    margin-bottom: 6px;
}

.sound-description {
    margin-top: 6px;
    font-size: 0.85rem;
    color: #64748b;
}

.articulation-card {
    display: none !important;
    margin-top: 12px;
    background: #ffffff;
    border-radius: 14px;
    border: 1px solid #e2e8f0;
    padding: 12px;
    text-align: center;
    color: #1f2937;
    box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
}

.mini-mouth,
#mouth-visual {
    display: none !important;
}

.articulation-title {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #64748b;
    margin-bottom: 8px;
}

.articulation-visual {
    display: flex;
    justify-content: center;
    align-items: center;
}

.articulation-illustration {
    width: 120px;
    height: 120px;
    border-radius: 22px;
    background: linear-gradient(145deg, #fff4eb 0%, #ffe2cf 100%);
    border: 1px solid rgba(251, 191, 147, 0.6);
    position: relative;
    box-shadow: inset 0 0 0 4px rgba(255,255,255,0.6), 0 8px 14px rgba(15, 23, 42, 0.12);
    display: flex;
    align-items: center;
    justify-content: center;
}

.articulation-mouth {
    position: relative;
    width: var(--mouth-w, 62px);
    height: var(--mouth-h, 38px);
    background: #b45309;
    border-radius: var(--mouth-radius, 40px);
    overflow: hidden;
    box-shadow: inset 0 -6px 10px rgba(0,0,0,0.18);
}

.articulation-lips {
    position: absolute;
    inset: 0;
    border: 2px solid rgba(251, 146, 60, 0.7);
    border-radius: inherit;
}

.articulation-teeth {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 30%;
    background: #f8fafc;
    border-radius: 0 0 12px 12px;
    opacity: 0.6;
}

.articulation-tongue {
    position: absolute;
    bottom: -10%;
    left: 50%;
    transform: translateX(-50%);
    width: 70%;
    height: 55%;
    background: #fca5a5;
    border-radius: 50%;
}

.articulation-illustration.shape-wide {
    --mouth-w: 78px;
    --mouth-h: 50px;
    --mouth-radius: 40px;
}

.articulation-illustration.shape-smile {
    --mouth-w: 80px;
    --mouth-h: 26px;
    --mouth-radius: 30px 30px 50px 50px;
}

.articulation-illustration.shape-round {
    --mouth-w: 52px;
    --mouth-h: 52px;
    --mouth-radius: 50%;
}

.articulation-illustration.shape-neutral {
    --mouth-w: 62px;
    --mouth-h: 32px;
    --mouth-radius: 30px;
}

.articulation-illustration.shape-closed {
    --mouth-w: 70px;
    --mouth-h: 14px;
    --mouth-radius: 20px;
}

.articulation-illustration.shape-closed .articulation-tongue {
    opacity: 0;
}

.articulation-illustration.shape-tongue .articulation-tongue {
    height: 70%;
}

.articulation-illustration.shape-teeth .articulation-teeth {
    opacity: 1;
}

.articulation-caption {
    margin-top: 8px;
    font-size: 0.85rem;
    color: #475569;
}

.articulation-caption:empty {
    display: none;
}

/* Updated articulation card layout (clipart + cues) */
.articulation-card {
    display: grid !important;
    gap: 10px;
    background: #f9fafb;
    border-radius: 14px;
    border: 1px solid #e5e7eb;
    padding: 10px 12px;
    text-align: left;
    color: #1f2937;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
}

.articulation-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.articulation-actions {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.articulation-collapse {
    border: 1px solid #e2e8f0;
    background: #f8fafc;
    color: #475569;
    border-radius: 8px;
    padding: 6px 10px;
    font-weight: 600;
    cursor: pointer;
}

.articulation-collapse:hover {
    background: #e2e8f0;
}

.articulation-ipa {
    font-size: 0.85rem;
    font-weight: 700;
    color: #4f46e5;
    background: rgba(79, 70, 229, 0.12);
    padding: 4px 8px;
    border-radius: 999px;
}

.articulation-card-body {
    display: grid;
    grid-template-columns: minmax(200px, 230px) 1fr;
    gap: 10px;
    align-items: center;
}

.articulation-visual {
    display: grid;
    grid-template-columns: repeat(2, minmax(90px, 1fr));
    gap: 8px;
    align-items: start;
}

.articulation-visual-block {
    display: grid;
    gap: 6px;
    justify-items: center;
    text-align: center;
}

.articulation-visual-wrap {
    width: 86px;
    height: 86px;
    border-radius: 16px;
    background: linear-gradient(180deg, #ffffff 0%, #f1f5f9 100%);
    border: 1px solid #dbe3ee;
    display: grid;
    place-items: center;
    box-shadow: inset 0 0 0 1px #f8fafc;
}

.articulation-letter,
.articulation-icon {
    font-weight: 800;
    font-size: 1.35rem;
    color: #0f172a;
}

.articulation-icon {
    font-size: 1.1rem;
    color: #334155;
    letter-spacing: 0.04em;
    font-style: italic;
}

.articulation-letter {
    font-family: var(--font-heading);
}

.sound-clipart {
    width: 70px;
    height: 70px;
}

.articulation-picture-label {
    font-size: 0.72rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.articulation-text {
    display: grid;
    gap: 6px;
    font-size: 0.9rem;
}

.articulation-tip {
    font-weight: 600;
    color: #1f2937;
}

.articulation-example {
    font-size: 0.85rem;
    color: #475569;
}

.sound-card-actions {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 8px;
    margin-top: 8px;
}

.sound-card-actions button.listening {
    background: rgba(99, 102, 241, 0.18);
    border-color: rgba(99, 102, 241, 0.5);
}

.pronunciation-feedback {
    margin-top: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px dashed rgba(148, 163, 184, 0.5);
    background: rgba(248, 250, 252, 0.9);
    color: #1f2937;
    font-size: 0.85rem;
    display: grid;
    gap: 6px;
}

.pronunciation-feedback.hidden {
    display: none;
}

.pronunciation-feedback.good {
    border-color: rgba(34, 197, 94, 0.7);
    background: rgba(34, 197, 94, 0.12);
}

.pronunciation-feedback.warn {
    border-color: rgba(245, 158, 11, 0.7);
    background: rgba(245, 158, 11, 0.12);
}

.pronunciation-feedback.bad {
    border-color: rgba(239, 68, 68, 0.7);
    background: rgba(239, 68, 68, 0.12);
}

.sound-card-actions button {
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    background: #f8fafc;
    color: #1f2937;
    font-weight: 600;
    cursor: pointer;
}

.sound-card-actions button:hover {
    background: #e2e8f0;
}

.sound-video-panel {
    margin-top: 10px;
    display: grid;
    gap: 8px;
}

.sound-video-player {
    width: 100%;
    border-radius: 12px;
    border: 1px solid #dbe3ee;
    background: #020617;
    max-height: 260px;
}

.sound-video-status {
    font-size: 0.82rem;
    color: #475569;
}

.sound-video-status[data-tone="warn"] {
    color: #b45309;
}

.sound-video-status[data-tone="success"] {
    color: #15803d;
}

/* ---------- Classroom Dock ---------- */
.classroom-dock {
    position: fixed;
    top: 90px;
    right: 16px;
    width: min(380px, 92vw);
    max-height: 82vh;
    display: grid;
    gap: 12px;
    background: linear-gradient(145deg, rgba(248, 250, 252, 0.98), rgba(226, 232, 240, 0.98));
    border-radius: 18px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    padding: 14px;
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.28);
    z-index: 40;
}

.classroom-dock.hidden {
    display: none;
}

.classroom-dock-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
}

.dock-actions {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
}

.dock-actions button {
    border: 1px solid rgba(148, 163, 184, 0.6);
    background: #f8fafc;
    color: #1f2937;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 0.78rem;
    font-weight: 600;
    cursor: pointer;
}

.dock-actions button:hover {
    background: #e2e8f0;
}

.classroom-dock-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #1f2937;
}

.classroom-dock-header p {
    margin: 4px 0 0;
    font-size: 0.85rem;
    color: #64748b;
}

.dock-close {
    border: none;
    background: transparent;
    font-size: 1.4rem;
    color: #64748b;
    cursor: pointer;
}

.dock-actions .dock-close {
    padding: 0 4px;
    border: none;
    background: transparent;
    font-size: 1.2rem;
}

.classroom-dock:fullscreen {
    width: 100%;
    height: 100%;
    max-height: none;
    border-radius: 0;
    padding: 20px;
    overflow: auto;
}

body.dock-only {
    background: linear-gradient(180deg, #f8fafc 0%, #e8eef8 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
}

body.dock-only header,
body.dock-only main,
body.dock-only .fun-hud,
body.dock-only #modal-overlay {
    display: none !important;
}

body.dock-only .classroom-dock {
    position: static;
    width: min(960px, 96vw);
    max-height: 92vh;
    right: auto;
    left: auto;
    top: auto;
    bottom: auto;
}

.classroom-dock-tabs {
    display: flex;
    gap: 8px;
}

.dock-tab {
    border: none;
    padding: 6px 12px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.8);
    color: #334155;
    font-weight: 600;
    cursor: pointer;
    box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.4);
}

.dock-tab.active {
    background: #4f46e5;
    color: #ffffff;
    box-shadow: none;
}

.classroom-dock-body {
    display: grid;
    gap: 10px;
}

.dock-panel.hidden {
    display: none;
}

.dock-upload {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 10px;
    background: #eef2ff;
    color: #4338ca;
    font-weight: 600;
    cursor: pointer;
}

.dock-upload input {
    display: none;
}

.dock-file-name {
    font-size: 0.85rem;
    color: #475569;
}

.dock-file-viewer {
    width: 100%;
    height: 320px;
    border-radius: 14px;
    background: rgba(15, 23, 42, 0.05);
    border: 1px dashed rgba(148, 163, 184, 0.4);
    overflow: hidden;
}

.dock-file-viewer iframe,
.dock-file-viewer img {
    width: 100%;
    height: 100%;
    border: none;
    object-fit: contain;
    background: #fff;
}

.dock-hint {
    font-size: 0.78rem;
    color: #64748b;
    margin: 0;
}

.dock-timer-display {
    font-size: 2.2rem;
    font-weight: 700;
    text-align: center;
    color: #111827;
}

.dock-timer-controls {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

.dock-timer-set {
    display: grid;
    gap: 6px;
    font-size: 0.85rem;
    color: #475569;
}

.dock-timer-set select {
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    background: #fff;
}

@media (max-width: 900px) {
    .classroom-dock {
        top: auto;
        bottom: 16px;
        right: 16px;
        left: 16px;
        width: auto;
        max-height: 70vh;
    }
}

@media (max-width: 900px) {
    .sound-guide-layout {
        grid-template-columns: 1fr;
    }

    .sound-guide-board {
        max-height: none;
    }

    .sound-guide-card {
        position: static;
    }

    .sound-card-actions {
        grid-template-columns: 1fr;
    }
}

.phoneme-example {
  font-size: 0.9rem;
  color: #6b7280;
  margin-top: 4px;
}

.phoneme-description {
  font-size: 0.75rem;
  color: #9ca3af;
  margin-top: 6px;
  font-style: italic;
}

/* Translation dropdown in end-game modal */
.translation-selector {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid #e0e0e0;
}

.translation-selector label {
    display: block;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 6px;
    color: #666;
}

.translation-selector select {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
}

.translation-pin {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    font-size: 0.85rem;
    color: #4b5563;
}

.translation-pin input {
    width: 16px;
    height: 16px;
}

.translation-pin-status {
    margin-top: 6px;
    font-size: 0.8rem;
    color: #6b7280;
}

.translation-display {
    margin-top: 12px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 3px solid #4a90e2;
}

.translation-display.hidden {
    display: none;
}

.translation-audio-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 8px;
    justify-content: center;
}

/* ---------- Generic Activity Teacher Tools ---------- */
.activity-lesson {
    grid-column: 1 / -1;
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(248, 250, 252, 0.92);
    padding: 12px 14px;
    display: grid;
    gap: 8px;
}

.activity-lesson.hidden {
    display: none;
}

.activity-lesson-title {
    font-weight: 900;
    color: #0f172a;
}

.activity-lesson-copy {
    color: #475569;
    font-weight: 650;
    line-height: 1.35;
}

.activity-teacher-tools {
    grid-column: 1 / -1;
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.9);
    padding: 10px 12px;
    box-shadow: 0 10px 22px rgba(15, 23, 42, 0.06);
}

.activity-teacher-tools summary {
    cursor: pointer;
    font-weight: 800;
    color: #374151;
}

.activity-teacher-body {
    display: grid;
    gap: 10px;
    margin-top: 10px;
}

.activity-teacher-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}

.activity-teacher-row input[type="url"] {
    flex: 1 1 260px;
    min-width: 220px;
}

/* ==========================================================================
   ADVANCED ARTICULATION GUIDE STYLES
   Professional phoneme guide with mouth positioning
   ========================================================================== */

.phoneme-card-modal {
    max-height: none;
    overflow: visible;
}

/* ==========================================================================
   Layout refinements (focus/length, warm-up tab, spacing)
   ========================================================================== */

body.word-quest-page main {
    flex: 1;
    min-height: 0;
    overflow: hidden;
}

body.word-quest-page .controls {
    grid-template-columns: max-content max-content max-content;
    justify-content: flex-start;
}

body.word-quest-page .controls select {
    width: max-content;
    min-width: 0;
}

body.word-quest-page .controls #pattern-select {
    min-width: min(420px, calc(100vw - 42px));
}

#pattern-select,
#length-select,
#guess-count-select {
    min-width: 0;
    width: max-content;
}

@media (max-width: 700px) {
    body.word-quest-page .controls {
        grid-template-columns: 1fr;
        justify-content: stretch;
    }

    body.word-quest-page .controls select,
    #pattern-select,
    #length-select,
    #guess-count-select {
        width: 100%;
    }

    .warmup-panel {
        width: auto;
        border-radius: 14px;
    }
}

#focus-panel,
.focus-panel,
#focus-toggle-btn {
    display: none !important;
}

.warmup-panel {
    width: fit-content;
    max-width: 100%;
    margin: 4px auto 10px;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.78);
    border: 1px solid #dbe3ee;
    border-radius: 999px;
    box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
    justify-content: center;
    gap: 10px;
}

.howto-icon-btn {
    width: 34px;
    height: 34px;
    padding: 0;
    border-radius: 999px;
    font-size: 1rem;
    font-weight: 700;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* ---------- Practice Recorder ---------- */
.practice-recorder-group {
    display: grid;
    gap: 8px;
    margin-top: 10px;
}

.reveal-teacher-tools {
    margin-top: 10px;
}

.reveal-teacher-toggle {
    background: none;
    border: none;
    padding: 0;
    font-size: 0.85rem;
    color: #6b7280;
    cursor: pointer;
    text-decoration: underline;
}

.reveal-teacher-controls {
    display: none;
    margin-top: 8px;
}

.reveal-teacher-tools.is-open .reveal-teacher-controls {
    display: block;
}

.reveal-teacher-note {
    font-size: 0.8rem;
    color: #64748b;
    padding: 2px 4px;
}

.practice-recorder {
    display: grid;
    grid-template-columns: 1fr auto auto auto;
    gap: 8px;
    align-items: center;
    padding: 8px 10px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(226, 232, 240, 0.8);
}

.practice-label {
    font-weight: 600;
    color: #1f2937;
}

.practice-status {
    font-size: 0.8rem;
    color: #64748b;
}

.practice-recorder button {
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    background: #f8fafc;
    font-weight: 600;
    cursor: pointer;
}

.practice-recorder button.recording {
    background: #ef4444;
    color: white;
    border-color: #dc2626;
}

.practice-recorder button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.practice-recorder-note {
    font-size: 0.85rem;
    color: #64748b;
    padding: 6px 4px;
}

@media (prefers-color-scheme: dark) {
    .reveal-teacher-toggle {
        color: #cbd5e1;
    }

    .reveal-teacher-note {
        color: #cbd5e1;
    }

    .practice-recorder {
        background: rgba(15, 23, 42, 0.7);
        border-color: rgba(51, 65, 85, 0.8);
    }

    .practice-label {
        color: #e2e8f0;
    }

    .practice-status {
        color: #cbd5f5;
    }

    .practice-recorder button {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(51, 65, 85, 0.8);
        color: #e2e8f0;
    }
}

.warmup-title {
    font-size: 0.85rem;
    font-weight: 600;
}

.warmup-subtitle {
    display: none;
}

.warmup-actions {
    gap: 6px;
}

.warmup-btn {
    padding: 6px 10px;
    font-size: 0.8rem;
    background: #eef2ff;
    color: #4338ca;
    border: 1px solid #c7d2fe;
    box-shadow: none;
}

.warmup-quick {
    gap: 4px;
}

.warmup-quick {
    display: none;
}

.warmup-tile {
    width: 30px;
    height: 30px;
    border-radius: 6px;
    font-size: 0.85rem;
}

/* (moved to `body.fit-screen` rules below) */

/* ==========================================================================
   End-game reveal polish + discreet translations
   ========================================================================== */

#modal.win {
    border: 2px solid #86efac;
    background: linear-gradient(180deg, #ffffff 0%, #f0fdf4 100%);
}

#modal.loss {
    border: 2px solid #fecaca;
    background: linear-gradient(180deg, #ffffff 0%, #fff7f7 100%);
}

#modal.win #modal-title {
    color: #15803d;
}

#modal.loss #modal-title {
    color: #b91c1c;
}

#modal-word.reveal-word {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 2.4rem;
    font-weight: 800;
    letter-spacing: 0.12em;
    margin-bottom: 6px;
}

#modal-word.reveal-word span {
    display: inline-block;
    animation: wordRevealUp 0.6s cubic-bezier(0.2, 0.7, 0.3, 1) forwards;
    animation-delay: var(--delay);
    opacity: 0;
    color: #1f2937;
}

#modal-word.reveal-word span:nth-child(even) {
    animation-name: wordRevealDown;
}

#modal.win #modal-word.reveal-word span:nth-child(even) {
    color: #16a34a;
}

#modal.loss #modal-word.reveal-word span:nth-child(even) {
    color: #ef4444;
}

@keyframes wordRevealUp {
    0% { opacity: 0; transform: translateY(18px) scale(0.85); }
    60% { opacity: 1; transform: translateY(-4px) scale(1.05); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes wordRevealDown {
    0% { opacity: 0; transform: translateY(-18px) scale(0.85); }
    60% { opacity: 1; transform: translateY(4px) scale(1.05); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}

#modal-word.reveal-word.variant-flip span {
    animation-name: wordFlip;
}

#modal-word.reveal-word.variant-sparkle span {
    animation-name: wordSparkle;
    text-shadow: 0 0 6px rgba(250, 204, 21, 0.45);
}

.modal-sentence {
    font-family: var(--font-reading);
    color: #334155;
    font-weight: 650;
    line-height: 1.5;
    margin-top: 10px;
}

#modal-syllables {
    margin-top: 4px;
    font-size: 0.82rem;
    color: #475569;
    font-weight: 700;
    letter-spacing: 0.01em;
}

#modal-syllables .syllable-label {
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-size: 0.72rem;
    color: #64748b;
    font-weight: 900;
}

.audience-mode-note {
    margin-top: 8px;
    font-size: 0.8rem;
    font-weight: 700;
    color: #475569;
    letter-spacing: 0.01em;
}

.sentence-preview {
    font-family: var(--font-reading);
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 16px;
    padding: 10px 14px;
    color: #1f2937;
    font-weight: 650;
    box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
    max-width: min(620px, 92vw);
    text-align: center;
}

@keyframes wordFlip {
    0% { opacity: 0; transform: rotateX(80deg) scale(0.85); }
    60% { opacity: 1; transform: rotateX(0deg) scale(1.05); }
    100% { opacity: 1; transform: rotateX(0deg) scale(1); }
}

@keyframes wordSparkle {
    0% { opacity: 0; transform: scale(0.85); }
    50% { opacity: 1; transform: scale(1.08); }
    100% { opacity: 1; transform: scale(1); }
}

.translation-compact {
    border-top: none;
    padding-top: 8px;
    margin-top: 10px;
}

.translation-compact label {
    font-size: 0.8rem;
    color: #9ca3af;
}

.translation-compact select {
    font-size: 0.85rem;
}

.translation-toggle {
    background: none;
    border: none;
    padding: 0;
    font-size: 0.85rem;
    color: #6b7280;
    cursor: pointer;
    text-decoration: underline;
}

.translation-compact .translation-controls {
    display: none;
    margin-top: 8px;
}

.translation-compact.is-open .translation-controls {
    display: block;
}

.translation-display {
    background: #f9fafb;
    border-left-color: #a5b4fc;
}

#play-translated-def,
#play-translated-sentence,
#play-translated-word {
    padding: 4px 8px;
    font-size: 0.75rem;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    background: #f8fafc;
    color: #374151;
    cursor: pointer;
}

#modal-audio-controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    margin-top: 16px;
}

.modal-audio-btn {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    background: #f8fafc;
    color: #1f2937;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
}

.modal-audio-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(15, 23, 42, 0.15);
}

.modal-audio-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none;
}

.modal-action-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 12px;
}

.auto-read-toggle {
    margin-top: 10px;
    display: flex;
    justify-content: center;
}

.auto-read-label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: #6b7280;
}

.modal-primary-btn {
    padding: 10px 18px;
    border-radius: 10px;
    border: none;
    background: #2c3e50;
    color: #ffffff;
    font-weight: 700;
    cursor: pointer;
}

#modal .translation-compact {
    margin-top: 18px;
}

#play-translated-def:disabled,
#play-translated-sentence:disabled,
#play-translated-word:disabled {
    opacity: 0.45;
    cursor: not-allowed;
    background: #f1f5f9;
}

.translated-word {
    font-weight: 760;
    color: #1e293b;
    margin-bottom: 6px;
}

.translation-audio-note {
    margin-top: 8px;
    font-size: 0.75rem;
    color: #9ca3af;
    text-align: left;
    line-height: 1.4;
}

.translation-audio-note.hidden {
    display: none;
}

.voice-quality-hint {
    margin-top: 6px;
    font-size: 0.8rem;
    color: #9ca3af;
    line-height: 1.4;
}

.tiny-tooltip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 14px;
    height: 14px;
    border-radius: 999px;
    border: 1px solid #d1d5db;
    color: #6b7280;
    font-size: 0.65rem;
    line-height: 1;
    margin-left: 4px;
    cursor: help;
    background: #f8fafc;
}

.phoneme-tabs {
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

.phoneme-tab {
    transition: all 0.2s ease;
}

.phoneme-tab:hover {
    background: #f1f5f9 !important;
    color: #1e293b !important;
}

.phoneme-tab.active {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.selected-sound {
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    position: relative;
    overflow: hidden;
}

.selected-sound::before {
    display: none;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.phoneme-card {
    position: relative;
    overflow: hidden;
}

.phoneme-section {
    margin-top: 18px;
}

.phoneme-section h3 {
    text-align: left;
    font-size: 1rem;
    color: #374151;
    margin-bottom: 8px;
}

.soundwall-section {
    margin: 18px 0;
    text-align: left;
}

.soundwall-section h3 {
    font-size: 1rem;
    color: #374151;
    margin-bottom: 10px;
}

.soundwall-filters {
    margin-bottom: 14px;
    background: #f8fafc;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
    padding: 8px 12px;
}

.soundwall-filters summary {
    cursor: pointer;
    font-weight: 600;
    color: #374151;
}

.soundwall-filters .filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 8px 12px;
    margin-top: 10px;
    font-size: 0.85rem;
    color: #1f2937;
}

.soundwall-filters label {
    display: flex;
    gap: 8px;
    align-items: center;
}

.vowel-valley {
    display: flex;
    justify-content: center;
    gap: 12px;
    padding: 6px 0 16px;
    flex-wrap: wrap;
}

.vowel-valley .phoneme-card {
    width: 120px;
}

.valley-item {
    transform: translateY(var(--valley-offset, 0px));
}

.consonant-grid {
    display: grid;
    grid-template-columns: 140px repeat(7, minmax(90px, 1fr));
    gap: 6px;
    background: #f8fafc;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.consonant-grid .grid-header {
    font-size: 0.75rem;
    font-weight: 700;
    color: #374151;
    text-align: center;
    padding: 8px 6px;
    background: #f1f5f9;
    border-radius: 8px;
}

.consonant-grid .row-label {
    font-size: 0.8rem;
    font-weight: 700;
    color: #1f2937;
    background: #e2e8f0;
    border-radius: 8px;
    padding: 8px 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.consonant-grid .grid-cell {
    min-height: 96px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 6px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: center;
    justify-content: center;
}

.consonant-grid .grid-cell .phoneme-card {
    width: 100%;
    min-height: 86px;
    padding: 8px;
}

.consonant-grid .grid-cell .phoneme-letter {
    font-size: 1.4rem;
}

.consonant-grid .grid-cell .mini-mouth {
    width: 40px;
    height: 40px;
}

.consonant-grid .grid-cell .mini-mouth .mouth {
    transform: translate(-50%, -50%) scale(0.6);
}

@media (max-width: 720px) {
    .consonant-grid {
        grid-template-columns: 110px repeat(7, minmax(80px, 1fr));
    }
}

@media (max-width: 980px) {
    .madlibs-main {
        grid-template-columns: 1fr;
        align-content: start;
    }
}

@media (max-width: 640px) {
    .consonant-grid {
        grid-template-columns: 90px repeat(7, minmax(70px, 1fr));
    }
    .consonant-grid .grid-header {
        font-size: 0.65rem;
    }
}

@media (prefers-reduced-motion: reduce) {
    .selected-sound::before,
    .phoneme-card::before,
    .letter-card::before,
    #mouth-visual {
        animation: none !important;
    }
    .mouth {
        animation: none !important;
        transition: none !important;
    }
}

.phoneme-letter {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 4px;
    color: #111827;
}

.phoneme-example {
    font-size: 0.9rem;
    color: #555;
    font-weight: 600;
}

.phoneme-ipa {
    font-size: 0.8rem;
    color: #8b8b8b;
    margin-top: 4px;
}

.mini-mouth {
    width: 56px;
    height: 56px;
    margin: 0 auto 6px;
    background: #ffe8d6;
    border-radius: 50%;
    position: relative;
    box-shadow: 0 3px 10px rgba(0,0,0,0.12);
}

.mini-mouth .mouth {
    position: absolute;
    left: 50%;
    top: 55%;
    transform: translate(-50%, -50%) scale(0.7);
}

#mouth-visual {
    display: none;
}

#mouth-visual .mouth {
    position: absolute;
    left: 50%;
    top: 55%;
    transform: translate(-50%, -50%) scale(0.85);
}

.mouth-neutral {
    width: 60px;
    height: 10px;
    background: #8b4513;
    border-radius: 6px;
}

.phoneme-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(59,130,246,0.1), transparent);
    transition: all 0.3s;
    opacity: 0;
}

.phoneme-card:hover::before {
    left: 100%;
    opacity: 1;
}

.letter-card {
    position: relative;
    overflow: hidden;
}

.letter-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: all 0.3s;
    opacity: 0;
}

.letter-card:hover::before {
    left: 100%;
    opacity: 1;
}

/* Phoneme grid responsive design */
@media (max-width: 768px) {
    .phoneme-tabs {
        flex-direction: column;
        gap: 4px;
    }
    
    .selected-sound {
        padding: 16px !important;
    }
    
    .selected-sound > div:first-child {
        flex-direction: column !important;
        text-align: center;
    }
    
    .selected-sound > div:first-child > div {
        flex: none !important;
        margin-bottom: 16px;
    }
    
    .phoneme-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
        gap: 8px !important;
    }
    
    #letters-grid {
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)) !important;
    }
}

/* Animation for sound selection */
@keyframes soundSelect {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.phoneme-card.selected {
    animation: soundSelect 0.3s ease;
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59,130,246,0.2) !important;
}

/* Mouth position visual enhancements */
#mouth-visual {
    animation: none;
}

@keyframes breathe {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* ---------- Mad Libs ---------- */
body.madlibs-page {
    overflow: auto;
    height: auto;
    padding-bottom: 28px;
}

/* ---------- Cloze ---------- */
body.cloze-page {
    overflow-x: hidden;
    overflow-y: auto;
    height: auto;
    min-height: 100dvh;
}

.cloze-header {
    width: 100%;
    max-width: var(--page-max);
    padding: 16px 16px 8px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    flex-wrap: wrap;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
}

.cloze-subtitle {
    color: #334155;
    font-size: 0.95rem;
    font-weight: 600;
    margin-top: 4px;
}

.cloze-main {
    width: calc(100% - 32px);
    max-width: var(--page-max);
    flex: 1;
    display: grid;
    grid-template-columns: minmax(360px, 1.35fr) minmax(320px, 0.95fr);
    gap: 16px;
    padding: 18px;
    margin: 10px 16px 22px;
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    min-height: 0;
    align-items: start;
}

.cloze-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--lab-radius);
    padding: 18px;
    border: 1px solid var(--lab-border);
    box-shadow: var(--lab-shadow);
    display: flex;
    flex-direction: column;
    gap: 12px;
    position: relative;
    overflow: hidden;
    min-width: 0;
}

.cloze-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), transparent 60%);
    pointer-events: none;
}

.cloze-panel h2,
.comp-panel h2,
.fluency-panel h2,
.madlibs-panel h2 {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.cloze-panel h2::after,
.comp-panel h2::after,
.fluency-panel h2::after,
.madlibs-panel h2::after {
    content: '';
    width: 36px;
    height: 6px;
    border-radius: 999px;
    background: var(--panel-accent);
    display: inline-block;
}

.cloze-panel > * {
    position: relative;
    z-index: 1;
}

.cloze-panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.cloze-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

.cloze-controls select {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    background: #f8fafc;
    font-weight: 600;
    font-size: 0.9rem;
}

.primary-btn,
.secondary-btn {
    border-radius: 14px;
    padding: 10px 16px;
    border: 1px solid var(--lab-border);
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s;
}

.primary-btn {
    background: linear-gradient(135deg, var(--btn-primary-1) 0%, var(--btn-primary-2) 55%, var(--btn-primary-3) 100%);
    color: #f8fafc;
    border-color: var(--btn-primary-border);
}

.primary-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 22px var(--btn-primary-shadow);
}

.secondary-btn {
    background: #f8fafc;
    color: #1f2937;
}

.secondary-btn:hover {
    background: var(--btn-secondary-hover);
}

.cloze-passage {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    padding: 20px 22px;
    line-height: 1.9;
    font-size: 1.08rem;
    font-family: var(--font-reading);
    letter-spacing: 0.2px;
    flex: 1;
    min-height: 220px;
    overflow: auto;
}

.cloze-passage p {
    margin-bottom: 16px;
}

.cloze-blank {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: clamp(96px, 14vw, 140px);
    padding: 6px 14px;
    margin: 2px 4px;
    border-radius: 999px;
    border: 2px dashed rgba(99, 102, 241, 0.35);
    background: linear-gradient(180deg, rgba(238, 242, 255, 0.95), rgba(224, 231, 255, 0.75));
    font-weight: 700;
    color: #1f2937;
    transition: all 0.2s;
    box-shadow: inset 0 0 0 1px rgba(99, 102, 241, 0.12);
}

.cloze-blank.filled {
    border-style: solid;
}

.cloze-blank.correct {
    background: #d1fae5;
    border-color: #10b981;
    color: #065f46;
}

.cloze-blank:hover {
    border-color: var(--accent-primary);
    background: rgba(99, 102, 241, 0.18);
}

.cloze-blank.wrong {
    background: #fee2e2;
    border-color: #ef4444;
    color: #991b1b;
}

.cloze-bank-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.cloze-word {
    background: #ffffff;
    border: 1px solid rgba(99, 102, 241, 0.35);
    color: #312e81;
    padding: 8px 12px;
    border-radius: 999px;
    font-weight: 700;
    cursor: grab;
    user-select: none;
    transition: all 0.2s;
    box-shadow: 0 6px 14px rgba(79, 70, 229, 0.12);
}

.cloze-word:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 18px rgba(79, 70, 229, 0.18);
}

.cloze-word.selected {
    outline: 2px solid #6366f1;
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
}

.cloze-word.used {
    opacity: 0.45;
    filter: grayscale(0.2);
    cursor: default;
}

.cloze-hud {
    display: flex;
    gap: 10px;
    align-items: center;
    padding: 6px 12px;
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.25);
    border-radius: 999px;
    font-weight: 600;
    color: #1f2937;
    box-shadow: 0 6px 12px rgba(79, 70, 229, 0.12);
}

.cloze-hud-item {
    display: inline-flex;
    gap: 6px;
    align-items: center;
    font-size: 0.9rem;
}

.cloze-hearts {
    display: inline-flex;
    gap: 4px;
}

.cloze-actions {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.cloze-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
    color: #475569;
}

.cloze-message {
    min-height: 20px;
    font-weight: 600;
    color: #6366f1;
    opacity: 0;
    transition: opacity 0.2s;
}

.cloze-message.visible {
    opacity: 1;
}

@media (max-width: 900px) {
    .cloze-main {
        grid-template-columns: 1fr;
    }

    .cloze-hud {
        justify-content: space-between;
    }
}

@media (max-height: 760px) {
    .cloze-passage {
        min-height: 180px;
    }
}

@media (max-width: 1100px) {
    .cloze-main,
    .comp-main,
    .fluency-main,
    .madlibs-main {
        grid-template-columns: 1fr;
    }

    .cloze-panel,
    .comp-panel,
    .fluency-panel,
    .madlibs-panel {
        padding: 14px;
    }
}

@media (max-width: 740px) {
    .cloze-passage {
        padding: 16px;
        font-size: 1rem;
        line-height: 1.75;
    }

    .cloze-controls {
        gap: 6px;
    }

    .cloze-blank {
        min-width: clamp(82px, 20vw, 120px);
    }
}

.madlibs-header {
    width: 100%;
    max-width: var(--page-max);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
}

.madlibs-subtitle {
    color: #334155;
    font-size: 0.95rem;
    font-weight: 600;
    margin-top: 4px;
}

.madlibs-main {
    width: calc(100% - 32px);
    max-width: var(--page-max);
    display: grid;
    grid-template-columns: minmax(320px, 1fr) minmax(360px, 1.2fr);
    gap: 16px;
    padding: 18px;
    margin: 10px 16px 22px;
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    align-items: start;
}

.madlibs-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--lab-radius);
    padding: 14px;
    box-shadow: var(--lab-shadow);
    display: flex;
    flex-direction: column;
    gap: 10px;
    border: 1px solid var(--lab-border);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(8px);
}

.madlibs-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.06), transparent 60%);
    pointer-events: none;
}

.madlibs-panel::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, rgba(99, 102, 241, 0.9), rgba(14, 165, 233, 0.8), rgba(249, 115, 22, 0.6));
    opacity: 0.9;
    pointer-events: none;
}

.madlibs-panel h2 {
    font-size: 1.2rem;
    color: #1f2937;
}

.madlibs-panel h2::after {
    content: '';
    display: inline-block;
    width: 28px;
    height: 6px;
    margin-left: 8px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(99, 102, 241, 0.9), rgba(14, 165, 233, 0.8));
}

.madlibs-panel .muted {
    font-size: 0.9rem;
    color: #6b7280;
}

.madlibs-panel label {
    font-weight: 600;
    color: #374151;
    font-size: 0.9rem;
}

.madlibs-field label {
    font-size: 0.85rem;
}

.madlibs-field .field-help {
    font-size: 0.72rem;
    color: #94a3b8;
    display: block;
    margin-top: 2px;
}

.madlibs-panel textarea {
    width: 100%;
    min-height: 100px;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    font-family: var(--font-body);
    resize: vertical;
    background: rgba(255, 255, 255, 0.85);
}

.madlibs-panel select,
.madlibs-panel input[type="text"] {
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    font-family: var(--font-body);
    background: rgba(255, 255, 255, 0.9);
}

#madlibs-fields {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 8px;
    max-height: clamp(160px, 24vh, 240px);
    overflow: auto;
    padding-right: 4px;
}

.madlibs-field {
    background: #ffffff;
    border-radius: 14px;
    padding: 10px;
    border: 1px solid rgba(99, 102, 241, 0.2);
    box-shadow: 0 6px 14px rgba(79, 70, 229, 0.08);
}

.madlibs-field .field-row {
    gap: 6px;
}

.madlibs-field input[type="text"] {
    padding: 6px 8px;
}

.madlibs-template-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.madlibs-teacher-tools summary {
    cursor: pointer;
    font-weight: 600;
    color: #374151;
}

.madlibs-teacher-body {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
}

.madlibs-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
    background: rgba(255, 255, 255, 0.55);
    border-radius: 12px;
    padding: 8px;
    border: 1px solid rgba(226, 232, 240, 0.45);
}

.madlibs-field .field-help {
    display: block;
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 2px;
}

.madlibs-field .field-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 6px;
    align-items: center;
}

.madlibs-field button {
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    background: white;
    cursor: pointer;
    font-weight: 600;
    color: #1f2937;
}

.madlibs-actions-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.madlibs-output {
    min-height: 110px;
    background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
    border-radius: 12px;
    padding: 14px;
    border: 1px solid #e5e7eb;
    color: #111827;
    line-height: 1.6;
    font-size: 1rem;
    white-space: pre-wrap;
    margin-bottom: 12px;
    background-image: linear-gradient(transparent 0%, transparent 92%, rgba(99, 102, 241, 0.08) 92%, rgba(99, 102, 241, 0.08) 100%);
    background-size: 100% 28px;
    max-height: clamp(140px, 22vh, 240px);
    overflow: auto;
}

.madlibs-output.empty {
    color: #6b7280;
    font-style: italic;
}

/* Letter sounds display */
#letter-sounds-display {
    border: 2px solid #e5e7eb;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    0% { opacity: 0; transform: translateY(-10px); }
    100% { opacity: 1; transform: translateY(0); }
}

/* Audio button hover effects */
.selected-sound button:hover {
    background: #e2e8f0 !important;
    transform: translateY(-1px);
}

.selected-sound button:active {
    transform: translateY(0);
}

.translated-text {
    margin: 0 0 8px 0;
    font-size: 0.9rem;
    color: #555;
    font-style: italic;
}

.mini-audio-btn {
    background: #4a90e2;
    border: none;
    border-radius: 4px;
    color: white;
    font-size: 0.75rem;
    padding: 4px 8px;
    cursor: pointer;
    transition: background 0.2s;
    min-width: 32px;
    height: 28px;
    flex-shrink: 0;
}

.mini-audio-btn:hover {
    background: #357abd;
}

.mini-audio-btn:active {
    transform: scale(0.95);
}

/* ==========================================================================
   Viewport fit (avoid default scroll)
   ========================================================================== */

body.word-quest-page main {
    flex: 1;
    min-height: 0;
    overflow: hidden;
    height: auto;
}

body.word-quest-page #game-canvas {
    flex: 1;
    min-height: 0;
    padding-bottom: 10px;
}

body.word-quest-page #game-board {
    margin: clamp(8px, 1.4vh, 16px) auto;
}

body.word-quest-page #keyboard {
    margin-bottom: 4px;
}

@media (max-height: 860px) {
    header {
        padding: 10px 12px 4px;
    }

    .header-top {
        margin-bottom: 6px;
    }

    h1 {
        font-size: 1.35rem;
    }

    #game-canvas {
        gap: clamp(6px, 1.1vh, 12px);
    }

    #game-board {
        gap: 7px;
        padding: 12px;
    }

    .tile {
        width: min(64px, 11.2vw, 8vh);
        height: min(64px, 11.2vw, 8vh);
        font-size: min(2.2rem, 5vw, 4.6vh);
    }

    .key {
        height: min(50px, 8.6vw, 6.8vh);
        font-size: min(1.08rem, 3.2vw, 3vh);
    }

    #keyboard {
        gap: 5px;
        padding: 8px 8px 10px;
    }

    .warmup-panel {
        margin: 2px auto 8px;
    }
}

@media (max-height: 760px) {
    h1 {
        font-size: 1.25rem;
    }

    #game-canvas {
        gap: clamp(5px, 1vh, 10px);
    }

    .tile {
        width: min(58px, 10.5vw, 7.2vh);
        height: min(58px, 10.5vw, 7.2vh);
        font-size: min(2rem, 4.6vw, 4.1vh);
    }

    .key {
        height: min(46px, 7.8vw, 6vh);
        font-size: min(1rem, 3vw, 2.8vh);
    }

    .warmup-tile {
        width: 28px;
        height: 28px;
    }

    .hint-actions {
        gap: 6px;
        margin: 2px 0;
    }

    .hint-actions .hint-btn {
        padding: 6px 10px;
        font-size: 0.8rem;
    }
}

body.fit-screen #game-canvas {
    gap: clamp(6px, 1.2vh, 12px);
    padding: 12px 12px 12px;
}

body.fit-screen #game-board {
    gap: 4px;
}

body.fit-screen #keyboard {
    gap: 4px;
}

body.fit-screen .phoneme-modal {
    max-height: 94vh;
}

body.fit-screen .sound-guide-layout {
    gap: 8px;
}

body.fit-screen .sound-guide-card,
body.fit-screen .sound-guide-board {
    max-height: 68vh;
    padding: 8px;
}

body.fit-screen .sound-guide-card {
    overflow: auto;
}

body.fit-screen .sound-guide-section {
    margin-bottom: 8px;
}

body.fit-screen .sound-guide-section h3 {
    font-size: 0.9rem;
}

body.fit-screen .sound-tile {
    padding: 5px 4px;
    font-size: 0.82rem;
}

body.fit-screen .comp-panel {
    padding: 12px;
}

body.fit-screen .comp-question,
body.fit-screen .comp-choice {
    padding: 10px 12px;
    border-radius: 12px;
}

body.madlibs-page {
    height: auto;
    min-height: 100dvh;
    overflow-x: hidden;
    overflow-y: auto;
    padding-bottom: 28px;
}

body.madlibs-page::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
        radial-gradient(circle at 15% 20%, rgba(99, 102, 241, 0.12), transparent 48%),
        radial-gradient(circle at 80% 15%, rgba(56, 189, 248, 0.12), transparent 48%),
        radial-gradient(circle at 50% 78%, rgba(34, 197, 94, 0.10), transparent 54%);
    pointer-events: none;
    z-index: 0;
}

/* Fun HUD (optional) */
.fun-hud {
    position: fixed;
    top: 14px;
    right: 16px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    padding: 6px 10px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 999px;
    border: 1px solid rgba(203, 213, 225, 0.8);
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
    z-index: 1200;
    font-weight: 700;
    color: #1f2937;
    max-width: min(380px, 92vw);
}

.fun-hud.hidden {
    display: none;
}

body.adventure-open #keyboard {
    opacity: 0;
    pointer-events: none;
    transform: translateY(10px);
}

body.fun-studio .fun-hud {
    background: rgba(15, 23, 42, 0.8);
    border-color: rgba(148, 163, 184, 0.4);
}

body.fun-studio .fun-hud-icon {
    filter: grayscale(0.4);
}

.fun-hud-item {
    display: inline-flex;
    gap: 6px;
    align-items: center;
    font-size: 0.85rem;
    line-height: 1.2;
}

.fun-hud-coins .fun-hud-value {
    white-space: nowrap;
}

.fun-hud-label {
    font-size: 0.72rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    opacity: 0.7;
}

.fun-hud-team {
    font-weight: 700;
    color: #111827;
    font-size: 0.8rem;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.08);
}

.fun-hud-timer .fun-hud-value {
    font-variant-numeric: tabular-nums;
}

.fun-hud-icon {
    font-size: 1rem;
}

.fun-hud-help {
    border-left: 1px solid rgba(148, 163, 184, 0.4);
    padding-left: 6px;
}

.fun-hud-mini-btn {
    border: 1px solid rgba(148, 163, 184, 0.6);
    background: rgba(248, 250, 252, 0.9);
    color: #1f2937;
    border-radius: 999px;
    padding: 4px 10px;
    font-size: 0.72rem;
    font-weight: 700;
    cursor: pointer;
}

.fun-hud-mini-btn:hover {
    background: #eef2ff;
    border-color: rgba(99, 102, 241, 0.5);
}

@media (max-width: 720px) {
    .fun-hud {
        top: 10px;
        right: 10px;
        padding: 4px 8px;
    }
}

@media (max-width: 960px) {
    .fun-hud {
        top: 88px;
    }
}

@media (max-width: 760px) {
    .fun-hud {
        top: 112px;
        right: 12px;
    }
}

@media (max-width: 520px) {
    .fun-hud {
        top: 126px;
    }
}

body.madlibs-page .fun-hud {
    top: 84px;
}

/* ==========================
   Comprehension Quest
   ========================== */

body.comprehension-page {
    min-height: 100dvh;
    height: auto;
    overflow-x: hidden;
    overflow-y: auto;
    background:
        radial-gradient(circle at 12% 10%, rgba(56, 189, 248, 0.16), transparent 46%),
        radial-gradient(circle at 88% 8%, rgba(249, 115, 22, 0.14), transparent 44%),
        linear-gradient(180deg, #fbfdff 0%, #eef4ff 55%, #e6eefb 100%);
    color: #0f172a;
}

.comp-header {
    width: 100%;
    max-width: var(--page-max);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
}

.comp-subtitle {
    color: #334155;
    font-weight: 600;
    margin-top: 4px;
}

.comp-main {
    width: calc(100% - 32px);
    max-width: var(--page-max);
    display: grid;
    grid-template-columns: minmax(360px, 1.35fr) minmax(320px, 0.95fr);
    gap: 16px;
    padding: 18px;
    margin: 10px 16px 22px;
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    align-items: start;
}

.comp-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--lab-radius);
    padding: 16px;
    border: 1px solid var(--lab-border);
    box-shadow: var(--lab-shadow);
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.comp-panel-header {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: flex-start;
}

.comp-controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.comp-controls select {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.5);
}

.comp-passage {
    background: rgba(248, 250, 252, 0.95);
    border-radius: 12px;
    padding: 14px;
    line-height: 1.6;
    font-family: var(--font-reading);
    border: 1px solid rgba(226, 232, 240, 0.8);
    min-height: 180px;
}

.comp-hud {
    display: flex;
    gap: 12px;
    justify-content: space-between;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.25);
    color: #1f2937;
    font-weight: 600;
    box-shadow: 0 6px 12px rgba(79, 70, 229, 0.12);
}

.comp-question {
    border-radius: 14px;
    padding: 12px 14px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(148, 163, 184, 0.35);
    box-shadow: 0 6px 12px rgba(15, 23, 42, 0.06);
}

.comp-question-meta {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #4338ca;
    margin-bottom: 8px;
    background: rgba(99, 102, 241, 0.12);
    border: 1px solid rgba(99, 102, 241, 0.25);
    display: inline-flex;
    padding: 2px 8px;
    border-radius: 999px;
    font-weight: 700;
}

.comp-choices {
    display: grid;
    gap: 8px;
    margin-top: 8px;
}

.comp-choice {
    display: flex;
    gap: 8px;
    align-items: center;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(148, 163, 184, 0.35);
    border-radius: 12px;
    padding: 8px 12px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
}

.comp-choice:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 12px rgba(15, 23, 42, 0.1);
}

.comp-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.comp-feedback {
    font-weight: 600;
    color: #1f2937;
    min-height: 1.2em;
}

/* ==========================
   Fluency Sprint
   ========================== */

body.fluency-page {
    min-height: 100dvh;
    height: auto;
    overflow-x: hidden;
    overflow-y: auto;
    background:
        radial-gradient(circle at 12% 10%, rgba(56, 189, 248, 0.16), transparent 46%),
        radial-gradient(circle at 88% 8%, rgba(249, 115, 22, 0.14), transparent 44%),
        linear-gradient(180deg, #fbfdff 0%, #eef4ff 55%, #e6eefb 100%);
    color: #0f172a;
}

.fluency-header {
    width: 100%;
    max-width: var(--page-max);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
}

.fluency-subtitle {
    color: #334155;
    font-weight: 600;
    margin-top: 4px;
}

.fluency-main {
    width: calc(100% - 32px);
    max-width: var(--page-max);
    display: grid;
    grid-template-columns: minmax(360px, 1.35fr) minmax(320px, 0.95fr);
    gap: 16px;
    padding: 18px;
    margin: 10px 16px 22px;
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    align-items: start;
}

.fluency-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--lab-radius);
    padding: 16px;
    border: 1px solid var(--lab-border);
    box-shadow: var(--lab-shadow);
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.fluency-panel-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
}

.fluency-controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.fluency-controls select {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.5);
}

body.fluency-page .header-actions .link-btn:hover,
body.fluency-page .header-actions .link-btn:focus-visible {
    color: #0f172a;
}

.fluency-passage {
    background: rgba(248, 250, 252, 0.95);
    border-radius: 12px;
    padding: 14px;
    line-height: 1.6;
    font-family: var(--font-reading);
    border: 1px solid rgba(226, 232, 240, 0.8);
    min-height: 180px;
}

.fluency-read-coach {
    border-radius: 16px;
    padding: 12px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.82);
    display: grid;
    gap: 10px;
}

.fluency-read-coach-head h3 {
    margin: 0;
    color: #0f172a;
}

.fluency-read-coach-controls {
    display: grid;
    grid-template-columns: minmax(150px, 1fr) repeat(3, minmax(120px, auto));
    gap: 8px;
    align-items: end;
}

.fluency-coach-field {
    display: grid;
    gap: 5px;
    font-size: 0.8rem;
    font-weight: 800;
    color: #334155;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.fluency-coach-field select,
.fluency-coach-field input {
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    background: #ffffff;
    font-weight: 700;
    color: #0f172a;
}

.fluency-wave-canvas {
    width: 100%;
    min-height: 130px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(248, 250, 252, 0.96);
}

.fluency-coach-cards {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.fluency-coach-card {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.32);
    background: rgba(255, 255, 255, 0.9);
    padding: 9px 10px;
    display: grid;
    gap: 6px;
}

.fluency-coach-card h4 {
    margin: 0;
    color: #0f172a;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.fluency-coach-text {
    color: #334155;
    font-weight: 650;
    line-height: 1.4;
}

.fluency-coach-score {
    font-weight: 900;
    color: #0f172a;
    margin-bottom: 6px;
}

.fluency-coach-breakdown {
    font-weight: 760;
    color: #1e3a8a;
    margin-bottom: 6px;
}

.fluency-coach-good {
    color: #166534;
    font-weight: 850;
}

.fluency-coach-list {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 4px;
    color: #334155;
    font-weight: 650;
}

.fluency-coach-cue {
    display: inline-block;
    margin-left: 4px;
    color: #1e40af;
    font-weight: 700;
}

.fluency-coach-loop,
.fluency-coach-prosody {
    color: #334155;
    font-weight: 680;
    line-height: 1.35;
}

.fluency-coach-status {
    min-height: 1.2rem;
    font-weight: 700;
}

.fluency-sound-clips {
    border-radius: 16px;
    padding: 12px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.82);
    display: grid;
    gap: 10px;
}

.fluency-sound-clips-head h3 {
    margin: 0;
    color: #0f172a;
}

.fluency-sound-clips-controls {
    display: grid;
    grid-template-columns: minmax(180px, 1fr) auto auto;
    gap: 8px;
    align-items: end;
}

.fluency-sound-open {
    text-decoration: none;
}

.fluency-sound-clips-list {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.fluency-sound-clip-card {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.32);
    background: rgba(255, 255, 255, 0.92);
    padding: 9px 10px;
    display: grid;
    gap: 6px;
}

.fluency-sound-clip-head {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    align-items: baseline;
}

.fluency-sound-clip-title {
    font-weight: 850;
    color: #0f172a;
}

.fluency-sound-clip-date {
    font-size: 0.8rem;
    font-weight: 700;
    color: #64748b;
}

.fluency-sound-clip-tags {
    display: inline-flex;
    gap: 6px;
    flex-wrap: wrap;
}

.fluency-sound-clip-tag {
    border-radius: 999px;
    border: 1px solid rgba(14, 165, 233, 0.35);
    background: rgba(14, 165, 233, 0.1);
    color: #0f172a;
    font-size: 0.76rem;
    font-weight: 700;
    padding: 2px 8px;
}

.fluency-sound-clip-media audio,
.fluency-sound-clip-media video {
    width: 100%;
    border-radius: 10px;
    background: #f8fafc;
}

.fluency-tracker {
    border-radius: 16px;
    padding: 10px 12px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.75);
    box-shadow: 0 8px 16px rgba(15, 23, 42, 0.06);
    display: grid;
    gap: 6px;
}

.fluency-tracker.stop-mode {
    border-color: rgba(14, 165, 233, 0.45);
    background: rgba(14, 165, 233, 0.1);
}

.fluency-tracker-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
}

.fluency-tracker-buttons {
    display: inline-flex;
    gap: 8px;
    flex-wrap: wrap;
}

.fluency-tracker .secondary-btn {
    background: #17253b;
    color: #f8fafc;
    border-color: #2e3d56;
}

.fluency-tracker .secondary-btn:hover,
.fluency-tracker .secondary-btn:focus-visible {
    background: #24364f;
    color: #ffffff;
    border-color: #3b4f6d;
}

.fluency-tracker-stats {
    display: inline-flex;
    gap: 12px;
    flex-wrap: wrap;
    color: #334155;
    font-weight: 800;
    font-size: 0.85rem;
}

.fluency-tracker-hint {
    color: #475569;
    font-size: 0.86rem;
    font-weight: 650;
    line-height: 1.35;
}

.fluency-line-focus-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.fluency-line-focus-toggle {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: #334155;
    font-size: 0.86rem;
    font-weight: 700;
}

.fluency-line-focus-toggle input[type="checkbox"] {
    accent-color: #0ea5e9;
}

.fluency-line-focus-label {
    color: #475569;
    font-size: 0.83rem;
    font-weight: 700;
}

.fluency-word {
    display: inline-block;
    padding: 1px 4px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
}

.fluency-word:hover {
    background: rgba(99, 102, 241, 0.12);
}

.fluency-word.error {
    background: rgba(239, 68, 68, 0.16);
    outline: 2px solid rgba(239, 68, 68, 0.42);
}

.fluency-word.coach-match:not(.error):not(.stop) {
    background: rgba(34, 197, 94, 0.12);
    box-shadow: inset 0 -2px 0 rgba(34, 197, 94, 0.28);
}

.fluency-word.coach-mismatch:not(.error):not(.stop) {
    background: rgba(249, 115, 22, 0.16);
    box-shadow: inset 0 -2px 0 rgba(249, 115, 22, 0.36);
}

.fluency-word.stop {
    background: rgba(34, 197, 94, 0.16);
    outline: 2px solid rgba(34, 197, 94, 0.42);
}

.fluency-word.after-stop {
    opacity: 0.35;
}

.fluency-word.line-active:not(.error):not(.stop) {
    background: rgba(14, 165, 233, 0.16);
    box-shadow: inset 0 -2px 0 rgba(14, 165, 233, 0.32);
}

.fluency-word.line-dim:not(.error):not(.stop):not(.after-stop) {
    opacity: 0.52;
}

.fluency-hud {
    display: flex;
    gap: 12px;
    justify-content: space-between;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(14, 165, 233, 0.1);
    border: 1px solid rgba(14, 165, 233, 0.25);
    font-weight: 600;
    box-shadow: 0 6px 12px rgba(14, 165, 233, 0.12);
}

.fluency-timer-display {
    font-size: 2.2rem;
    font-weight: 800;
    text-align: center;
    color: #0f172a;
}

.fluency-timer-controls {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

.fluency-score {
    display: grid;
    gap: 6px;
}

.fluency-score input {
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.5);
}

.fluency-score-output {
    font-weight: 700;
    color: #1f2937;
}

.fluency-score-output .is-good {
    color: #0f766e;
}

.fluency-score-output .is-warn {
    color: #b45309;
}

.fluency-benchmark {
    margin-top: 10px;
    padding: 12px;
    border-radius: 14px;
    border: 1px solid rgba(59, 130, 246, 0.25);
    background: linear-gradient(180deg, rgba(239, 246, 255, 0.85) 0%, rgba(248, 250, 252, 0.95) 100%);
    display: grid;
    gap: 10px;
}

.fluency-benchmark-head {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: baseline;
}

.fluency-benchmark-head h3 {
    margin: 0;
    font-size: 1rem;
}

.fluency-benchmark-controls {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;
    align-items: end;
}

.fluency-benchmark-summary {
    font-size: 0.9rem;
    color: #334155;
}

.fluency-benchmark-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 8px;
}

.fluency-benchmark-grid > div {
    background: rgba(255, 255, 255, 0.84);
    border: 1px solid rgba(148, 163, 184, 0.32);
    border-radius: 10px;
    padding: 8px;
    display: grid;
    gap: 4px;
}

.fluency-benchmark-grid strong {
    font-size: 0.78rem;
    color: #475569;
}

.fluency-benchmark-grid span {
    font-weight: 700;
    color: #0f172a;
}

.fluency-feedback {
    font-weight: 600;
    min-height: 1.2em;
}

@media (max-width: 900px) {
    .comp-main,
    .fluency-main {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 760px) {
    .fluency-read-coach-controls,
    .fluency-sound-clips-controls,
    .fluency-benchmark-controls {
        grid-template-columns: 1fr;
    }

    .fluency-benchmark-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
}

body.fluency-page.has-story-track main {
    padding-bottom: 8px;
}

body.fluency-page .story-track {
    position: static;
    transform: none;
    width: min(calc(100% - 32px), var(--page-max));
    margin: 8px 16px 14px;
    box-shadow: 0 10px 22px rgba(15, 23, 42, 0.1);
    backdrop-filter: none;
}

body.fluency-page .story-track-steps {
    display: none;
}

body.fluency-page .quick-response-dock {
    display: none !important;
}

@media (max-width: 760px) {
    body.madlibs-page .fun-hud {
        top: 112px;
    }
}

/* ==========================
   Write & Build
   ========================== */

body.writing-page {
    min-height: 100dvh;
    height: auto;
    overflow-x: hidden;
    overflow-y: auto;
}

.writing-header {
    width: 100%;
    max-width: var(--page-max);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
    flex-wrap: wrap;
    gap: 12px;
}

.writing-subtitle {
    color: #334155;
    font-weight: 650;
    margin-top: 4px;
}

.writing-main {
    width: calc(100% - 32px);
    max-width: var(--page-max);
    display: grid;
    grid-template-columns: minmax(360px, 1.15fr) minmax(340px, 0.95fr);
    gap: 16px;
    padding: 18px;
    margin: 10px 16px 22px;
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    align-items: start;
}

.writing-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--lab-radius);
    padding: 16px;
    border: 1px solid var(--lab-border);
    box-shadow: var(--lab-shadow);
    display: flex;
    flex-direction: column;
    gap: 12px;
    position: relative;
    overflow: hidden;
    min-width: 0;
}

.writing-panel::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, rgba(99, 102, 241, 0.9), rgba(14, 165, 233, 0.8), rgba(249, 115, 22, 0.6));
    opacity: 0.9;
    pointer-events: none;
}

.writing-panel > * {
    position: relative;
    z-index: 1;
}

.writing-panel-header {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: flex-start;
    flex-wrap: wrap;
}

.writing-help {
    color: #475569;
    font-weight: 650;
    margin-top: 6px;
    line-height: 1.35;
}

.writing-controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

.writing-controls select {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    background: rgba(248, 250, 252, 0.95);
    font-weight: 700;
}

.writing-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

.writing-prompt-card {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(248, 250, 252, 0.9);
    padding: 12px 14px;
    display: grid;
    gap: 8px;
}

.writing-prompt-title {
    font-weight: 900;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #4338ca;
    font-size: 0.8rem;
}

.writing-prompt-text {
    color: #0f172a;
    font-weight: 700;
    line-height: 1.35;
    font-size: 1rem;
}

.writing-starters {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.writing-starter {
    background: rgba(224, 231, 255, 0.8);
    border: 1px solid rgba(99, 102, 241, 0.22);
    color: #312e81;
    padding: 4px 10px;
    border-radius: 999px;
    font-weight: 800;
    font-size: 0.85rem;
}

.writing-plan-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.writing-field {
    display: grid;
    gap: 6px;
}

.writing-field span {
    font-weight: 800;
    color: #334155;
    font-size: 0.88rem;
}

.writing-field input {
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.55);
    background: #ffffff;
    font-weight: 650;
}

.writing-frame {
    display: grid;
    gap: 10px;
}

.writing-sentence {
    display: grid;
    gap: 6px;
    padding: 10px 12px;
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.9);
}

.writing-sentence span {
    font-weight: 900;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #64748b;
    font-size: 0.78rem;
}

.writing-sentence textarea {
    width: 100%;
    border: 1px solid rgba(148, 163, 184, 0.55);
    border-radius: 12px;
    padding: 10px 12px;
    resize: vertical;
    font-family: var(--font-reading);
    font-size: 0.98rem;
}

.writing-sentence-topic {
    border-color: rgba(34, 197, 94, 0.35);
    background: rgba(34, 197, 94, 0.06);
}

.writing-sentence-detail {
    border-color: rgba(14, 165, 233, 0.35);
    background: rgba(14, 165, 233, 0.05);
}

.writing-sentence-conclusion {
    border-color: rgba(249, 115, 22, 0.35);
    background: rgba(249, 115, 22, 0.05);
}

.writing-preview {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(248, 250, 252, 0.95);
    padding: 12px 14px;
    display: grid;
    gap: 8px;
}

.writing-preview-title {
    font-weight: 900;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #0f172a;
    font-size: 0.78rem;
}

.writing-preview-text {
    color: #0f172a;
    font-weight: 650;
    line-height: 1.55;
    min-height: 84px;
}

.writing-feedback {
    font-weight: 700;
    color: #0f172a;
    min-height: 1.2em;
}

.writing-feedback-list {
    margin-left: 18px;
    display: grid;
    gap: 6px;
}

@media (max-width: 1100px) {
    .writing-main {
        grid-template-columns: 1fr;
    }

    .writing-plan-grid {
        grid-template-columns: 1fr;
    }
}

/* ==========================
   Plan-It Challenge
   ========================== */

body.planit-page {
    min-height: 100dvh;
    height: auto;
    overflow-x: hidden;
    overflow-y: auto;
}

.planit-header {
    width: 100%;
    max-width: var(--page-max);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
    flex-wrap: wrap;
    gap: 12px;
}

.planit-subtitle {
    color: #334155;
    font-weight: 650;
    margin-top: 4px;
}

.planit-main {
    width: calc(100% - 32px);
    max-width: var(--page-max);
    display: grid;
    grid-template-columns: minmax(360px, 1.05fr) minmax(340px, 0.95fr);
    gap: 16px;
    padding: 18px;
    margin: 10px 16px 22px;
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    align-items: start;
}

.planit-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--lab-radius);
    padding: 16px;
    border: 1px solid var(--lab-border);
    box-shadow: var(--lab-shadow);
    display: flex;
    flex-direction: column;
    gap: 12px;
    position: relative;
    overflow: hidden;
    min-width: 0;
}

.planit-panel::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, rgba(14, 165, 233, 0.85), rgba(99, 102, 241, 0.85), rgba(249, 115, 22, 0.55));
    opacity: 0.9;
    pointer-events: none;
}

.planit-panel > * {
    position: relative;
    z-index: 1;
}

.planit-panel-header {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: flex-start;
    flex-wrap: wrap;
}

.planit-help {
    color: #475569;
    font-weight: 650;
    margin-top: 6px;
    line-height: 1.35;
}

.planit-controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}

.planit-controls select {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    background: rgba(248, 250, 252, 0.95);
    font-weight: 700;
}

.planit-card {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(248, 250, 252, 0.9);
    padding: 12px 14px;
    display: grid;
    gap: 8px;
}

.planit-card-title {
    font-weight: 900;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #0f172a;
    font-size: 0.82rem;
}

.planit-card-text {
    color: #0f172a;
    font-weight: 700;
    line-height: 1.35;
    font-size: 1rem;
}

.planit-card-tip {
    color: #475569;
    font-weight: 650;
    line-height: 1.35;
}

.planit-mission-board {
    border-radius: 16px;
    border: 1px solid rgba(99, 102, 241, 0.35);
    background: linear-gradient(145deg, rgba(238, 242, 255, 0.92), rgba(224, 242, 254, 0.8));
    padding: 12px 14px;
    display: grid;
    gap: 10px;
}

.planit-mission-head {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    align-items: flex-start;
    flex-wrap: wrap;
}

.planit-mission-title {
    font-weight: 900;
    color: #1e1b4b;
}

.planit-mission-subtitle {
    color: #334155;
    font-size: 0.88rem;
    font-weight: 650;
    margin-top: 2px;
}

.planit-mission-stats {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 8px;
}

.planit-mission-stat {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.34);
    background: rgba(255, 255, 255, 0.86);
    padding: 8px 10px;
}

.planit-mission-stat-label {
    font-size: 0.72rem;
    font-weight: 850;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: #475569;
}

.planit-mission-stat-value {
    font-size: 1.1rem;
    font-weight: 900;
    color: #0f172a;
    margin-top: 2px;
}

.planit-mission-progress {
    grid-column: 1 / -1;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.34);
    background: rgba(255, 255, 255, 0.86);
    padding: 8px 10px;
    display: grid;
    gap: 6px;
}

.planit-mission-progress-label {
    color: #334155;
    font-size: 0.8rem;
    font-weight: 750;
}

.planit-mission-progress-track {
    width: 100%;
    height: 8px;
    border-radius: 999px;
    background: rgba(148, 163, 184, 0.3);
    overflow: hidden;
}

.planit-mission-progress-fill {
    height: 100%;
    width: 0;
    border-radius: inherit;
    background: linear-gradient(90deg, rgba(79, 70, 229, 0.95), rgba(14, 165, 233, 0.95));
    transition: width 240ms ease;
}

.planit-mission-list {
    display: grid;
    gap: 8px;
}

.planit-mission-item {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.34);
    background: rgba(255, 255, 255, 0.88);
    padding: 8px 10px;
    display: flex;
    justify-content: space-between;
    gap: 10px;
    align-items: center;
}

.planit-mission-item-main {
    min-width: 0;
}

.planit-mission-item-title {
    font-weight: 850;
    color: #0f172a;
}

.planit-mission-item-text {
    margin-top: 2px;
    color: #475569;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
}

.planit-mission-item-status {
    width: 30px;
    height: 30px;
    border-radius: 999px;
    border: 1px solid rgba(99, 102, 241, 0.42);
    display: grid;
    place-items: center;
    font-weight: 900;
    color: #4338ca;
    background: rgba(224, 231, 255, 0.8);
    flex: 0 0 auto;
}

.planit-mission-item.is-done {
    border-color: rgba(34, 197, 94, 0.45);
    background: rgba(240, 253, 244, 0.9);
}

.planit-mission-item.is-done .planit-mission-item-status {
    border-color: rgba(34, 197, 94, 0.55);
    color: #166534;
    background: rgba(220, 252, 231, 0.9);
}

.planit-mission-banner {
    min-height: 1.25em;
    font-size: 0.9rem;
    font-weight: 750;
}

.planit-mission-banner.is-success {
    color: #166534;
}

.planit-mission-banner.is-warning {
    color: #92400e;
}

.planit-quick-builder {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.92);
    padding: 12px 14px;
    display: grid;
    gap: 10px;
}

.planit-quick-title {
    font-weight: 900;
    color: #0f172a;
}

.planit-quick-subtitle {
    color: #475569;
    font-weight: 650;
    line-height: 1.35;
}

.planit-quick-controls {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    align-items: end;
}

.planit-quick-field {
    display: grid;
    gap: 6px;
    font-size: 0.82rem;
    font-weight: 850;
    color: #334155;
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.planit-quick-field select {
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.55);
    background: #ffffff;
    font-size: 0.92rem;
    font-weight: 700;
    color: #0f172a;
}

.planit-quick-output {
    display: grid;
    gap: 10px;
}

.planit-quick-summary {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.32);
    background: rgba(248, 250, 252, 0.9);
    padding: 9px 10px;
    color: #1f2937;
    font-weight: 650;
    line-height: 1.35;
    display: grid;
    gap: 4px;
}

.planit-quick-steps {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.planit-quick-step {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.34);
    background: rgba(255, 255, 255, 0.92);
    padding: 9px 10px;
    display: grid;
    gap: 6px;
}

.planit-quick-phase {
    font-size: 0.78rem;
    font-weight: 850;
    color: #0f172a;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.planit-quick-activity {
    font-weight: 900;
    color: #0f172a;
}

.planit-quick-move {
    color: #334155;
    font-size: 0.85rem;
    line-height: 1.35;
    font-weight: 650;
}

.planit-quick-link {
    justify-self: start;
}

.planit-quick-rag {
    display: grid;
    gap: 8px;
}

.planit-rag-lane {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.9);
    padding: 8px 10px;
}

.planit-rag-lane ul {
    margin: 6px 0 0;
    padding-left: 16px;
    display: grid;
    gap: 4px;
}

.planit-rag-title {
    font-size: 0.8rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.planit-rag-red {
    border-color: rgba(239, 68, 68, 0.4);
    background: rgba(254, 242, 242, 0.9);
}

.planit-rag-red .planit-rag-title {
    color: #b91c1c;
}

.planit-rag-yellow {
    border-color: rgba(245, 158, 11, 0.45);
    background: rgba(255, 251, 235, 0.9);
}

.planit-rag-yellow .planit-rag-title {
    color: #92400e;
}

.planit-rag-green {
    border-color: rgba(34, 197, 94, 0.45);
    background: rgba(240, 253, 244, 0.9);
}

.planit-rag-green .planit-rag-title {
    color: #166534;
}

.planit-task-list {
    display: grid;
    gap: 10px;
}

.planit-task {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.92);
}

.planit-task-left {
    display: grid;
    gap: 4px;
}

.planit-task-name {
    font-weight: 900;
    color: #0f172a;
}

.planit-task-meta {
    color: #64748b;
    font-weight: 750;
    font-size: 0.88rem;
}

.planit-task.is-active {
    border-color: rgba(79, 70, 229, 0.55);
    box-shadow: 0 14px 26px rgba(79, 70, 229, 0.12);
}

.planit-task.is-missing {
    border-color: rgba(239, 68, 68, 0.5);
    box-shadow: 0 12px 24px rgba(239, 68, 68, 0.12);
}

.planit-task-label {
    display: grid;
    gap: 6px;
    font-weight: 800;
    color: #334155;
    font-size: 0.88rem;
}

.planit-task-label select {
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.55);
    background: #ffffff;
    font-weight: 700;
    min-width: 170px;
}

.planit-fixed-pill {
    padding: 10px 14px;
    border-radius: 999px;
    font-weight: 900;
    background: rgba(99, 102, 241, 0.12);
    border: 1px solid rgba(99, 102, 241, 0.3);
    color: #312e81;
}

.planit-actions {
    display: grid;
    gap: 10px;
}

.planit-actions-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}

.planit-feedback {
    font-weight: 750;
    color: #0f172a;
    min-height: 1.2em;
}

.planit-feedback-list {
    margin-left: 18px;
    display: grid;
    gap: 6px;
}

.planit-timeline {
    border-radius: 16px;
    border: 1px solid rgba(226, 232, 240, 0.9);
    background: rgba(248, 250, 252, 0.95);
    padding: 12px;
    display: grid;
    grid-template-columns: 92px 1fr;
    grid-auto-rows: 44px;
    gap: 6px;
    position: relative;
    min-height: calc(var(--planit-rows, 8) * 44px + 24px);
    overflow: hidden;
}

.planit-time-row {
    display: contents;
}

.planit-time-label {
    grid-column: 1;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 8px;
    font-weight: 900;
    color: #64748b;
    font-size: 0.85rem;
}

.planit-time-slot {
    grid-column: 2;
    border-radius: 14px;
    border: 1px dashed rgba(148, 163, 184, 0.5);
    background: rgba(255, 255, 255, 0.8);
}

.planit-time-slot.is-available {
    border-style: solid;
    border-color: rgba(34, 197, 94, 0.55);
    background: rgba(34, 197, 94, 0.08);
    cursor: pointer;
}

.planit-time-slot.is-unavailable {
    opacity: 0.5;
}

.planit-block {
    grid-column: 2;
    border-radius: 14px;
    padding: 0 12px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    font-weight: 900;
    color: #0f172a;
    box-shadow: 0 10px 18px rgba(15, 23, 42, 0.08);
    border: 1px solid rgba(99, 102, 241, 0.28);
    background: linear-gradient(135deg, rgba(224, 231, 255, 0.92), rgba(186, 230, 253, 0.65));
    cursor: pointer;
    text-align: left;
}

.planit-block-title {
    font-weight: 900;
    line-height: 1.1;
}

.planit-block-meta {
    font-size: 0.78rem;
    font-weight: 750;
    color: rgba(15, 23, 42, 0.7);
    margin-top: 2px;
}

.planit-block.is-fixed {
    cursor: default;
}

.planit-block.is-overlap {
    border-color: rgba(239, 68, 68, 0.7);
    box-shadow: 0 14px 26px rgba(239, 68, 68, 0.16);
}

.planit-lesson {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(248, 250, 252, 0.9);
    padding: 12px 14px;
    display: grid;
    gap: 8px;
}

.planit-lesson-title {
    font-weight: 900;
    color: #0f172a;
}

.planit-lesson-copy {
    color: #475569;
    font-weight: 650;
    line-height: 1.35;
}

.planit-reflection {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.92);
    padding: 12px 14px;
    display: grid;
    gap: 8px;
}

.planit-reflection-title {
    font-weight: 900;
    color: #0f172a;
}

.planit-reflection-prompt {
    color: #334155;
    font-weight: 700;
    line-height: 1.35;
}

.planit-reflection textarea {
    width: 100%;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    padding: 10px 12px;
    font-family: var(--font-body);
    background: rgba(248, 250, 252, 0.9);
}

.planit-reflection-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.planit-teacher-tools summary {
    cursor: pointer;
    font-weight: 800;
    color: #374151;
}

.planit-teacher-body {
    display: grid;
    gap: 10px;
    margin-top: 10px;
}

.planit-teacher-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
}

.planit-teacher-row input[type="url"] {
    flex: 1 1 260px;
    min-width: 220px;
}

@media (max-width: 1100px) {
    .planit-main {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 680px) {
    .planit-mission-stats {
        grid-template-columns: 1fr;
    }
}

/* ==========================
   Number Sense Sprint
   ========================== */

body.numsense-page {
    min-height: 100dvh;
    height: auto;
    overflow-x: hidden;
    overflow-y: auto;
}

.numsense-header {
    width: 100%;
    max-width: var(--page-max);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
    flex-wrap: wrap;
    gap: 12px;
}

.numsense-subtitle {
    color: #334155;
    font-weight: 650;
    margin-top: 4px;
}

.numsense-main {
    width: calc(100% - 32px);
    max-width: var(--page-max);
    display: grid;
    grid-template-columns: minmax(360px, 1.05fr) minmax(340px, 0.95fr);
    gap: 16px;
    padding: 18px;
    margin: 10px 16px 22px;
    background: var(--stage-bg);
    border: 1px solid var(--stage-border);
    border-radius: 28px;
    box-shadow: var(--stage-shadow);
    backdrop-filter: blur(10px);
    align-items: start;
}

.numsense-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--lab-radius);
    padding: 16px;
    border: 1px solid var(--lab-border);
    box-shadow: var(--lab-shadow);
    display: flex;
    flex-direction: column;
    gap: 12px;
    position: relative;
    overflow: hidden;
    min-width: 0;
}

.numsense-panel::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, rgba(249, 115, 22, 0.75), rgba(14, 165, 233, 0.85), rgba(99, 102, 241, 0.85));
    opacity: 0.9;
    pointer-events: none;
}

.numsense-panel > * {
    position: relative;
    z-index: 1;
}

.numsense-panel-header {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: flex-start;
    flex-wrap: wrap;
}

.numsense-help {
    color: #475569;
    font-weight: 650;
    margin-top: 6px;
    line-height: 1.35;
}

.numsense-setup-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    align-items: end;
}

.numsense-field {
    display: grid;
    gap: 6px;
    font-size: 0.82rem;
    font-weight: 850;
    color: #334155;
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.numsense-field.is-hidden {
    display: none;
}

.numsense-field select {
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.55);
    background: #ffffff;
    font-size: 0.92rem;
    font-weight: 700;
    color: #0f172a;
}

.numsense-start {
    min-height: 42px;
}

.numsense-hud {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.numsense-hud-item {
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    background: rgba(248, 250, 252, 0.88);
    color: #0f172a;
    font-weight: 800;
    font-size: 0.86rem;
}

.numsense-card {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.94);
    padding: 14px;
    display: grid;
    gap: 10px;
}

.numsense-kicker {
    font-size: 0.78rem;
    font-weight: 900;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #475569;
}

.numsense-card h3 {
    color: #0f172a;
    line-height: 1.3;
}

.numsense-stem {
    color: #334155;
    font-weight: 700;
    line-height: 1.35;
    min-height: 1.25em;
}

.numsense-options {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
}

.numsense-options.is-hidden,
.numsense-answer-row.is-hidden {
    display: none !important;
}

.numsense-option {
    border-radius: 14px;
    border: 1px solid rgba(99, 102, 241, 0.3);
    background: rgba(238, 242, 255, 0.88);
    color: #0f172a;
    font-weight: 800;
    min-height: 52px;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 11px;
    text-align: left;
    cursor: pointer;
    transition: transform 0.14s ease, box-shadow 0.14s ease, border-color 0.14s ease;
}

.numsense-option:hover {
    transform: translateY(-1px);
    box-shadow: 0 12px 20px rgba(79, 70, 229, 0.14);
    border-color: rgba(79, 70, 229, 0.55);
}

.numsense-option:disabled {
    cursor: default;
    opacity: 0.95;
}

.numsense-option.is-correct {
    border-color: rgba(34, 197, 94, 0.58);
    background: rgba(240, 253, 244, 0.95);
}

.numsense-option.is-wrong {
    border-color: rgba(239, 68, 68, 0.56);
    background: rgba(254, 242, 242, 0.95);
}

.numsense-option-index {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: rgba(79, 70, 229, 0.15);
    border: 1px solid rgba(79, 70, 229, 0.35);
    color: #312e81;
    font-weight: 900;
    flex: 0 0 auto;
}

.numsense-answer-row {
    display: grid;
    grid-template-columns: auto minmax(120px, 1fr) auto;
    gap: 8px;
    align-items: center;
}

.numsense-answer-label {
    color: #334155;
    font-size: 0.78rem;
    font-weight: 850;
    letter-spacing: 0.04em;
    text-transform: uppercase;
}

.numsense-answer-input {
    width: 100%;
    min-height: 42px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.55);
    background: #ffffff;
    color: #0f172a;
    padding: 0 12px;
    font-size: 0.96rem;
    font-weight: 700;
}

.numsense-answer-input:disabled {
    background: rgba(241, 245, 249, 0.9);
    color: #64748b;
}

.numsense-submit {
    min-height: 42px;
    white-space: nowrap;
}

.numsense-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
}

.numsense-hint-text {
    min-height: 1.2em;
    color: #334155;
    font-weight: 700;
}

.numsense-feedback {
    min-height: 1.2em;
    font-weight: 750;
    color: #0f172a;
}

.numsense-feedback.is-correct {
    color: #166534;
}

.numsense-feedback.is-wrong {
    color: #b91c1c;
}

.numsense-pulse {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.34);
    background: rgba(248, 250, 252, 0.9);
    padding: 12px;
}

.numsense-pulse-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
}

.numsense-pulse-card {
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.34);
    background: rgba(255, 255, 255, 0.92);
    padding: 10px;
    display: grid;
    gap: 7px;
}

.numsense-pulse-card h3 {
    font-size: 0.84rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: #334155;
}

.numsense-pulse-card ul {
    margin: 0;
    padding-left: 16px;
    display: grid;
    gap: 4px;
}

.numsense-pulse-card p {
    color: #0f172a;
    font-weight: 700;
    line-height: 1.35;
}

.numsense-fun-card {
    border-radius: 16px;
    border: 1px solid rgba(14, 165, 233, 0.33);
    background: linear-gradient(135deg, rgba(224, 242, 254, 0.74), rgba(224, 231, 255, 0.7));
    padding: 12px;
    display: grid;
    gap: 8px;
}

.numsense-fun-title {
    font-weight: 900;
    color: #0c4a6e;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    font-size: 0.8rem;
}

.numsense-fun-copy {
    color: #0f172a;
    font-weight: 700;
    line-height: 1.35;
}

.numsense-coach {
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.9);
    padding: 10px 12px;
}

.numsense-coach summary {
    cursor: pointer;
    font-weight: 850;
    color: #0f172a;
}

.numsense-coach ul {
    margin: 10px 0 0;
    padding-left: 18px;
    display: grid;
    gap: 6px;
    color: #1f2937;
    font-weight: 650;
}

.numsense-note {
    color: #475569;
    font-weight: 650;
    line-height: 1.35;
}

.numsense-note a {
    font-weight: 800;
}

.numsense-manip-card {
    border-radius: 16px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    background: rgba(255, 255, 255, 0.92);
    padding: 12px;
    display: grid;
    gap: 10px;
}

.numsense-manip-header {
    display: grid;
    gap: 4px;
}

.numsense-manip-header h3 {
    margin: 0;
    color: #0f172a;
    font-size: 1rem;
}

.numsense-manip-subtitle {
    color: #475569;
    font-size: 0.84rem;
    font-weight: 650;
    line-height: 1.35;
}

.numsense-manip-tool-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.numsense-manip-tool {
    min-height: 34px;
    border-radius: 10px;
}

.numsense-manip-tool.is-active {
    background: linear-gradient(135deg, var(--btn-primary-1) 0%, var(--btn-primary-2) 55%, var(--btn-primary-3) 100%);
    color: #f8fafc;
    border-color: var(--btn-primary-border);
}

.numsense-manip-panel {
    border: 1px solid rgba(148, 163, 184, 0.3);
    border-radius: 12px;
    background: rgba(248, 250, 252, 0.92);
    padding: 10px;
    display: grid;
    gap: 10px;
}

.numsense-manip-controls {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    align-items: end;
}

.numsense-manip-controls input[type="number"] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    background: #ffffff;
    color: #0f172a;
    font-size: 0.92rem;
    font-weight: 700;
}

.numsense-manip-controls input[type="range"] {
    width: 100%;
    accent-color: #4f46e5;
}

.numsense-manip-summary {
    color: #334155;
    font-weight: 800;
    font-size: 0.86rem;
}

.numsense-manip-drag-help {
    color: #475569;
    font-size: 0.8rem;
    font-weight: 700;
    line-height: 1.35;
}

.numsense-base10-tray {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.numsense-base10-piece {
    border: 1px solid rgba(99, 102, 241, 0.4);
    border-radius: 10px;
    background: rgba(238, 242, 255, 0.94);
    color: #312e81;
    padding: 7px 11px;
    font-size: 0.78rem;
    font-weight: 850;
    cursor: grab;
}

.numsense-base10-piece.is-dragging {
    opacity: 0.55;
}

.numsense-base10-view {
    display: grid;
    gap: 8px;
    min-height: 62px;
    border: 1px dashed rgba(148, 163, 184, 0.45);
    border-radius: 10px;
    padding: 8px;
    background: rgba(255, 255, 255, 0.75);
}

.numsense-base10-view.is-drop-target {
    border-color: rgba(79, 70, 229, 0.78);
    box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.16);
}

.numsense-base10-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.numsense-base10-block {
    border: 1px solid rgba(14, 165, 233, 0.45);
    background: rgba(224, 242, 254, 0.88);
    color: #0c4a6e;
    font-size: 0.74rem;
    font-weight: 900;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    padding: 0;
    border-radius: 8px;
}

.numsense-base10-block.hundred {
    width: 54px;
    height: 54px;
}

.numsense-base10-block.ten {
    width: 54px;
    height: 20px;
}

.numsense-base10-block.one {
    width: 18px;
    height: 18px;
    font-size: 0.66rem;
}

.numsense-array-view {
    display: grid;
    gap: 2px;
    justify-content: start;
}

.numsense-array-chip {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    border: 1px solid rgba(99, 102, 241, 0.45);
    background: rgba(224, 231, 255, 0.88);
    appearance: none;
    -webkit-appearance: none;
    cursor: pointer;
    transition: transform 0.08s ease, background 0.14s ease, border-color 0.14s ease;
}

.numsense-array-chip.is-active {
    background: rgba(99, 102, 241, 0.82);
    border-color: rgba(67, 56, 202, 0.85);
}

.numsense-array-chip.is-off {
    background: rgba(241, 245, 249, 0.78);
    border-color: rgba(148, 163, 184, 0.48);
}

.numsense-array-chip:active {
    transform: scale(0.92);
}

.numsense-line-view {
    display: grid;
    gap: 8px;
}

.numsense-line-track {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    overflow-x: auto;
    padding-bottom: 4px;
}

.numsense-line-tick {
    min-width: 30px;
    text-align: center;
    font-size: 0.73rem;
    color: #334155;
    font-weight: 750;
    border: 0;
    background: transparent;
    padding: 0;
    cursor: pointer;
}

.numsense-line-dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    margin: 0 auto 4px;
    background: rgba(148, 163, 184, 0.7);
}

.numsense-line-tick.is-current .numsense-line-dot {
    width: 12px;
    height: 12px;
    background: rgba(79, 70, 229, 0.95);
}

.numsense-line-tick.is-current {
    color: #312e81;
}

@media (max-width: 1100px) {
    .numsense-main {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 740px) {
    .cloze-main,
    .comp-main,
    .fluency-main,
    .madlibs-main,
    .writing-main,
    .planit-main,
    .numsense-main,
    body.word-quest-page #game-canvas {
        width: calc(100% - 20px);
        margin: 8px 10px 18px;
        padding: 12px;
        border-radius: 22px;
    }

    .numsense-answer-row {
        grid-template-columns: 1fr;
    }

    .numsense-answer-label {
        margin-bottom: -2px;
    }

    .numsense-submit {
        width: 100%;
    }

    .numsense-manip-controls {
        grid-template-columns: 1fr;
    }
}

/* ==========================================================================
   Dark theme
   ========================================================================== */

@media (prefers-color-scheme: dark) {
    :root {
        --color-text: #e5e7eb;
        --color-neutral: #334155;
    }

    body {
        background: radial-gradient(circle at top, #233047 0%, #0f172a 60%);
        color: #e5e7eb;
    }

    header {
        color: #e5e7eb;
    }

    h1 {
        color: #f8fafc;
    }

    h2,
    h3,
    .modal-content h2 {
        color: #f8fafc;
    }

    .controls label,
    .controls select,
    .controls option,
    .hint-btn,
    .warmup-title,
    .warmup-subtitle {
        color: #e2e8f0;
    }

    .controls select,
    #pattern-select,
    #length-select,
    #guess-count-select {
        background: #1e293b;
        border-color: #334155;
        color: #e2e8f0;
    }

    .warmup-panel {
        background: rgba(30, 41, 59, 0.9);
        border-color: rgba(51, 65, 85, 0.9);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
    }

    .warmup-btn {
        background: #4338ca;
        border-color: #6366f1;
        color: #eef2ff;
    }

    .warmup-tile {
        background: #0f172a;
        border-color: #334155;
        color: #e2e8f0;
    }

    #game-board {
        background: transparent;
    }

    .tile {
        background: #2b3a52;
        border-color: #64748b;
        color: #f8fafc;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.45);
    }

    .tile.correct {
        background: #22c55e;
        border-color: #4ade80;
        color: #0b1220;
        box-shadow: 0 6px 14px rgba(74, 222, 128, 0.45);
    }

    .tile.present {
        background: #fbbf24;
        border-color: #facc15;
        color: #0b1220;
        box-shadow: 0 6px 14px rgba(250, 204, 21, 0.45);
    }

    .tile.absent {
        background: #344256;
        border-color: #64748b;
        color: #e2e8f0;
        box-shadow: 0 6px 12px rgba(15, 23, 42, 0.5);
    }

    #keyboard {
        color: #e2e8f0;
    }

    .key {
        background: linear-gradient(180deg, #33445e 0%, #243044 100%);
        color: #f8fafc;
        border: 1px solid #475569;
        box-shadow: 0 4px 0 0 #0b1220, 0 6px 12px rgba(0,0,0,0.55);
        text-shadow: 0 1px 2px rgba(0,0,0,0.4);
    }

    .key.correct {
        background: linear-gradient(180deg, #16a34a 0%, #15803d 100%) !important;
        color: #f8fafc !important;
        border-color: #22c55e !important;
    }

    .key.present {
        background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%) !important;
        color: #1f2937 !important;
        border-color: #fbbf24 !important;
    }

    .key.absent {
        background: linear-gradient(180deg, #1f2937 0%, #0f172a 100%) !important;
        color: #cbd5f5 !important;
        border-color: #334155;
    }

    .key.vowel:not(.correct):not(.present):not(.absent) {
        background: linear-gradient(180deg, #5b76c7 0%, #3f4f86 100%);
        border: 1px solid #a5b4fc;
        color: #f8fafc;
        box-shadow: 0 4px 0 0 #0b1220, 0 6px 14px rgba(0,0,0,0.5);
    }

    .modal {
        background: #111827;
        color: #e5e7eb;
        border-color: #1f2937;
    }

    .modal .close-btn,
    .top-right-x {
        color: #cbd5f5;
    }

    .modal-audio-btn,
    .modal-primary-btn {
        background: #1f2937;
        color: #e2e8f0;
        border-color: #334155;
    }

    .adventure-subtitle {
        color: #cbd5f5;
    }

    .adventure-card {
        background: rgba(15, 23, 42, 0.7);
        border-color: rgba(99, 102, 241, 0.35);
    }

    .adventure-card-body h3 {
        color: #f8fafc;
    }

    .adventure-card-body p {
        color: #cbd5f5;
    }

    .adventure-note {
        color: #cbd5f5;
    }

    .adventure-team-settings {
        background: rgba(15, 23, 42, 0.8);
        border-color: rgba(99, 102, 241, 0.35);
    }

    .adventure-team-row input {
        background: #0f172a;
        border-color: #334155;
        color: #e2e8f0;
    }

    .auto-read-label {
        color: #cbd5f5;
    }

    .translation-display {
        background: #0f172a;
        border-left-color: #6366f1;
    }

    #teacher-modal {
        background: linear-gradient(180deg, #0f172a 0%, #111827 100%);
    }

    #teacher-modal label,
    #teacher-modal .teacher-hint,
    #teacher-modal .teacher-subtext,
    #teacher-modal .toggle-row {
        color: #e2e8f0;
    }

    #teacher-modal #custom-word-input,
    #teacher-modal #system-voice-select {
        background: #0f172a;
        border-color: #334155;
        color: #e2e8f0;
    }

    #teacher-modal .teacher-tools {
        background: rgba(15, 23, 42, 0.7);
        border-color: rgba(51, 65, 85, 0.8);
    }

    #teacher-modal.teacher-clean .teacher-block,
    #teacher-modal.teacher-clean .teacher-section {
        background: rgba(15, 23, 42, 0.72);
        border-color: rgba(51, 65, 85, 0.8);
    }

    #teacher-modal.teacher-clean .teacher-section summary {
        color: #e2e8f0;
    }

    #teacher-modal.teacher-clean .teacher-danger summary {
        color: #fca5a5;
    }

    .voice-install-row {
        background: rgba(180, 83, 9, 0.2);
        border-color: rgba(217, 119, 6, 0.5);
        color: #fde68a;
    }

    .voice-install-row button {
        background: #f59e0b;
        color: #0f172a;
    }

    #teacher-modal .teacher-tabs {
        background: rgba(30, 41, 59, 0.8);
    }

    #teacher-modal .teacher-tab-btn {
        color: #cbd5f5;
    }

    #teacher-modal .teacher-tab-btn.active {
        background: #6366f1;
        border-color: #818cf8;
        color: #f8fafc;
        box-shadow: 0 10px 18px rgba(99, 102, 241, 0.35);
    }

    .teacher-pack-row {
        background: rgba(15, 23, 42, 0.65);
        border-color: rgba(51, 65, 85, 0.8);
    }

    .voice-available-row {
        background: rgba(34, 197, 94, 0.12);
        border-color: rgba(74, 222, 128, 0.5);
        color: #bbf7d0;
    }

    .voice-available-row button {
        background: #22c55e;
        color: #0f172a;
    }

    #phoneme-modal {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
    }

    .sound-guide-card,
    .sound-guide-board {
        background: #ffffff;
        border-color: #e2e8f0;
        box-shadow: 0 10px 22px rgba(15, 23, 42, 0.12);
        backdrop-filter: blur(10px);
    }

    .sound-guide-section h3,
    .sound-subsection-title,
    .sound-guide-subtitle {
        color: #1f2937;
        text-shadow: none;
    }

    #phoneme-modal h2 {
        color: #0f172a;
        text-shadow: none;
    }

    .sound-tile {
        background: #f9fbff;
        border-color: #cbd5e1;
        color: #0f172a;
    }

    .sound-tile.vowel {
        background: #eef2ff;
        border-color: #c7d2fe;
        color: #1e3a8a;
    }

    .sound-tile.selected {
        background: #e0e7ff;
        border-color: #6366f1;
        color: #1e293b;
    }

    .info-icon {
        background: rgba(30, 41, 59, 0.9);
        color: #c7d2fe;
    }

    .info-example {
        background: rgba(99, 102, 241, 0.2);
        color: #c7d2fe;
    }

    .selected-sound {
        background: #ffffff;
        border: 1px solid #e2e8f0;
        color: #0f172a;
    }

    .articulation-card {
        background: rgba(15, 23, 42, 0.78);
        border-color: rgba(148, 163, 184, 0.4);
        color: #e2e8f0;
    }

    .articulation-ipa {
        background: rgba(129, 140, 248, 0.18);
        color: #e0e7ff;
    }

    .articulation-visual-wrap {
        background: linear-gradient(145deg, rgba(59, 130, 246, 0.18), rgba(30, 64, 175, 0.25));
        border-color: rgba(129, 140, 248, 0.4);
    }

    .articulation-tip {
        color: #f8fafc;
    }

    .articulation-example,
    .articulation-picture-label {
        color: #cbd5f5;
    }

    .fun-hud {
        background: rgba(30, 41, 59, 0.92);
        border-color: rgba(71, 85, 105, 0.85);
        color: #f8fafc;
    }

    .fun-hud-mini-btn {
        background: rgba(30, 41, 59, 0.9);
        border-color: rgba(71, 85, 105, 0.8);
        color: #e2e8f0;
    }

    .classroom-dock {
        background: linear-gradient(160deg, rgba(15, 23, 42, 0.96), rgba(30, 41, 59, 0.95));
        border-color: rgba(51, 65, 85, 0.8);
    }

    .classroom-dock-header h3 {
        color: #f8fafc;
    }

    .classroom-dock-header p,
    .dock-file-name,
    .dock-hint,
    .dock-timer-set {
        color: #cbd5f5;
    }

    .dock-tab {
        background: rgba(15, 23, 42, 0.7);
        color: #cbd5f5;
        box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.35);
    }

    .dock-tab.active {
        background: #6366f1;
        color: #f8fafc;
    }

    .dock-upload {
        background: rgba(99, 102, 241, 0.25);
        color: #e0e7ff;
    }

    .dock-file-viewer {
        background: rgba(15, 23, 42, 0.5);
        border-color: rgba(148, 163, 184, 0.35);
    }

    .dock-timer-display {
        color: #f8fafc;
    }

    .dock-timer-set select {
        background: #0f172a;
        border-color: #334155;
        color: #e2e8f0;
    }

    body.cloze-page {
        background: radial-gradient(circle at top, #1f2937 0%, #0f172a 60%);
    }

    .cloze-subtitle {
        color: #cbd5f5;
    }

    .cloze-panel {
        background: rgba(15, 23, 42, 0.92);
        border-color: rgba(51, 65, 85, 0.8);
        box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45);
    }

    body.cloze-page .cloze-story {
        background: rgba(30, 41, 59, 0.82);
        border-color: rgba(94, 108, 138, 0.7);
    }

    body.cloze-page .cloze-story .cloze-passage {
        background: rgba(15, 23, 42, 0.45);
        border-color: rgba(100, 116, 139, 0.55);
    }

    .cloze-panel::before {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.18), transparent 60%);
    }

    .cloze-controls select {
        background: #0f172a;
        border-color: #334155;
        color: #e2e8f0;
    }

    .secondary-btn {
        background: #1f2937;
        color: #e2e8f0;
        border-color: #334155;
    }

    .cloze-passage {
        background: rgba(15, 23, 42, 0.6);
        border-color: #334155;
        color: #e2e8f0;
    }

    .cloze-blank {
        background: rgba(30, 41, 59, 0.7);
        border-color: #64748b;
        color: #e2e8f0;
    }

    .cloze-word {
        background: rgba(99, 102, 241, 0.25);
        border-color: #6366f1;
        color: #e2e8f0;
    }

    .cloze-hud {
        background: rgba(15, 23, 42, 0.8);
        border-color: rgba(51, 65, 85, 0.8);
        color: #f8fafc;
    }

    .cloze-toggle {
        color: #cbd5f5;
    }

    body.madlibs-page .madlibs-panel {
        background: rgba(15, 23, 42, 0.78);
        border-color: rgba(51, 65, 85, 0.8);
        box-shadow: 0 16px 28px rgba(0, 0, 0, 0.35);
    }

    body.madlibs-page .madlibs-panel h2 {
        color: #f8fafc;
    }

    body.madlibs-page .madlibs-panel .muted,
    body.madlibs-page .madlibs-panel label {
        color: #cbd5f5;
    }

    body.madlibs-page .madlibs-panel input[type="text"],
    body.madlibs-page .madlibs-panel textarea,
    body.madlibs-page .madlibs-panel select {
        background: rgba(15, 23, 42, 0.6);
        border-color: #334155;
        color: #e2e8f0;
    }

    body.madlibs-page .madlibs-field {
        background: rgba(30, 41, 59, 0.6);
        border-color: rgba(51, 65, 85, 0.7);
    }

    body.madlibs-page .madlibs-output {
        background: rgba(15, 23, 42, 0.6);
        border-color: #334155;
        color: #e2e8f0;
        background-image: linear-gradient(transparent 0%, transparent 92%, rgba(129, 140, 248, 0.2) 92%, rgba(129, 140, 248, 0.2) 100%);
    }

    body.comprehension-page,
    body.fluency-page {
        background: radial-gradient(circle at top, #1f2937 0%, #0f172a 60%);
        color: #e2e8f0;
    }

    body.comprehension-page .comp-panel,
    body.fluency-page .fluency-panel {
        background: rgba(15, 23, 42, 0.85);
        border-color: rgba(51, 65, 85, 0.8);
        box-shadow: 0 16px 30px rgba(0, 0, 0, 0.45);
    }

    body.comprehension-page .comp-passage,
    body.fluency-page .fluency-passage {
        background: rgba(15, 23, 42, 0.6);
        border-color: #334155;
        color: #e2e8f0;
    }

    body.comprehension-page .comp-choice {
        background: rgba(30, 41, 59, 0.85);
        border-color: rgba(71, 85, 105, 0.8);
        color: #f8fafc;
    }

    body.comprehension-page .comp-question {
        background: rgba(30, 41, 59, 0.9);
        border-color: rgba(71, 85, 105, 0.8);
        color: #f8fafc;
    }

    body.comprehension-page .comp-question h3 {
        color: #f8fafc;
    }

    body.comprehension-page .comp-question-meta {
        color: #c7d2fe;
    }

    body.comprehension-page .comp-choice span {
        color: #f8fafc;
    }

    body.comprehension-page .comp-hud,
    body.fluency-page .fluency-hud {
        background: rgba(99, 102, 241, 0.2);
        color: #e2e8f0;
    }

    body.comprehension-page .comp-controls select,
    body.fluency-page .fluency-controls select,
    body.fluency-page .fluency-score input {
        background: #0f172a;
        border-color: #334155;
        color: #e2e8f0;
    }
}

@media (max-height: 900px) {
    body.word-quest-page header {
        padding: 6px 10px 4px;
    }

    body.word-quest-page .header-top {
        margin-bottom: 6px;
    }

    body.word-quest-page .header-actions .link-btn {
        padding: 6px 10px;
        font-size: 0.85rem;
    }

    body.word-quest-page .controls {
        gap: 8px;
        margin-bottom: 4px;
    }

    body.word-quest-page #game-canvas {
        gap: clamp(10px, 1.2vh, 14px);
        padding: 12px 12px 10px;
        justify-content: flex-start;
    }

    body.word-quest-page #game-board {
        margin: 8px auto;
        gap: 7px;
        padding: 12px;
    }

    body.word-quest-page .hint-actions {
        margin: 2px 0;
    }

    body.word-quest-page #keyboard {
        margin-bottom: 6px;
        padding: 8px 8px 10px;
    }

    .comp-main,
    .fluency-main {
        gap: 12px;
        padding-bottom: 12px;
    }

    .comp-panel,
    .fluency-panel {
        padding: 10px;
    }

    .comp-passage,
    .fluency-passage {
        min-height: 120px;
    }

    .comp-header {
        padding: 6px 10px;
    }

    .comp-subtitle {
        font-size: 0.85rem;
    }

    .comp-question {
        padding: 8px 10px;
    }

    .comp-question h3 {
        font-size: 0.95rem;
    }

    .comp-choice {
        padding: 5px 8px;
        font-size: 0.9rem;
    }
}

@media (max-width: 720px) {
    header {
        padding: 10px 12px 4px;
    }

    .header-top {
        gap: 8px;
        margin-bottom: 6px;
    }

    h1 {
        font-size: 1.25rem;
    }

    .controls {
        gap: 8px;
        row-gap: 6px;
    }

    .hint-actions {
        gap: 6px;
        margin: 2px 0;
    }

    .hint-actions .hint-btn {
        padding: 6px 10px;
        font-size: 0.8rem;
    }

    #keyboard {
        max-width: 100%;
        gap: 5px;
    }

    .keyboard-row {
        gap: 3px;
    }

    .key {
        height: clamp(34px, 7vw, 42px);
        font-size: clamp(0.8rem, 2.4vw, 0.95rem);
        max-width: clamp(34px, 9vw, 48px);
    }
}

@media (max-width: 560px) {
    .controls {
        grid-template-columns: 1fr;
        justify-items: stretch;
    }

    .controls select,
    #pattern-select,
    #length-select,
    #guess-count-select {
        width: 100%;
    }

    .hint-actions {
        gap: 5px;
    }

    .hint-actions .hint-btn {
        padding: 6px 8px;
        font-size: 0.78rem;
    }

    #game-canvas {
        gap: 8px;
    }
}

.madlibs-main {
    flex: 1;
    min-height: 0;
    align-content: start;
    padding-bottom: clamp(16px, 2.5vh, 28px);
    position: relative;
    z-index: 1;
}

.madlibs-panel {
    min-height: 0;
}

@media (max-height: 860px) {
    .madlibs-header {
        padding: 10px 12px;
    }

    .madlibs-main {
        gap: 14px;
        padding: 0 12px 12px;
    }

    .madlibs-panel {
        padding: 14px;
    }

    .madlibs-panel textarea {
        min-height: 96px;
    }

    .madlibs-output {
        min-height: 110px;
    }
}

@media (max-height: 760px) {
    .madlibs-main {
        gap: 10px;
        padding: 0 10px 10px;
    }

    .madlibs-panel {
        padding: 12px;
    }

    .madlibs-panel textarea {
        min-height: 80px;
    }

    #madlibs-fields {
        gap: 6px;
    }

    .madlibs-field {
        padding: 6px;
    }

    .madlibs-output {
        min-height: 96px;
    }
}

/* ==========================================================================
   Force Light Theme Override (for projectors & light-mode consistency)
   ========================================================================== */

body.force-light {
    background:
        radial-gradient(circle at 12% 10%, rgba(56, 189, 248, 0.16), transparent 46%),
        radial-gradient(circle at 88% 8%, rgba(251, 146, 60, 0.16), transparent 44%),
        radial-gradient(circle at 50% 82%, rgba(99, 102, 241, 0.12), transparent 50%),
        linear-gradient(180deg, #fbfdff 0%, #eef4ff 55%, #e6eefb 100%) !important;
    color: #0f172a !important;
    color-scheme: light;
}

body.force-light header,
body.force-light h1,
body.force-light h2,
body.force-light h3 {
    color: #0f172a !important;
}

body.force-light .controls label,
body.force-light .controls select,
body.force-light .controls option {
    color: #1f2937 !important;
}

body.force-light .cloze-subtitle,
body.force-light .comp-subtitle,
body.force-light .fluency-subtitle,
body.force-light .madlibs-subtitle,
body.force-light .writing-subtitle,
body.force-light .planit-subtitle,
body.force-light .numsense-subtitle,
body.force-light .sound-guide-subtitle,
body.force-light .howto-subtitle {
    color: #1f2937 !important;
}

body.force-light #modal-overlay {
    background: rgba(15, 23, 42, 0.18) !important;
}

body.warmup-open #game-canvas {
    opacity: 0.12;
    filter: blur(2px);
    pointer-events: none;
}

body.force-light .modal,
body.force-light #teacher-modal,
body.force-light .classroom-dock,
body.force-light .cloze-panel,
body.force-light .comp-panel,
body.force-light .fluency-panel,
body.force-light .madlibs-panel,
body.force-light .numsense-panel,
body.force-light .sound-guide-card,
body.force-light .sound-guide-board,
body.force-light .selected-sound,
body.force-light .articulation-card,
body.force-light .fun-hud {
    background: #ffffff !important;
    color: #0f172a !important;
    border-color: #e2e8f0 !important;
}

/* Force light should win even when OS is in dark mode (avoids washed-out Teacher modal text). */
body.force-light #teacher-modal label,
body.force-light #teacher-modal .toggle-row,
body.force-light #teacher-modal .practice-pack-label,
body.force-light #teacher-modal .practice-pack-label strong {
    color: #1f2937;
}

body.force-light #teacher-modal .teacher-subtext,
body.force-light #teacher-modal .teacher-hint,
body.force-light #teacher-modal .practice-pack-label span {
    color: #6b7280;
}

body.force-light .activity-teacher-tools,
body.force-light .activity-lesson {
    background: #ffffff !important;
    color: #0f172a !important;
    border-color: #e2e8f0 !important;
}

body.force-light .activity-teacher-tools summary,
body.force-light .activity-lesson-title {
    color: #1f2937 !important;
}

body.force-light .activity-teacher-tools .muted,
body.force-light .activity-lesson-copy {
    color: #6b7280 !important;
}

/* Force light should also win on Mad Libs text (avoids pale dark-mode labels on white panels). */
body.force-light.madlibs-page .madlibs-panel label,
body.force-light.madlibs-page .madlibs-panel summary,
body.force-light.madlibs-page .madlibs-panel .translation-toggle {
    color: #374151 !important;
}

body.force-light.madlibs-page .madlibs-panel .muted,
body.force-light.madlibs-page .madlibs-field .field-help,
body.force-light.madlibs-page .madlibs-output.empty {
    color: #6b7280 !important;
}

body.force-light #teacher-modal #custom-word-input,
body.force-light #teacher-modal #system-voice-select {
    background: #ffffff;
    border-color: #d1d5db;
    color: #0f172a;
}

body.force-light .tile.correct {
    background: #22c55e !important;
    border-color: #16a34a !important;
    color: #0b1220 !important;
}

body.force-light .tile.present {
    background: #fbbf24 !important;
    border-color: #f59e0b !important;
    color: #1f2937 !important;
}

body.force-light .tile.absent {
    background: var(--color-absent) !important;
    border-color: #334155 !important;
    color: #f8fafc !important;
}

body.force-light .wordle-help .tile.ex.green {
    background: var(--color-correct) !important;
    border-color: transparent !important;
    color: #ffffff !important;
}

body.force-light .wordle-help .tile.ex.yellow {
    background: var(--color-present) !important;
    border-color: transparent !important;
    color: #1f2937 !important;
}

body.force-light .wordle-help .tile.ex.gray {
    background: var(--color-absent) !important;
    border-color: transparent !important;
    color: #ffffff !important;
}

body.force-light .key.correct {
    background: #22c55e !important;
    border-color: #16a34a !important;
    color: #ffffff !important;
}

body.force-light .key.present {
    background: #fbbf24 !important;
    border-color: #f59e0b !important;
    color: #1f2937 !important;
}

body.force-light .key.absent {
    background: linear-gradient(180deg, #64748b 0%, #475569 100%) !important;
    border-color: #334155 !important;
    color: #f8fafc !important;
    box-shadow: 0 3px 0 0 #334155, 0 4px 10px rgba(15, 23, 42, 0.14) !important;
}

body.force-light .key:not(.correct):not(.present):not(.absent) {
    background: linear-gradient(180deg, #ffffff 0%, #edf2fb 100%) !important;
    border-color: #a5b4c6 !important;
    color: #0f172a !important;
    box-shadow: 0 4px 0 0 #9db0c9, 0 4px 10px rgba(15, 23, 42, 0.16) !important;
}

body.force-light .key.vowel:not(.correct):not(.present):not(.absent) {
    background: linear-gradient(180deg, #dbeafe 0%, #bfdbfe 100%) !important;
    border-color: #5b8ff7 !important;
    color: #0f172a !important;
    box-shadow: 0 4px 0 0 #9fb8e8, 0 4px 10px rgba(15, 23, 42, 0.15) !important;
}

body.force-light .fun-hud-mini-btn {
    background: #f8fafc !important;
    border-color: #dbe3ee !important;
    color: #1f2937 !important;
}

body.force-light select,
body.force-light input,
body.force-light textarea {
    background: #ffffff !important;
    color: #0f172a !important;
    border-color: #cbd5e1 !important;
}

body.force-light .dock-tab,
body.force-light .dock-upload,
body.force-light .dock-file-viewer,
body.force-light .dock-timer-set select,
body.force-light .dock-timer-display,
body.force-light .dock-file-name,
body.force-light .dock-hint,
body.force-light .dock-timer-set {
    color: #0f172a !important;
}

body.force-light .dock-tab {
    background: #f8fafc !important;
    border-color: #dbe3ee !important;
}

body.force-light .dock-tab.active {
    background: #4f46e5 !important;
    color: #ffffff !important;
}

body.force-light #teacher-modal .teacher-tools,
body.force-light #teacher-modal.teacher-clean .teacher-block,
body.force-light #teacher-modal.teacher-clean .teacher-section,
body.force-light .teacher-pack-row {
    background: #f8fafc !important;
    border-color: #e2e8f0 !important;
    color: #0f172a !important;
}

body.force-light .cloze-story,
body.force-light .cloze-passage,
body.force-light .comp-passage,
body.force-light .fluency-passage,
body.force-light .comp-choice,
body.force-light .comp-question,
body.force-light .madlibs-output,
body.force-light .madlibs-field,
body.force-light .translation-display,
body.force-light .adventure-card,
body.force-light .adventure-team-settings {
    background: #ffffff !important;
    border-color: #e2e8f0 !important;
    color: #0f172a !important;
}

body.force-light .cloze-blank {
    background: linear-gradient(180deg, rgba(238, 242, 255, 0.95), rgba(224, 231, 255, 0.75)) !important;
    border-color: rgba(99, 102, 241, 0.35) !important;
    color: #1f2937 !important;
    box-shadow: inset 0 0 0 1px rgba(99, 102, 241, 0.12) !important;
}

body.force-light .cloze-blank:hover {
    background: rgba(99, 102, 241, 0.18) !important;
}

body.force-light .cloze-blank.correct {
    background: #d1fae5 !important;
    border-color: #10b981 !important;
    color: #065f46 !important;
}

body.force-light .cloze-blank.wrong {
    background: #fee2e2 !important;
    border-color: #ef4444 !important;
    color: #991b1b !important;
}

body.force-light .cloze-word {
    background: #ffffff !important;
    border-color: rgba(99, 102, 241, 0.35) !important;
    color: #312e81 !important;
    box-shadow: 0 6px 14px rgba(79, 70, 229, 0.12) !important;
}

body.force-light .cloze-hud,
body.force-light .comp-hud,
body.force-light .fluency-hud {
    background: rgba(99, 102, 241, 0.12) !important;
    color: #0f172a !important;
}

/* ==========================================================================
   Bundle 1 — Word Quest Visibility (Keep Last)
   - Stronger contrast for empty tiles/keyboard on bright projectors.
   - Scoped to Word Quest so other activities keep their intended look.
   ========================================================================== */

body.word-quest-page #game-canvas {
    border-color: rgba(71, 85, 105, 0.28);
    box-shadow: 0 26px 70px rgba(15, 23, 42, 0.12);
}

body.word-quest-page #game-board {
    background: linear-gradient(180deg, rgba(15, 23, 42, 0.06) 0%, rgba(15, 23, 42, 0.03) 100%);
    border: 1px solid rgba(100, 116, 139, 0.32);
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.82),
        0 18px 40px rgba(15, 23, 42, 0.08);
}

body.word-quest-page .tile:not(.correct):not(.present):not(.absent) {
    background: linear-gradient(180deg, #ffffff 0%, #e7efff 100%);
    border-color: rgba(51, 65, 85, 0.30);
    box-shadow:
        0 12px 26px rgba(15, 23, 42, 0.14),
        inset 0 1px 0 rgba(255, 255, 255, 0.9),
        inset 0 -2px 0 rgba(15, 23, 42, 0.08);
}

body.word-quest-page .tile.row-active:not(.correct):not(.present):not(.absent) {
    border-color: rgba(79, 70, 229, 0.62);
    background: linear-gradient(180deg, rgba(224, 231, 255, 1) 0%, rgba(255, 255, 255, 0.96) 100%);
    color: #0f172a;
    text-shadow: none;
}

body.word-quest-page .tile.active.row-active:not(.correct):not(.present):not(.absent) {
    color: #0f172a;
    text-shadow: none;
}

body.word-quest-page .tile.vowel:not(.correct):not(.present):not(.absent) {
    border-color: rgba(14, 116, 144, 0.46);
    background: linear-gradient(180deg, #ecfeff 0%, #e0f2fe 100%);
}

body.word-quest-page #keyboard {
    background: linear-gradient(180deg, rgba(15, 23, 42, 0.04) 0%, rgba(15, 23, 42, 0.02) 100%);
    border: 1px solid rgba(100, 116, 139, 0.22);
    border-radius: 20px;
    box-shadow: 0 16px 36px rgba(15, 23, 42, 0.08);
}

body.word-quest-page .key:not(.correct):not(.present):not(.absent) {
    background: linear-gradient(180deg, #ffffff 0%, #e9eeff 100%);
    border-color: rgba(51, 65, 85, 0.24);
    color: #0f172a;
    text-shadow: none;
    box-shadow: 0 4px 0 rgba(148, 163, 184, 0.68), 0 10px 18px rgba(15, 23, 42, 0.14);
}

/* Force-light uses !important in a few places; keep Word Quest contrast consistent. */
body.force-light.word-quest-page #game-board {
    background: linear-gradient(180deg, rgba(15, 23, 42, 0.06) 0%, rgba(15, 23, 42, 0.03) 100%) !important;
    border-color: rgba(100, 116, 139, 0.32) !important;
}

body.force-light.word-quest-page .tile:not(.correct):not(.present):not(.absent) {
    background: linear-gradient(180deg, #ffffff 0%, #e7efff 100%) !important;
    border-color: rgba(51, 65, 85, 0.30) !important;
    color: #0f172a !important;
    text-shadow: none !important;
}

body.force-light.word-quest-page .tile.active.row-active:not(.correct):not(.present):not(.absent) {
    color: #0f172a !important;
    text-shadow: none !important;
}

body.force-light.word-quest-page .tile.vowel:not(.correct):not(.present):not(.absent) {
    border-color: rgba(14, 116, 144, 0.46) !important;
    background: linear-gradient(180deg, #ecfeff 0%, #e0f2fe 100%) !important;
}

body.force-light.word-quest-page .key:not(.correct):not(.present):not(.absent) {
    background: linear-gradient(180deg, #ffffff 0%, #e9eeff 100%) !important;
    border-color: rgba(51, 65, 85, 0.24) !important;
    color: #0f172a !important;
    text-shadow: none !important;
}

/* ==========================================================================
   Word Quest — Fit-To-Screen (prevents keyboard overlap at 100% zoom)
   ========================================================================== */

body.word-quest-page.fit-screen header {
    padding: 10px 12px 4px;
}

body.word-quest-page.fit-screen .header-top {
    margin-bottom: 6px;
}

body.word-quest-page.fit-screen .header-actions .link-btn {
    padding: 6px 10px;
    font-size: 0.85rem;
}

body.word-quest-page.fit-screen .controls {
    gap: 8px;
    margin-bottom: 4px;
}

body.word-quest-page.fit-screen #game-canvas {
    margin: 8px 12px 12px;
    padding: 12px 12px 12px;
    gap: clamp(10px, 1.2vh, 14px);
}

body.word-quest-page.fit-screen #game-board {
    padding: 12px;
    gap: 7px;
}

body.word-quest-page.fit-screen .tile {
    width: min(66px, 11vw, 7.8vh);
    height: min(66px, 11vw, 7.8vh);
    font-size: min(2.2rem, 5vw, 4.4vh);
}

body.word-quest-page.fit-screen .quick-row {
    margin-bottom: 8px;
}

body.word-quest-page.fit-screen .audio-play-btn {
    padding: 8px 14px;
    font-size: 0.9rem;
    border-radius: 10px;
}

body.word-quest-page.fit-screen #keyboard {
    padding: 8px 8px 10px;
    gap: 5px;
    margin-bottom: 4px;
}

body.word-quest-page.fit-screen .key {
    height: min(50px, 8.6vw, 6.4vh);
    font-size: min(1.05rem, 3.2vw, 2.9vh);
    max-width: 56px;
}

body.word-quest-page.fit-screen-tight #game-canvas {
    margin: 6px 10px 10px;
    padding: 10px 10px 10px;
    gap: clamp(8px, 1vh, 12px);
}

body.word-quest-page.fit-screen-tight #game-board {
    padding: 10px;
    gap: 6px;
}

body.word-quest-page.fit-screen-tight .tile {
    width: min(60px, 10.5vw, 7.1vh);
    height: min(60px, 10.5vw, 7.1vh);
    font-size: min(2rem, 4.6vw, 4vh);
}

body.word-quest-page.fit-screen-tight .quick-row {
    margin-bottom: 6px;
}

body.word-quest-page.fit-screen-tight .audio-play-btn {
    padding: 7px 12px;
    font-size: 0.85rem;
}

body.word-quest-page.fit-screen-tight #keyboard {
    padding: 7px 7px 9px;
    gap: 4px;
}

body.word-quest-page.fit-screen-tight .key {
    height: min(46px, 7.8vw, 5.8vh);
    font-size: min(0.98rem, 3vw, 2.6vh);
    max-width: 52px;
}

/* ==========================================================================
   Bundle 1 — Age-Based UI Looks (K–2 / 3–5 / 6–12)
   Notes:
   - These are purely presentational (same activities + content).
   - Keep projector-safe contrast and calm motion.
   ========================================================================== */

body.look-k2 {
    --lab-radius: 22px;
    --stage-border: rgba(71, 85, 105, 0.30);
    --stage-shadow: 0 26px 72px rgba(15, 23, 42, 0.12);
    --accent-primary: #4f46e5;
    --accent-secondary: #0ea5e9;
    --accent-warm: #f97316;
}

body.look-k2 .primary-btn,
body.look-k2 .secondary-btn,
body.look-k2 .action-btn {
    border-radius: 18px;
}

body.look-k2 .tile,
body.look-k2 .key {
    border-radius: 16px;
}

body.look-35 {
    /* Balanced is the default Bright Lab look. */
}

body.look-612 {
    --font-heading: 'Nunito', 'Atkinson Hyperlegible', system-ui, -apple-system, sans-serif;
    --lab-radius: 14px;
    --stage-border: rgba(100, 116, 139, 0.34);
    --stage-shadow: 0 18px 46px rgba(15, 23, 42, 0.10);
}

body.look-612::before {
    opacity: 0.14;
}

body.look-612 .primary-btn,
body.look-612 .secondary-btn,
body.look-612 .action-btn {
    border-radius: 12px;
}

body.look-612 .tile,
body.look-612 .key {
    border-radius: 12px;
}

/* ==========================================================================
   Bundle 1 — Activity Palettes (adds gentle "fun" without chaos)
   ========================================================================== */

body.home-page,
body.word-quest-page {
    --panel-accent: linear-gradient(90deg, rgba(99, 102, 241, 0.92), rgba(14, 165, 233, 0.82), rgba(249, 115, 22, 0.62));
    --brand-accent: linear-gradient(135deg, rgba(99, 102, 241, 0.95), rgba(14, 165, 233, 0.85), rgba(249, 115, 22, 0.7));
    --btn-primary-1: #6366f1;
    --btn-primary-2: #4f46e5;
    --btn-primary-3: #4338ca;
    --btn-primary-border: rgba(99, 102, 241, 0.6);
    --btn-primary-shadow: rgba(79, 70, 229, 0.32);
    --btn-secondary-hover: rgba(99, 102, 241, 0.12);
}

body.cloze-page {
    --panel-accent: linear-gradient(90deg, rgba(14, 165, 233, 0.92), rgba(99, 102, 241, 0.84), rgba(168, 85, 247, 0.62));
    --brand-accent: linear-gradient(135deg, rgba(14, 165, 233, 0.95), rgba(99, 102, 241, 0.85), rgba(168, 85, 247, 0.7));
    --btn-primary-1: #0ea5e9;
    --btn-primary-2: #4f46e5;
    --btn-primary-3: #4338ca;
    --btn-primary-border: rgba(14, 165, 233, 0.55);
    --btn-primary-shadow: rgba(14, 165, 233, 0.28);
    --btn-secondary-hover: rgba(14, 165, 233, 0.12);
}

body.comprehension-page {
    --panel-accent: linear-gradient(90deg, rgba(20, 184, 166, 0.92), rgba(14, 165, 233, 0.84), rgba(99, 102, 241, 0.62));
    --brand-accent: linear-gradient(135deg, rgba(20, 184, 166, 0.95), rgba(14, 165, 233, 0.85), rgba(99, 102, 241, 0.7));
    --btn-primary-1: #14b8a6;
    --btn-primary-2: #0ea5e9;
    --btn-primary-3: #2563eb;
    --btn-primary-border: rgba(20, 184, 166, 0.55);
    --btn-primary-shadow: rgba(20, 184, 166, 0.26);
    --btn-secondary-hover: rgba(20, 184, 166, 0.12);
}

body.fluency-page {
    --panel-accent: linear-gradient(90deg, rgba(249, 115, 22, 0.92), rgba(234, 179, 8, 0.84), rgba(99, 102, 241, 0.56));
    --brand-accent: linear-gradient(135deg, rgba(249, 115, 22, 0.95), rgba(234, 179, 8, 0.86), rgba(99, 102, 241, 0.66));
    --btn-primary-1: #f97316;
    --btn-primary-2: #f59e0b;
    --btn-primary-3: #ea580c;
    --btn-primary-border: rgba(249, 115, 22, 0.55);
    --btn-primary-shadow: rgba(249, 115, 22, 0.26);
    --btn-secondary-hover: rgba(249, 115, 22, 0.12);
}

body.madlibs-page {
    --panel-accent: linear-gradient(90deg, rgba(168, 85, 247, 0.92), rgba(99, 102, 241, 0.82), rgba(249, 115, 22, 0.56));
    --brand-accent: linear-gradient(135deg, rgba(168, 85, 247, 0.95), rgba(99, 102, 241, 0.84), rgba(249, 115, 22, 0.66));
    --btn-primary-1: #a855f7;
    --btn-primary-2: #6366f1;
    --btn-primary-3: #4338ca;
    --btn-primary-border: rgba(168, 85, 247, 0.55);
    --btn-primary-shadow: rgba(168, 85, 247, 0.26);
    --btn-secondary-hover: rgba(168, 85, 247, 0.12);
}

body.writing-page {
    --panel-accent: linear-gradient(90deg, rgba(236, 72, 153, 0.92), rgba(249, 115, 22, 0.76), rgba(234, 179, 8, 0.62));
    --brand-accent: linear-gradient(135deg, rgba(236, 72, 153, 0.95), rgba(249, 115, 22, 0.82), rgba(234, 179, 8, 0.7));
    --btn-primary-1: #ec4899;
    --btn-primary-2: #f97316;
    --btn-primary-3: #ea580c;
    --btn-primary-border: rgba(236, 72, 153, 0.55);
    --btn-primary-shadow: rgba(236, 72, 153, 0.25);
    --btn-secondary-hover: rgba(236, 72, 153, 0.12);
}

body.planit-page {
    --panel-accent: linear-gradient(90deg, rgba(132, 204, 22, 0.92), rgba(16, 185, 129, 0.82), rgba(14, 165, 233, 0.58));
    --brand-accent: linear-gradient(135deg, rgba(132, 204, 22, 0.95), rgba(16, 185, 129, 0.84), rgba(14, 165, 233, 0.68));
    --btn-primary-1: #84cc16;
    --btn-primary-2: #10b981;
    --btn-primary-3: #0ea5e9;
    --btn-primary-border: rgba(16, 185, 129, 0.55);
    --btn-primary-shadow: rgba(16, 185, 129, 0.25);
    --btn-secondary-hover: rgba(16, 185, 129, 0.12);
}

/* ==========================================================================
   Bundle 2 — Neuro-inclusive supports
   - Consistent breadcrumb + progress "Story Track"
   - Focus mode + reduced stimulation
   - AAC-style quick responses
   ========================================================================== */

body {
    --neuro-surface: rgba(250, 249, 246, 0.96);
    --neuro-surface-strong: rgba(250, 249, 246, 0.99);
    --neuro-border: rgba(95, 126, 128, 0.30);
    --neuro-text: #333333;
    --neuro-subtle: #4b5563;
    --neuro-accent: #5f9ea0;
    --neuro-accent-soft: rgba(95, 158, 160, 0.18);
}

body.font-atkinson {
    --font-body: 'Atkinson Hyperlegible', 'Nunito', system-ui, -apple-system, sans-serif;
    --font-reading: 'Atkinson Hyperlegible', 'Nunito', system-ui, -apple-system, sans-serif;
}

body.font-opendyslexic {
    --font-body: 'OpenDyslexic', 'Open Dyslexic', 'Atkinson Hyperlegible', 'Nunito', system-ui, -apple-system, sans-serif;
    --font-reading: 'OpenDyslexic', 'Open Dyslexic', 'Atkinson Hyperlegible', 'Nunito', system-ui, -apple-system, sans-serif;
}

body.has-story-track:not(.word-quest-page) main {
    padding-bottom: max(128px, calc(112px + env(safe-area-inset-bottom, 0px)));
}

.activity-breadcrumb {
    margin: 8px auto 0;
    width: min(calc(100% - 24px), var(--page-max));
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid var(--neuro-border);
    background: var(--neuro-surface);
    color: var(--neuro-text);
    font-size: 0.9rem;
    font-weight: 700;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
}

.activity-breadcrumb a {
    color: #2f5f64;
    text-decoration: none;
}

.activity-breadcrumb a:hover,
.activity-breadcrumb a:focus-visible {
    text-decoration: underline;
}

.breadcrumb-sep {
    color: #64748b;
}

.breadcrumb-current {
    color: #1f2937;
}

.global-accessibility-tools {
    margin-left: auto;
    flex-shrink: 0;
    border: 1px solid var(--neuro-border);
    border-radius: 12px;
    background: var(--neuro-surface);
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
}

.global-accessibility-tools summary {
    list-style: none;
    cursor: pointer;
    font-weight: 800;
    color: #1f2937;
    padding: 8px 12px;
    border-radius: 12px;
}

.global-accessibility-tools summary::-webkit-details-marker {
    display: none;
}

.global-accessibility-tools[open] summary {
    border-bottom: 1px dashed rgba(95, 126, 128, 0.4);
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}

.global-accessibility-body {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px 14px;
    padding: 10px 12px 12px;
}

.global-accessibility-body label {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--neuro-text);
    font-weight: 650;
    font-size: 0.9rem;
}

.global-accessibility-body input[type="checkbox"] {
    accent-color: var(--neuro-accent);
}

.global-accessibility-font-label {
    grid-column: 1 / -1;
    justify-content: space-between;
}

.global-accessibility-font-label select {
    min-width: 190px;
    border-radius: 10px;
    border: 1px solid rgba(95, 126, 128, 0.42);
    background: #ffffff;
    color: #1f2937;
    padding: 6px 10px;
}

.global-accessibility-reset {
    grid-column: 1 / -1;
    justify-self: start;
}

.story-track {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: max(10px, env(safe-area-inset-bottom, 0px));
    width: min(calc(100% - 20px), var(--page-max));
    border: 1px solid var(--neuro-border);
    border-radius: 16px;
    background: var(--neuro-surface-strong);
    box-shadow: 0 16px 30px rgba(15, 23, 42, 0.14);
    backdrop-filter: blur(8px);
    z-index: 1200;
    padding: 10px 12px;
}

.story-track-top {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 10px;
}

.story-track-title {
    color: var(--neuro-text);
    font-weight: 800;
    letter-spacing: 0.01em;
}

.story-track-percent {
    color: var(--neuro-subtle);
    font-weight: 700;
    font-size: 0.86rem;
}

.story-track-progress {
    margin-top: 8px;
    width: 100%;
    height: 9px;
    border-radius: 999px;
    background: rgba(148, 163, 184, 0.28);
    overflow: hidden;
}

.story-track-progress-fill {
    width: 0;
    height: 100%;
    border-radius: inherit;
    background: linear-gradient(90deg, rgba(95, 158, 160, 0.95), rgba(134, 188, 145, 0.95));
    transition: width 220ms ease;
}

.story-track-steps {
    margin-top: 8px;
    display: flex;
    gap: 8px;
    overflow-x: auto;
    scrollbar-width: thin;
    padding-bottom: 2px;
}

.story-track-step {
    flex: 0 0 auto;
    text-decoration: none;
    color: #1f2937;
    border: 1px solid rgba(148, 163, 184, 0.44);
    border-radius: 999px;
    background: #ffffff;
    padding: 6px 10px;
    font-size: 0.83rem;
    font-weight: 700;
    white-space: nowrap;
}

.story-track-step.is-complete {
    border-color: rgba(95, 158, 160, 0.72);
    background: rgba(95, 158, 160, 0.14);
}

.story-track-step.is-current {
    border-color: rgba(95, 158, 160, 0.95);
    background: rgba(95, 158, 160, 0.26);
    box-shadow: 0 0 0 2px rgba(95, 158, 160, 0.18);
}

body.word-quest-page .activity-breadcrumb {
    padding: 6px 10px;
    font-size: 0.85rem;
}

.quick-response-dock {
    position: fixed;
    right: 14px;
    bottom: calc(max(10px, env(safe-area-inset-bottom, 0px)) + 112px);
    width: min(360px, calc(100% - 20px));
    z-index: 1300;
}

.quick-response-toggle {
    width: 100%;
    border: 1px solid rgba(95, 158, 160, 0.6);
    border-radius: 12px;
    background: var(--neuro-surface-strong);
    color: #1f2937;
    font-weight: 800;
    padding: 9px 12px;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
    cursor: pointer;
}

.quick-response-panel {
    margin-top: 8px;
    border: 1px solid var(--neuro-border);
    border-radius: 14px;
    background: var(--neuro-surface-strong);
    box-shadow: 0 12px 24px rgba(15, 23, 42, 0.14);
    padding: 10px;
}

.quick-response-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
    max-height: 280px;
    overflow-y: auto;
}

.quick-response-btn {
    min-height: 52px;
    border: 1px solid rgba(95, 158, 160, 0.34);
    border-radius: 12px;
    background: #ffffff;
    color: #1f2937;
    display: flex;
    align-items: center;
    gap: 8px;
    text-align: left;
    padding: 8px 10px;
    cursor: pointer;
}

.quick-response-btn:hover,
.quick-response-btn:focus-visible {
    background: rgba(95, 158, 160, 0.12);
    border-color: rgba(95, 158, 160, 0.58);
}

.quick-response-icon {
    font-size: 1rem;
    line-height: 1;
}

.quick-response-text {
    font-size: 0.85rem;
    font-weight: 700;
    line-height: 1.2;
}

.quick-response-output {
    margin-top: 8px;
    min-height: 40px;
    border: 1px dashed rgba(95, 158, 160, 0.42);
    border-radius: 10px;
    background: #ffffff;
    color: #1f2937;
    font-size: 0.87rem;
    font-weight: 700;
    padding: 8px 10px;
}

.quick-response-editor {
    margin-top: 8px;
    border-top: 1px dashed rgba(95, 126, 128, 0.38);
    padding-top: 8px;
}

.quick-response-editor summary {
    cursor: pointer;
    font-weight: 700;
    color: #334155;
}

.quick-response-editor .muted {
    margin-top: 6px;
    font-size: 0.8rem;
}

.quick-response-editor-input {
    width: 100%;
    margin-top: 6px;
    border: 1px solid rgba(95, 126, 128, 0.42);
    border-radius: 10px;
    background: #ffffff;
    color: #1f2937;
    font-size: 0.85rem;
    font-family: var(--font-body);
    padding: 8px 10px;
}

.quick-response-editor-actions {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

body.focus-mode-active .focus-mode-hidden {
    display: none !important;
}

body.focus-mode-active .focus-mode-target {
    width: min(100%, var(--page-max));
    margin-inline: auto;
}

body.reduced-stimulation *,
body.reduced-stimulation *::before,
body.reduced-stimulation *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
}

@media (max-width: 900px) {
    .global-accessibility-body {
        grid-template-columns: 1fr;
    }

    .global-accessibility-font-label {
        align-items: flex-start;
        flex-direction: column;
    }

    .global-accessibility-font-label select {
        width: 100%;
        min-width: 0;
    }

    .story-track {
        width: calc(100% - 12px);
        bottom: max(6px, env(safe-area-inset-bottom, 0px));
        padding: 8px 10px;
        border-radius: 14px;
    }

    .quick-response-dock {
        left: 10px;
        right: 10px;
        width: auto;
        bottom: calc(max(8px, env(safe-area-inset-bottom, 0px)) + 108px);
    }
}

@media (max-width: 640px) {
    .activity-breadcrumb {
        width: 100%;
        justify-content: flex-start;
    }

    .quick-response-grid {
        grid-template-columns: 1fr;
    }

    .story-track-step {
        font-size: 0.78rem;
        padding: 5px 9px;
    }
}

/* ==========================================================================
   Mobile / iPad reliability patch for Word Quest
   - Prevent clipped keyboard on phones/tablets
   - Keep desktop projector behavior unchanged
   ========================================================================== */
@media (max-width: 820px), ((hover: none) and (pointer: coarse) and (max-width: 1100px)) {
    body.word-quest-page {
        height: auto;
        min-height: 100svh;
        overflow-y: auto;
        overflow-x: hidden;
    }

    body.word-quest-page main {
        overflow: visible;
        min-height: auto;
    }

    body.word-quest-page .header-actions {
        width: 100%;
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        padding-bottom: 2px;
    }

    body.word-quest-page .header-actions .link-btn {
        flex: 0 0 auto;
        padding: 6px 8px;
        font-size: 0.78rem;
    }

    body.word-quest-page .controls {
        width: 100%;
        gap: 6px;
        row-gap: 6px;
    }

    body.word-quest-page .control-group {
        min-width: 0;
    }

    body.word-quest-page #game-canvas {
        width: calc(100% - 12px);
        max-width: 980px;
        margin: 8px 6px 12px;
        padding: 10px 6px calc(10px + env(safe-area-inset-bottom, 0));
        gap: 8px;
        overflow: visible;
    }

    body.word-quest-page #keyboard {
        width: 100%;
        max-width: none;
        margin: 0 0 28px;
        padding: 10px 6px calc(24px + env(safe-area-inset-bottom, 0));
        gap: 6px;
    }

    body.word-quest-page.fit-screen #keyboard,
    body.word-quest-page.fit-screen-tight #keyboard {
        margin: 0 0 28px !important;
        padding: 10px 6px calc(24px + env(safe-area-inset-bottom, 0)) !important;
    }

    body.word-quest-page .keyboard-row {
        gap: 4px;
    }

    body.word-quest-page .key {
        flex: 1 1 0;
        min-width: 0;
        max-width: none;
        height: clamp(38px, 9.2vw, 52px);
        font-size: clamp(0.82rem, 3vw, 1.02rem);
        border-radius: 10px;
        padding: 0 2px;
    }

    body.word-quest-page .key.wide {
        flex: 1.35 1 0;
        min-width: 0;
        max-width: none;
        font-size: clamp(0.62rem, 2.3vw, 0.82rem);
        letter-spacing: 0.03em;
        padding: 0 2px;
    }

    body.word-quest-page.fit-screen .key,
    body.word-quest-page.fit-screen-tight .key {
        flex: 1 1 0;
        min-width: 0;
        max-width: none;
    }

    body.word-quest-page.fit-screen .key.wide,
    body.word-quest-page.fit-screen-tight .key.wide {
        flex: 1.35 1 0;
        min-width: 0;
        max-width: none;
    }

    body.word-quest-page .hint-actions {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 6px;
    }

    body.word-quest-page .hint-actions .hint-btn {
        width: 100%;
        min-height: 34px;
        padding: 6px 6px;
        font-size: 0.78rem;
    }
}

@media (max-width: 420px) {
    body.word-quest-page #game-canvas {
        width: calc(100% - 8px);
        margin: 6px 4px 10px;
        padding: 8px 4px calc(8px + env(safe-area-inset-bottom, 0));
    }

    body.word-quest-page #keyboard {
        margin-bottom: 12px;
        padding: 6px 2px calc(10px + env(safe-area-inset-bottom, 0));
        gap: 3px;
    }

    body.word-quest-page .keyboard-row {
        gap: 2px;
    }

    body.word-quest-page .key {
        height: clamp(32px, 9vw, 42px);
        font-size: clamp(0.74rem, 3.1vw, 0.9rem);
    }

    body.word-quest-page .key.wide {
        font-size: clamp(0.56rem, 2.1vw, 0.74rem);
        letter-spacing: 0.02em;
    }
}

/* ==========================================================================
   Word Quest deterministic desktop layout
   - Consolidated source of truth for desktop sizing/fit.
   - Keeps support overlays hidden for task-first gameplay.
   ========================================================================== */
body.word-quest-page .story-track,
body.word-quest-page .quick-response-dock {
    display: none !important;
}

@media (min-width: 821px) {
    body.word-quest-page {
        --wq-tile-size-desktop: 70px;
        --wq-key-size-desktop: 52px;
        --wq-key-wide-size-desktop: 88px;
        --wq-keyboard-max-desktop: 690px;
        --wq-canvas-max-desktop: 980px;
        --wq-desktop-bottom-gap: 46px;
        overflow: hidden;
        height: 100dvh;
        min-height: 100dvh;
    }

    body.word-quest-page header {
        padding: 6px 10px 2px;
    }

    body.word-quest-page .header-top {
        margin-bottom: 2px;
        gap: 6px;
    }

    body.word-quest-page .header-actions {
        flex-wrap: wrap;
        overflow: visible;
        width: 100%;
        gap: 6px;
        row-gap: 4px;
        padding-bottom: 0;
    }

    body.word-quest-page .header-actions::-webkit-scrollbar {
        height: 0;
    }

    body.word-quest-page .header-actions .link-btn {
        flex: 0 0 auto;
        padding: 5px 9px;
        font-size: 0.83rem;
        border-radius: 10px;
    }

    body.word-quest-page .learner-switcher {
        margin-left: auto;
        flex: 0 0 auto;
        gap: 4px;
    }

    body.word-quest-page .learner-switcher-select {
        min-width: 94px;
        padding: 4px 7px;
        font-size: 0.74rem;
    }

    body.word-quest-page .learner-manage-btn {
        display: none !important;
    }

    body.word-quest-page .learner-switcher-label {
        display: none;
    }

    body.word-quest-page .controls {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 2px;
        gap: 5px 10px;
        justify-content: flex-start;
        padding: 0;
    }

    body.word-quest-page .control-group {
        flex-direction: row;
        align-items: center;
        gap: 6px;
    }

    body.word-quest-page .controls select {
        width: auto;
        min-width: 88px;
        padding: 5px 8px;
        font-size: 0.86rem;
    }

    body.word-quest-page .controls #pattern-select {
        min-width: clamp(260px, 30vw, 440px);
    }

    body.word-quest-page .case-toggle-btn {
        width: auto;
        min-width: 52px;
        min-height: 32px;
        padding: 4px 10px;
        font-size: 0.82rem;
    }

    body.word-quest-page .control-group label {
        margin-bottom: 0;
        font-size: 0.7rem;
        letter-spacing: 0.06em;
    }

    body.word-quest-page #activity-breadcrumb,
    body.word-quest-page #global-accessibility-tools {
        display: none !important;
    }

    body.word-quest-page main {
        flex: 1;
        min-height: 0 !important;
        overflow: hidden !important;
        justify-content: flex-start;
        padding-bottom: max(calc(var(--wq-desktop-bottom-gap) + 6px), env(safe-area-inset-bottom, 0px));
    }

    body.word-quest-page #game-canvas,
    body.word-quest-page.fit-screen #game-canvas,
    body.word-quest-page.fit-screen-tight #game-canvas {
        flex: 0 0 auto !important;
        height: auto !important;
        min-height: 0 !important;
        width: calc(100% - 16px) !important;
        max-width: var(--wq-canvas-max-desktop) !important;
        margin: 6px auto max(14px, var(--wq-desktop-bottom-gap)) !important;
        padding: 12px 12px 16px !important;
        gap: 10px !important;
        overflow: hidden !important;
    }

    body.word-quest-page #game-board,
    body.word-quest-page.fit-screen #game-board,
    body.word-quest-page.fit-screen-tight #game-board {
        margin: 4px auto !important;
        padding: 11px !important;
        gap: 6px !important;
    }

    body.word-quest-page .tile,
    body.word-quest-page.fit-screen .tile,
    body.word-quest-page.fit-screen-tight .tile {
        width: var(--wq-tile-size-desktop) !important;
        height: var(--wq-tile-size-desktop) !important;
        font-size: clamp(1.5rem, calc(var(--wq-tile-size-desktop) * 0.46), 2.4rem) !important;
    }

    body.word-quest-page .hint-actions {
        margin: 3px 0 !important;
        gap: 8px !important;
    }

    body.word-quest-page .hint-actions .hint-btn {
        min-height: 34px !important;
        padding: 6px 12px !important;
        font-size: 0.84rem !important;
    }

    body.word-quest-page #keyboard,
    body.word-quest-page.fit-screen #keyboard,
    body.word-quest-page.fit-screen-tight #keyboard {
        margin-bottom: max(calc(var(--wq-desktop-bottom-gap) + 12px), env(safe-area-inset-bottom, 0px)) !important;
        padding: 10px 10px calc(12px + env(safe-area-inset-bottom, 0px)) !important;
        gap: 6px !important;
        max-width: var(--wq-keyboard-max-desktop) !important;
    }

    body.word-quest-page .keyboard-row {
        gap: 7px !important;
    }

    body.word-quest-page .key,
    body.word-quest-page.fit-screen .key,
    body.word-quest-page.fit-screen-tight .key {
        height: var(--wq-key-size-desktop) !important;
        font-size: clamp(0.82rem, calc(var(--wq-key-size-desktop) * 0.42), 1.2rem) !important;
        max-width: var(--wq-key-size-desktop) !important;
    }

    body.word-quest-page .key.wide,
    body.word-quest-page.fit-screen .key.wide,
    body.word-quest-page.fit-screen-tight .key.wide {
        max-width: var(--wq-key-wide-size-desktop) !important;
    }
}

/* If viewport UI chrome still clips the keyboard (common on iPad/desktop non-fullscreen),
   allow controlled vertical scroll instead of cutting off the last row. */
@media (min-width: 821px) {
    body.word-quest-page.wq-scroll-fallback {
        overflow-y: auto !important;
        height: auto !important;
        min-height: 100dvh !important;
    }

    body.word-quest-page.wq-scroll-fallback main {
        overflow: visible !important;
        min-height: auto !important;
        padding-bottom: max(52px, env(safe-area-inset-bottom, 0px)) !important;
    }

    body.word-quest-page.wq-scroll-fallback #game-canvas,
    body.word-quest-page.wq-scroll-fallback.fit-screen #game-canvas,
    body.word-quest-page.wq-scroll-fallback.fit-screen-tight #game-canvas {
        overflow: visible !important;
        margin-bottom: 18px !important;
    }

    body.word-quest-page.wq-scroll-fallback #keyboard,
    body.word-quest-page.wq-scroll-fallback.fit-screen #keyboard,
    body.word-quest-page.wq-scroll-fallback.fit-screen-tight #keyboard {
        margin-bottom: max(40px, env(safe-area-inset-bottom, 0px)) !important;
    }
}

@media (max-width: 820px) {
    body.word-quest-page {
        overflow-y: auto;
        overflow-x: hidden;
        height: auto;
        min-height: 100dvh;
    }

    body.word-quest-page main {
        flex: 0 1 auto;
        min-height: auto !important;
        overflow: visible !important;
        padding-bottom: max(48px, env(safe-area-inset-bottom, 0px));
    }

    body.word-quest-page #game-canvas {
        flex: 0 1 auto !important;
        min-height: auto !important;
        overflow: visible !important;
    }

    body.word-quest-page.fit-screen #game-canvas,
    body.word-quest-page.fit-screen-tight #game-canvas {
        margin-bottom: 18px !important;
        padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px)) !important;
    }

    body.word-quest-page.fit-screen #keyboard,
    body.word-quest-page.fit-screen-tight #keyboard {
        margin-bottom: max(30px, env(safe-area-inset-bottom, 0px)) !important;
        padding-bottom: calc(22px + env(safe-area-inset-bottom, 0px)) !important;
    }
}

/* ==========================================================================
   Support UI safety rails
   ========================================================================== */
body:not(.has-story-track) #story-track {
    display: none !important;
}

@media (max-height: 780px) and (min-width: 821px) {
    .quick-response-dock {
        display: none !important;
    }
}

/* ==========================================================================
   Max-impact UX pass (navigation + first impression + Word Quest headroom)
   ========================================================================== */

/* Guided nav menu replaces crowded activity tabs. */
.header-activity-menu {
    position: relative;
    flex: 0 0 auto;
}

.header-activity-summary {
    list-style: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    min-height: 38px;
    padding: 7px 12px;
    border-radius: 11px;
    border: 1px solid rgba(99, 102, 241, 0.28);
    background: rgba(255, 255, 255, 0.85);
    color: #1e293b;
    font-size: 0.86rem;
    font-weight: 820;
    user-select: none;
}

.header-activity-summary.active,
.header-activity-menu[open] .header-activity-summary {
    border-color: rgba(79, 70, 229, 0.42);
    background: rgba(224, 231, 255, 0.92);
    color: #312e81;
}

.header-activity-summary::-webkit-details-marker {
    display: none;
}

.header-activity-summary::after {
    content: '▾';
    font-size: 0.72rem;
    color: #4f46e5;
}

.header-activity-menu[open] .header-activity-summary::after {
    content: '▴';
}

.header-activity-panel {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    width: min(360px, calc(100vw - 28px));
    padding: 12px;
    border-radius: 14px;
    border: 1px solid rgba(99, 102, 241, 0.24);
    background: rgba(255, 255, 255, 0.97);
    box-shadow: 0 20px 40px rgba(15, 23, 42, 0.16);
    display: grid;
    gap: 10px;
    z-index: 2400;
}

.header-activity-panel:empty {
    display: none;
}

.header-activity-group {
    display: grid;
    gap: 6px;
}

.header-activity-group-title {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #64748b;
    font-weight: 850;
}

.header-activity-link {
    text-decoration: none;
    color: #1e293b;
    font-weight: 760;
    font-size: 0.86rem;
    border: 1px solid rgba(99, 102, 241, 0.18);
    border-radius: 10px;
    padding: 7px 9px;
    background: rgba(255, 255, 255, 0.86);
}

.header-activity-link:hover,
.header-activity-link:focus-visible {
    border-color: rgba(99, 102, 241, 0.38);
    background: rgba(238, 242, 255, 0.84);
}

.header-activity-link.active {
    border-color: rgba(79, 70, 229, 0.44);
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.95), rgba(14, 165, 233, 0.86));
    color: #fff;
}

@media (max-width: 760px) {
    .header-activity-summary {
        min-height: 34px;
        padding: 6px 10px;
        font-size: 0.82rem;
    }

    .header-activity-panel {
        right: auto;
        left: 0;
        width: min(300px, calc(100vw - 24px));
    }
}

/* Home: keep first screen simple and low-scroll. */
body.home-page.home-details-collapsed .home-hero {
    grid-template-columns: 1fr;
    min-height: clamp(460px, 72dvh, 640px);
}

body.home-page.home-details-collapsed .home-hero-panel {
    display: none;
}

body.home-page.home-details-collapsed .home-card.home-hero {
    padding: clamp(18px, 2.6vw, 30px);
}

body.home-page .home-hero h2 {
    line-height: 1.15;
}

body.home-page .home-lede {
    max-width: 46ch;
}

/* Word Quest top area: reduce headroom load and keep board/keyboard visible. */
body.word-quest-page .controls {
    gap: 6px 10px;
    margin-bottom: 2px;
}

body.word-quest-page #pattern-select {
    min-width: min(420px, calc(100vw - 42px));
}

body.word-quest-page .control-group label {
    font-size: 0.7rem;
    letter-spacing: 0.06em;
}

body.word-quest-page .quick-custom-word-panel {
    max-width: min(760px, calc(100vw - 28px));
    margin: 6px auto 8px;
    padding: 10px 12px;
    border-radius: 14px;
}

body.word-quest-page .quick-custom-word-toggle {
    font-size: 0.9rem;
    padding: 9px 11px;
}

body.word-quest-page .quick-custom-word-body {
    padding-top: 8px;
}

body.word-quest-page .quick-custom-word-row {
    gap: 8px;
}

body.word-quest-page .quick-custom-word-status {
    margin-top: 6px;
    font-size: 0.82rem;
}

@media (min-width: 821px) {
    body.word-quest-page {
        --wq-tile-size-desktop: 58px;
        --wq-key-size-desktop: 48px;
        --wq-key-wide-size-desktop: 80px;
        --wq-keyboard-max-desktop: 760px;
        --wq-canvas-max-desktop: 980px;
        --wq-desktop-bottom-gap: 20px;
    }

    body.word-quest-page #game-canvas,
    body.word-quest-page.fit-screen #game-canvas,
    body.word-quest-page.fit-screen-tight #game-canvas {
        margin: 4px auto 12px !important;
        padding: 10px 12px 12px !important;
        gap: 8px !important;
    }

    body.word-quest-page #keyboard,
    body.word-quest-page.fit-screen #keyboard,
    body.word-quest-page.fit-screen-tight #keyboard {
        margin-bottom: max(14px, env(safe-area-inset-bottom, 0px)) !important;
        padding: 10px 10px calc(14px + env(safe-area-inset-bottom, 0px)) !important;
    }
}

@media (min-width: 821px) and (max-height: 850px) {
    body.word-quest-page .page-guide-tip {
        display: none !important;
    }

    body.word-quest-page header {
        padding-top: 4px;
    }

    body.word-quest-page .controls {
        gap: 4px 8px;
        margin-bottom: 1px;
    }

    body.word-quest-page .quick-custom-word-panel {
        margin: 4px auto 6px;
        padding: 8px 10px;
    }
}
